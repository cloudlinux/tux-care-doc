<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ePortal API | Documentation</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="icon" href="/favicon.ico">
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5BSW555');</script>
    <meta name="description" content="You may need to create a separate ePortal account for API usage with:">
    <meta name="twitter:title" content="ePortal API">
    <meta name="twitter:description" content="You may need to create a separate ePortal account for API usage with:">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="/eportal-api/">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ePortal API">
    <meta property="og:description" content="You may need to create a separate ePortal account for API usage with:">
    <meta property="og:url" content="/eportal-api/">
    <meta property="og:site_name" content="TuxCare Documentation">
    <meta itemprop="name" content="ePortal API">
    <meta itemprop="description" content="You may need to create a separate ePortal account for API usage with:">
    <meta http-equiv="Content-Security-Policy" content="script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; *.survicate.com *.googletagmanager.com *.google-analytics.com *.licdn.com *.hotjar.com *.twitter.com *.facebook.net *.kernelcare.info *.twitter.com *.ads-twitter.com;">
    
    <link rel="preload" href="/assets/css/0.styles.55e003d6.css" as="style"><link rel="preload" href="/assets/js/app.3560baa2.js" as="script"><link rel="preload" href="/assets/js/4.fa87bcbc.js" as="script"><link rel="preload" href="/assets/js/1.8d9e0a6b.js" as="script"><link rel="preload" href="/assets/js/23.ab830d32.js" as="script"><link rel="prefetch" href="/assets/js/10.0598fc63.js"><link rel="prefetch" href="/assets/js/11.fbb1abbd.js"><link rel="prefetch" href="/assets/js/12.497b9334.js"><link rel="prefetch" href="/assets/js/13.cf94d2ce.js"><link rel="prefetch" href="/assets/js/14.e754d03b.js"><link rel="prefetch" href="/assets/js/15.ab56c7eb.js"><link rel="prefetch" href="/assets/js/16.e258bd7a.js"><link rel="prefetch" href="/assets/js/17.78b5c1ee.js"><link rel="prefetch" href="/assets/js/18.8871953b.js"><link rel="prefetch" href="/assets/js/19.09007db9.js"><link rel="prefetch" href="/assets/js/20.4b89b8f8.js"><link rel="prefetch" href="/assets/js/21.25545891.js"><link rel="prefetch" href="/assets/js/22.e6d46c39.js"><link rel="prefetch" href="/assets/js/24.83efaa23.js"><link rel="prefetch" href="/assets/js/25.fdc25dde.js"><link rel="prefetch" href="/assets/js/26.40a32fc6.js"><link rel="prefetch" href="/assets/js/27.001e7906.js"><link rel="prefetch" href="/assets/js/28.cbebfd17.js"><link rel="prefetch" href="/assets/js/29.2ac4cc61.js"><link rel="prefetch" href="/assets/js/30.9400c05d.js"><link rel="prefetch" href="/assets/js/31.9934dda1.js"><link rel="prefetch" href="/assets/js/32.f2c730d2.js"><link rel="prefetch" href="/assets/js/33.e1949419.js"><link rel="prefetch" href="/assets/js/34.ff7f5948.js"><link rel="prefetch" href="/assets/js/35.350f1c34.js"><link rel="prefetch" href="/assets/js/36.087b2a5d.js"><link rel="prefetch" href="/assets/js/37.89c17943.js"><link rel="prefetch" href="/assets/js/38.a9d9143b.js"><link rel="prefetch" href="/assets/js/39.4ef225ee.js"><link rel="prefetch" href="/assets/js/5.4855c5c6.js"><link rel="prefetch" href="/assets/js/6.e8d6a4c1.js"><link rel="prefetch" href="/assets/js/7.42124ede.js"><link rel="prefetch" href="/assets/js/8.247b8e55.js"><link rel="prefetch" href="/assets/js/9.6eee101a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.14adddb0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55e003d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tuxcare/" class="home-link"><img src="/logo.svg" alt="Documentation" class="logo"> <span class="site-name site-name--documentation can-hide">Documentation</span></a> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <div class="links" style="max-width:nullpx;"><a href="https://tuxcare.zendesk.com/hc/en-us" target="_blank" class="btn">
      Contact Support
    </a> <!----> <a href="https://portal.tuxcare.com" target="_blank" class="btn">
      Login to CLN
    </a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/eportal-api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/jp/eportal-api/" class="nav-link">日本語</a></li></ul></div></div></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/eportal-api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/jp/eportal-api/" class="nav-link">日本語</a></li></ul></div></div></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><!----> <ul class="sidebar-group-items"><li><div><a href="/tuxcare/" class="sidebar-link link-depth-level-0">TuxCare</a></div></li><li><div class="sidebar-header sidebar-link"><div><a href="/live-patching-services/" class="sidebar-link link-depth-level-0">Live Patching Services</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/live-patching-services/#kernelcare-enterprise" class="sidebar-link link-depth-level-1">KernelCare Enterprise</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/live-patching-services/#libcare" class="sidebar-link link-depth-level-1">LibCare</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/live-patching-services/#kernelcare-for-iot" class="sidebar-link link-depth-level-1">KernelCare for IOT</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/live-patching-services/#qemucare" class="sidebar-link link-depth-level-1">QEMUCare</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/live-patching-services/#dbcare" class="sidebar-link link-depth-level-1">DBCare</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/eportal/" class="sidebar-link link-depth-level-0">ePortal</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#eportal-hardware-requirements" class="sidebar-link link-depth-level-1">ePortal Hardware Requirements</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#installation" class="sidebar-link link-depth-level-1">Installation</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#cache-mode" class="sidebar-link link-depth-level-1">Cache mode</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#proxy-configuration" class="sidebar-link link-depth-level-1">Proxy configuration</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#auth-configuration" class="sidebar-link link-depth-level-1">Auth configuration</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#managing-users" class="sidebar-link link-depth-level-1">Managing Users</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#authentication-using-ldap" class="sidebar-link link-depth-level-1">Authentication using LDAP</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#accessing-eportal" class="sidebar-link link-depth-level-1">Accessing ePortal</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#patchset-deployment" class="sidebar-link link-depth-level-1">PatchSet deployment</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#libcare-patchset-deployment" class="sidebar-link link-depth-level-1">LibCare PatchSet Deployment</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#qemu-patchset-deployment" class="sidebar-link link-depth-level-1">QEMU PatchSet Deployment</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#managing-keys" class="sidebar-link link-depth-level-1">Managing Keys</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#managing-servers" class="sidebar-link link-depth-level-1">Managing Servers</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#feed-management" class="sidebar-link link-depth-level-1">Feed Management</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#adding-extra-tag-field" class="sidebar-link link-depth-level-1">Adding extra Tag field</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#how-to-setup-eportal-to-use-https" class="sidebar-link link-depth-level-1">How to setup ePortal to use HTTPS</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#high-availability" class="sidebar-link link-depth-level-1">High availability</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#deploying-kernelcare-enterprise" class="sidebar-link link-depth-level-1">Deploying KernelCare Enterprise</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#migrate-eportal" class="sidebar-link link-depth-level-1">Migrate ePortal</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#database-backup" class="sidebar-link link-depth-level-1">Database backup</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#config-files" class="sidebar-link link-depth-level-1">Config files</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#stopping-starting" class="sidebar-link link-depth-level-1">Stopping &amp; starting</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#log-files" class="sidebar-link link-depth-level-1">Log files</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#nagios-zabbix-support" class="sidebar-link link-depth-level-1">Nagios &amp; Zabbix support</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#usage-reports" class="sidebar-link link-depth-level-1">Usage reports</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#custom-environment-variables" class="sidebar-link link-depth-level-1">Custom environment variables</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal/#authentication-using-single-sign-on" class="sidebar-link link-depth-level-1">Authentication using Single Sign On</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal/#custom-patches-storage" class="sidebar-link link-depth-level-1">Custom patches storage</a></div></li></ul></li><li><div class="active collapsed sidebar-header sidebar-link"><div class="active"><a href="/eportal-api/" aria-current="page" class="active sidebar-link link-depth-level-0">ePortal API</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#list-servers" class="sidebar-link link-depth-level-1">List servers</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#register-host" class="sidebar-link link-depth-level-1">Register host</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#unregister-host" class="sidebar-link link-depth-level-1">Unregister host</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#create-modify-feed" class="sidebar-link link-depth-level-1">Create/modify feed</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#list-feeds" class="sidebar-link link-depth-level-1">List feeds</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#delete-feed" class="sidebar-link link-depth-level-1">Delete feed</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#create-modify-registration-key" class="sidebar-link link-depth-level-1">Create/modify registration key</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#list-keys" class="sidebar-link link-depth-level-1">List keys</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#delete-key" class="sidebar-link link-depth-level-1">Delete key</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#list-patchsets" class="sidebar-link link-depth-level-1">List patchsets</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/eportal-api/#manage-patchsets" class="sidebar-link link-depth-level-1">Manage patchsets</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/eportal-api/#configuration-manager-integration" class="sidebar-link link-depth-level-1">Configuration manager integration</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/extended-lifecycle-support/" class="sidebar-link link-depth-level-0">Extended Lifecycle Support</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/extended-lifecycle-support/#installation-instructions-of-yum-repositories" class="sidebar-link link-depth-level-1">Installation instructions of yum repositories</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/extended-lifecycle-support/#installation-instructions-of-a-local-mirror-with-els-updates" class="sidebar-link link-depth-level-1">Installation instructions of a local mirror with ELS updates</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/extended-lifecycle-support/#oval-data" class="sidebar-link link-depth-level-1">OVAL data</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/extended-lifecycle-support-for-languages/" class="sidebar-link link-depth-level-0">Extended Lifecycle Support for Languages</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/extended-lifecycle-support-for-languages/#extended-lifecycle-support-for-php" class="sidebar-link link-depth-level-1">Extended Lifecycle Support for PHP</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/extended-lifecycle-support-for-languages/#extended-lifecycle-support-for-python" class="sidebar-link link-depth-level-1">Extended Lifecycle Support for Python</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/linux-support-services/" class="sidebar-link link-depth-level-0">Linux Support Services</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div><a href="/linux-support-services/#essential-support-for-almalinux-os" class="sidebar-link link-depth-level-1">Essential support for AlmaLinux OS</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/linux-support-services/#premium-support-for-almalinux-os-and-other-linux-distributions" class="sidebar-link link-depth-level-1">Premium support for AlmaLinux OS and other Linux distributions</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/linux-support-services/#product-nodeos-support-for-almalinux-os" class="sidebar-link link-depth-level-1">Product NodeOS support for AlmaLinux OS</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/tuxcare-cln/" class="sidebar-link link-depth-level-0">Subscription management portal</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/tuxcare-cln/#introduction" class="sidebar-link link-depth-level-1">Introduction</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/tuxcare-cln/#dashboard" class="sidebar-link link-depth-level-1">Dashboard</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/tuxcare-cln/#live-patching-services" class="sidebar-link link-depth-level-1">Live Patching Services</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/tuxcare-cln/#extended-support-services" class="sidebar-link link-depth-level-1">Extended Support Services</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/tuxcare-cln/#billing" class="sidebar-link link-depth-level-1">Billing</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/tuxcare-cln/#settings" class="sidebar-link link-depth-level-1">Settings</a></div></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>Documentation:</span> <a href="/eportal-api/" aria-current="page" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    ePortal API
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/eportal/" class="nav-arrow left"></a> <a href="/extended-lifecycle-support/" class="nav-arrow right"></a></div></div> <div class="content content__default"><h1 id="eportal-api"><a href="#eportal-api" class="header-anchor">#</a> ePortal API</h1> <p>You may need to create a separate ePortal account for API usage with:</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal user -a api-user -p &lt;password&gt;
</code></pre></div><p>It can be useful for SSO/LDAP setups to be able to pass HTTP API credentials via
basic auth.</p> <p>In general ePortal API is configuration management friendly and idempotent. You
don't need to make additional request to check existing state. For example
entity deletion doesn't raise an error in case there is no such entity.
Or entity creation/modification is a single request that just works and
simply brings desired final state.</p> <h2 id="list-servers"><a href="#list-servers" class="header-anchor">#</a> List servers</h2> <p><strong>GET /admin/api/servers</strong></p> <p>Filters servers on various criteria, iterate through list and get
server counts.</p> <p>Requires basic authorization with read only user permissions.</p> <p><strong>Query string parameters:</strong></p> <ul><li><code>hostname</code>: String, optional. Return servers with a hostname like value. Value can
contain <code>%</code> placeholder to match any string.</li> <li><code>ip</code>: String, optional. Return servers with IP like value. Value can
contain <code>%</code> placeholder to match any string.</li> <li><code>feed</code>: String, optional. Return servers attached to feed. Use <code>main</code>
for default feed.</li> <li><code>key</code>: String, optional. Return servers registered to key.</li> <li><code>registered_age</code>: Integer, optional. Return servers registered more than
<code>registered_age</code> days ago. If <code>registered_age</code> is negative then return
servers registered less or equal -<code>registered_age</code> days ago. For example:
<code>registered_age=-3</code> means to return servers registered 3 or less days ago.
Hours can be specified by adding <code>h</code> suffix: <code>registered_age=4h</code> selects
servers registered more than 4 hours ago.</li> <li><code>checkin_age</code>: Integer, optional. Return servers sent check-in more than
<code>checkin_age</code> days ago. For negative values see <code>registered_age</code>.</li> <li><code>updated_age</code>: Integer, optional. Return servers loaded patches more than
<code>updated_age</code> days ago. For negative values see <code>registered_age</code>.</li> <li><code>is_updated</code>: Boolean, optional. If <code>true</code> then return servers updated to latest
available patches. If <code>false</code> return servers without latest patches.</li> <li><code>limit</code>: Integer, optional. Limit result to a specified number of entries. By
default <code>limit</code> is 10.</li> <li><code>offset</code>: Integer, optional. Set result to a specified offset. <code>limit</code> and
<code>offset</code> can be used to iterate through result.</li> <li><code>only_count</code>: Boolean, optional. Return server count only.</li> <li><code>tag</code>: String, optional. Adds filter by server tag. E.g <code>tag=env:test</code> or <code>tag=ubuntu</code>.</li></ul> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
    <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;99c97tz44uKX13b5&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.51.16.72&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost.localdomain&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some-key&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;feed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;registered&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-04-08 16:43:23.907671&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;checkin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-07-12 17:35:56.065077&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;updated&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-06-01 16:37:03.000000&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;euname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.10.0-1160.25.1.el7&quot;</span><span class="token punctuation">,</span>        <span class="token comment">// effective kernel version</span>
            <span class="token property">&quot;release&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.10.0-957.5.1.el7.x86_64&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// installed kernel version</span>
            <span class="token property">&quot;kernel_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;9647204d2708cad906a75944ee56ac68fc5b5704&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;patch_level&quot;</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">,</span>
            <span class="token property">&quot;patch_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">&quot;uptime&quot;</span><span class="token operator">:</span> <span class="token number">6394092</span><span class="token punctuation">,</span>
            <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#1 SMP Fri Feb 1 14:54:57 UTC 2019&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;virt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kvm&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;kcare_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.44-2&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;distro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CentOS Linux&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;distro_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;7.6.1810&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;machine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x86_64&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;processor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x86_64&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ...
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="register-host"><a href="#register-host" class="header-anchor">#</a> Register host</h2> <p><strong>POST /admin/api/register</strong></p> <p>Registers host by provided key and hostname.</p> <p><strong>Form (urlencoded) parameters:</strong></p> <ul><li><code>key</code>: String, required. ePortal key to use for registration.</li> <li><code>hostname</code>: String, optional. Server's hostname to use.</li></ul> <p><strong>Success response (200):</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;server_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some-server-id&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Error response (400):</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error code&quot;</span> # invalid-key | key-limit-reached
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST https://eportal.corp.com/admin/api/register -F key=test
{&quot;server_id&quot;:&quot;lw1MO1Du5sF3Cj39&quot;}
</code></pre></div><h2 id="unregister-host"><a href="#unregister-host" class="header-anchor">#</a> Unregister host</h2> <p><strong>POST /admin/api/delete_server</strong></p> <p>Removes registered servers by IP or hostname</p> <p>Requires basic authorization with admin user permissions.</p> <p><strong>Query string parameters:</strong></p> <ul><li><code>hostname</code>: String, optional. Server's hostname to delete.</li> <li><code>ip</code>: String, optional. Server's IP to delete.</li></ul> <p>Endpoint requires at least one parameter <code>hostname</code> or <code>ip</code>.</p> <p><strong>Response:</strong></p> <p>Response contains number of deleted servers.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For example:</p> <div class="language- extra-class"><pre class="language-text"><code>curl --user admin:admin-password -X POST https://eportal.corp.com/admin/api/delete_server?ip=192.168.1.1
</code></pre></div><p>Below are examples of using <code>/admin/api/delete_server</code> endpoint with various
CM products. Take note, you need a host IP or a hostname to delete it via API.
It can be more convenient to use on of:</p> <ul><li>if you have an access to a host (it is alive) it's a way more simpler to call <code>kcarectl --unregister</code> to delete the host.</li> <li>if host is already destroyed you can consider using bulk <a href="#clean-inactive-servers">inactive server cleanup</a>.</li></ul> <h2 id="create-modify-feed"><a href="#create-modify-feed" class="header-anchor">#</a> Create/modify feed</h2> <p><strong>POST /admin/api/feeds/</strong></p> <p>If feed already exists request modifies it.</p> <p>Requires write permissions and accepts basic authorization.</p> <p><strong>Query string/Form/JSON parameters:</strong></p> <ul><li><code>name</code>: String, required. Name of created or modified feed.</li> <li><code>auto</code>: Boolean, optional. Sets auto-update property. Default is false.</li> <li><code>deploy_after</code>: Integer, optional. Sets delayed period in hours. Default is 0 (not delayed).</li></ul> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test-feed&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;auto&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deploy_after&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST -u admin -d name=test-feed -d auto=true https://eportal.corp.com/admin/api/feeds/
</code></pre></div><h2 id="list-feeds"><a href="#list-feeds" class="header-anchor">#</a> List feeds</h2> <p><strong>GET /admin/api/feeds/</strong></p> <p>Returns list of existing feeds. Take note: <code>main</code> feed is alway present
and couldn't be modified.</p> <p>Requires read permissions and accepts basic authorization.</p> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;auto&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">&quot;deploy_after&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;feed-name&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -u admin https://eportal.corp.com/admin/api/feeds/
</code></pre></div><h2 id="delete-feed"><a href="#delete-feed" class="header-anchor">#</a> Delete feed</h2> <p><strong>DELETE /admin/api/feeds/:feed-name</strong></p> <p>Requires write permissions and accepts basic authorization.</p> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token number">1</span>  <span class="token comment">// number of deleted records, 0 if there is no such feed.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -X DELETE -u admin https://eportal.corp.com/admin/api/feeds/test-feed
</code></pre></div><h2 id="create-modify-registration-key"><a href="#create-modify-registration-key" class="header-anchor">#</a> Create/modify registration key</h2> <p><strong>POST /admin/api/keys/</strong></p> <p>If key already exists request modifies it.</p> <p>Requires write permissions and accepts basic authorization.</p> <p><strong>Query string/Form/JSON parameters:</strong></p> <ul><li><code>key</code>: String, optional. Name of created or modified key. If it's empty
random key is generated.</li> <li><code>feed</code>: String, optional. Name of attached feed. <code>main</code> by default.</li> <li><code>note</code>: String, optional. Description of the key.</li> <li><code>server_limit</code>: Integer, optional. Advisory limit of a maximum number of hosts
one can register on the key.</li></ul> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;feed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;feed-name&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;note&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some-note&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;server_limit&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST -u admin -d key=test-key -d feed=test-feed https://eportal.corp.com/admin/api/keys/
</code></pre></div><h2 id="list-keys"><a href="#list-keys" class="header-anchor">#</a> List keys</h2> <p><strong>GET /admin/api/keys/</strong></p> <p>Returns list of existing keys.</p> <p>Requires read permissions and accepts basic authorization.</p> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;feed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;note&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      <span class="token property">&quot;server_limit&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -u admin https://eportal.corp.com/admin/api/keys/
</code></pre></div><h2 id="delete-key"><a href="#delete-key" class="header-anchor">#</a> Delete key</h2> <p><strong>DELETE /admin/api/keys/:key</strong></p> <p>Requires write permissions and accepts basic authorization.</p> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token number">1</span>  <span class="token comment">// number of deleted records, 0 if there is no such key.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -X DELETE -u admin https://eportal.corp.com/admin/api/keys/test-key
</code></pre></div><h2 id="list-patchsets"><a href="#list-patchsets" class="header-anchor">#</a> List patchsets</h2> <p><strong>GET /admin/api/patchsets/</strong></p> <p>Endpoint lists available patchsets for a feed and product.
Sort order is from oldest to newest patchsets.</p> <p>Requires read permissions and accepts basic authorization.</p> <p><strong>Query string parameters:</strong></p> <ul><li><code>feed</code>: String, optional. Name of the feed to list patchsets for. <code>main</code> by default.</li> <li><code>product</code>: String, optional. Possible values are: <code>kernel</code>, <code>user</code>, <code>qemu</code>, <code>db</code>.
Selects a patchstore for a specified product. <code>kernel</code> by default.</li></ul> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;patchset&quot;</span><span class="token operator">:</span> <span class="token string">&quot;patchset-name&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;enabled&quot;</span> <span class="token comment">// possible values are: enabled, disabled, not-downloaded, undeployed</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>curl -u admin 'https://eportal.corp.com/admin/api/patchsets/?feed=main&amp;product=kernel'
</code></pre></div><h2 id="manage-patchsets"><a href="#manage-patchsets" class="header-anchor">#</a> Manage patchsets</h2> <p><strong>POST /admin/api/patchsets/manage</strong></p> <p>Allows to perform deploy actions on the patchsets.</p> <p>Requires write permissions and accepts basic authorization.</p> <p><strong>Query string parameters:</strong></p> <ul><li><code>patchset</code>: String, required. Name of the patchset to operate on.</li> <li><code>feed</code>: String, required. Name of the feed to operate on. Can be specified
multiple times.</li> <li><code>action</code>: String, requred. Operartion to perform:
<ul><li><code>enable</code>: enable specified patchset.</li> <li><code>disable</code>: disable specified patchset.</li> <li><code>enable-upto</code>: enable all patchset up to (older than) specified.</li> <li><code>undeploy-downto</code>: undeploy all patchsets down to (newer than) specified.</li></ul></li> <li><code>product</code>: String, optional. Possible values are: <code>kernel</code>, <code>user</code>, <code>qemu</code>, <code>db</code>.
Selects a patchstore for a specified product. <code>kernel</code> by default.</li></ul> <p><strong>Response:</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Example:</strong></p> <p>Enable libcare patchset <code>U20200506_01</code> in <code>main</code> and <code>test-feed</code> feeds:</p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST -u admin 'https://eportal.corp.com/admin/api/patchsets/manage?patchset=U20200506_01&amp;feed=main&amp;feed=test-feed&amp;product=user&amp;action=enable'
</code></pre></div><h2 id="configuration-manager-integration"><a href="#configuration-manager-integration" class="header-anchor">#</a> Configuration manager integration</h2> <h3 id="ansible-playbook"><a href="#ansible-playbook" class="header-anchor">#</a> Ansible playbook</h3> <p>Integrating ePortal API access with Ansible is now possible. Rather than calling the kernelcare agent to perform tasks, it is possible to replace it with direct calls to ePortal to achieve the same results.</p> <p>Unregister KernelCare agent through API playbook:</p> <div class="language-json extra-class"><pre class="language-json"><code>- hosts<span class="token operator">:</span> kernelcare
  vars<span class="token operator">:</span>
    eportal_srv<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//eportal.address.here[:port if needed]</span>

  tasks<span class="token operator">:</span>
    - name<span class="token operator">:</span> unregister kernelcare agent through API
      uri<span class="token operator">:</span>
        url<span class="token operator">:</span> <span class="token string">&quot;{{ eportal_srv }}/admin/api/delete_server?ip={{ ansible_default_ipv4.address|default(ansible_all_ipv4_addresses[0]) }}&quot;</span>
        method<span class="token operator">:</span> POST
        user<span class="token operator">:</span> your-api-user
        password<span class="token operator">:</span> your-api-user-password
        force_basic_auth<span class="token operator">:</span> yes
</code></pre></div><p>Example:</p> <div class="language-json extra-class"><pre class="language-json"><code>- hosts<span class="token operator">:</span> kernelcare
  vars<span class="token operator">:</span>
    eportal_srv<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//192.168.246.110</span>

  tasks<span class="token operator">:</span>
    - name<span class="token operator">:</span> unregister kernelcare agent through API
      uri<span class="token operator">:</span>
        url<span class="token operator">:</span> <span class="token string">&quot;{{ eportal_srv }}/admin/api/delete_server?ip={{ ansible_default_ipv4.address|default(ansible_all_ipv4_addresses[0]) }}&quot;</span>
        method<span class="token operator">:</span> POST
        user<span class="token operator">:</span> api-user
        password<span class="token operator">:</span> dummy
        force_basic_auth<span class="token operator">:</span> yes
</code></pre></div><p>Ad hoc run with:</p> <div class="language- extra-class"><pre class="language-text"><code>ansible-playbook -u ansible  ./kernelcare.yml
</code></pre></div><p>This can be called during machine tear down to properly remove the server from ePortal.</p> <h3 id="chef-recipe"><a href="#chef-recipe" class="header-anchor">#</a> Chef recipe</h3> <p>Having tighter integration with automation tools like Chef has always been a goal for KernelCare and related tools like ePortal. The following recipe demonstrates how to use the delete_server api to correctly remove a server from ePortal during tear down, and can be integrated with your other recipes to avoid manual operations.</p> <p>Unregister KernelCare agent through API recipe:</p> <div class="language-json extra-class"><pre class="language-json"><code>eportal_url = <span class="token string">&quot;EPORTAL URL&quot;</span>
eportal_user = <span class="token string">&quot;EPORTAL API USER NAME&quot;</span>
eportal_password = <span class="token string">&quot;EPORTAL API USER PASSWORD&quot;</span>

# the ip to unregister can be pulled automatically from the system where the recipe is applied<span class="token punctuation">,</span> or specified manually (by replacing the following line with a simple assignment)
ip_to_unregister = <span class="token string">&quot;#{node['network']['interfaces'][node['network']['default_interface']]['addresses'].select{|k,v| v['family'] == &quot;</span>inet<span class="token string">&quot;}.keys.first}&quot;</span>


http_request <span class="token string">&quot;kernelcare-unregister-api&quot;</span> do
  url <span class="token string">&quot;#{eportal_url}/admin/api/delete_server?ip=#{ip_to_unregister}&quot;</span>
  action <span class="token operator">:</span>post
  headers(<span class="token punctuation">{</span>'AUTHORIZATION' =&gt; &quot;Basic #<span class="token punctuation">{</span>
    Base64.encode64(<span class="token string">&quot;#{eportal_user}:#{eportal_password}&quot;</span>)<span class="token punctuation">}</span>&quot;<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>)
end
</code></pre></div><p>Example (kernelcare-unregister-api.rb):</p> <div class="language-json extra-class"><pre class="language-json"><code>eportal_url = <span class="token string">&quot;http://192.168.246.110&quot;</span>
eportal_user = <span class="token string">&quot;api-user&quot;</span>
eportal_password = <span class="token string">&quot;dummy&quot;</span>

ip_to_unregister = <span class="token string">&quot;#{node['network']['interfaces'][node['network']['default_interface']]['addresses'].select{|k,v| v['family'] == &quot;</span>inet<span class="token string">&quot;}.keys.first}&quot;</span>

http_request <span class="token string">&quot;kernelcare-unregister-api&quot;</span> do
  url <span class="token string">&quot;#{eportal_url}/admin/api/delete_server?ip=#{ip_to_unregister}&quot;</span>
  action <span class="token operator">:</span>post
  headers(<span class="token punctuation">{</span>'AUTHORIZATION' =&gt; &quot;Basic #<span class="token punctuation">{</span>
    Base64.encode64(<span class="token string">&quot;#{eportal_user}:#{eportal_password}&quot;</span>)<span class="token punctuation">}</span>&quot;<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>)
end
</code></pre></div><p>Ad hoc run with:</p> <div class="language- extra-class"><pre class="language-text"><code>chef-apply kernelcare-unregister-api.rb
</code></pre></div><p>Output:</p> <div class="language-json extra-class"><pre class="language-json"><code>Recipe<span class="token operator">:</span> (chef-apply cookbook)<span class="token operator">:</span><span class="token operator">:</span>(chef-apply recipe)
  * http_request<span class="token punctuation">[</span>kernelcare-unregister-api<span class="token punctuation">]</span> action post
    - http_request<span class="token punctuation">[</span>kernelcare-unregister-api<span class="token punctuation">]</span> POST to http<span class="token operator">:</span><span class="token comment">//192.168.246.110/admin/api/delete_server?ip=192.168.246.40</span>
</code></pre></div><p>This can be called during machine tear down to properly remove the server from ePortal.</p> <h3 id="puppet-task"><a href="#puppet-task" class="header-anchor">#</a> Puppet task</h3> <p>Puppet provides the framework to run tasks on target systems. The following is a bash script that can run as such a task and demonstrates how to use the delete_server api to correctly remove a server from ePortal during tear down. It can be integrated with your other removal scripts or tasks to avoid manual operations.</p> <p>Unregister KernelCare agent through API call:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">EPORTAL_API_USERNAME</span><span class="token operator">=</span><span class="token operator">&lt;</span>your ePortal api user name<span class="token operator">&gt;</span>
<span class="token assign-left variable">EPORTAL_API_PASSWORD</span><span class="token operator">=</span><span class="token operator">&lt;</span>your ePortal api user password<span class="token operator">&gt;</span>
<span class="token assign-left variable">EPORTAL_URL</span><span class="token operator">=</span><span class="token string">'your ePortal URL'</span>

<span class="token comment">#this is taken from the primary ip in the system. If awk is available, it is used, but a fallback using other common tools is also provided</span>
<span class="token keyword">if</span> <span class="token builtin class-name">hash</span> <span class="token function">awk</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">IP_TO_UNREGISTER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> route get <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $(NF-2);exit}'</span><span class="token variable">`</span></span>     <span class="token comment"># using awk</span>
<span class="token keyword">else</span>
        <span class="token assign-left variable">IP_TO_UNREGISTER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> route get <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f</span> <span class="token number">3</span> -d<span class="token string">&quot; &quot;</span><span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-1</span><span class="token variable">`</span></span>        <span class="token comment"># simpler alternative for when awk is not available</span>
<span class="token keyword">fi</span>

<span class="token function">curl</span> <span class="token parameter variable">-kL</span> <span class="token parameter variable">-u</span> <span class="token string">&quot;<span class="token variable">${EPORTAL_API_PASSWORD}</span>&quot;</span><span class="token string">':'</span><span class="token string">&quot;<span class="token variable">${EPORTAL_API_PASSWORD}</span>&quot;</span> <span class="token parameter variable">-X</span> POST <span class="token string">&quot;<span class="token variable">${EPORTAL_URL}</span>&quot;</span><span class="token string">'/admin/api/delete_server?ip='</span><span class="token string">&quot;<span class="token variable">${IP_TO_UNREGISTER}</span>&quot;</span>
</code></pre></div><p>Example (unregister_server.sh):</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">EPORTAL_API_USERNAME</span><span class="token operator">=</span>admin
<span class="token assign-left variable">EPORTAL_API_PASSWORD</span><span class="token operator">=</span>admin
<span class="token assign-left variable">EPORTAL_URL</span><span class="token operator">=</span><span class="token string">'http://192.168.246.110'</span>

<span class="token comment">#this is taken from the primary ip in the system. If you want to pick a different one, adjust the next line.</span>
<span class="token keyword">if</span> <span class="token builtin class-name">hash</span> <span class="token function">awk</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">IP_TO_UNREGISTER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> route get <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $(NF-2);exit}'</span><span class="token variable">`</span></span>     <span class="token comment"># using awk</span>
<span class="token keyword">else</span>
        <span class="token assign-left variable">IP_TO_UNREGISTER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> route get <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f</span> <span class="token number">3</span> -d<span class="token string">&quot; &quot;</span><span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-1</span><span class="token variable">`</span></span>        <span class="token comment"># simpler alternative for when awk is not available</span>
<span class="token keyword">fi</span>

<span class="token function">curl</span> <span class="token parameter variable">-kL</span> <span class="token parameter variable">-u</span> <span class="token string">&quot;<span class="token variable">${EPORTAL_API_PASSWORD}</span>&quot;</span><span class="token string">':'</span><span class="token string">&quot;<span class="token variable">${EPORTAL_API_PASSWORD}</span>&quot;</span> <span class="token parameter variable">-X</span> POST <span class="token string">&quot;<span class="token variable">${EPORTAL_URL}</span>&quot;</span><span class="token string">'/admin/api/delete_server?ip='</span><span class="token string">&quot;<span class="token variable">${IP_TO_UNREGISTER}</span>&quot;</span>
</code></pre></div><h3 id="puppet-plan"><a href="#puppet-plan" class="header-anchor">#</a> Puppet Plan</h3> <p>If you prefer to have a plan rather than a task, then you can create one from this script with the following steps:</p> <ul><li>Create a new directory called <code>eportal_puppet</code></li> <li>Inside this directory, create a bolt project:<div class="language- extra-class"><pre class="language-text"><code>bolt project init
</code></pre></div></li> <li>Create a scripts directory inside it</li> <li>Place the script above inside of it (call it <code>unregister_server.sh</code>)</li> <li>Create the bolt plan using:<div class="language- extra-class"><pre class="language-text"><code>bolt plan new eportal_puppet::unregister_server --script eportal_puppet/scripts/unregister_server.sh
</code></pre></div></li> <li>Now your plan is ready and can be called directly with:<div class="language- extra-class"><pre class="language-text"><code>bolt plan run eportal_puppet:unregister_server -t &lt;TARGETS&gt;
</code></pre></div></li></ul> <p>Ad hoc run example with:</p> <div class="language- extra-class"><pre class="language-text"><code>bolt plan run eportal_puppet::unregister_server -t 192.168.246.110
</code></pre></div><p>This can be called during machine tear down to properly remove the server from ePortal.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cloudlinux/tux-care-doc/edit/dev/docs/eportal-api/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></div> <div class="back-to-top" data-v-c64d4a1e><a class="nav-arrow top back-to-top__link" data-v-c64d4a1e></a></div> </div> <div class="footer" data-v-671babf6><div data-v-671babf6><a href="https://cloudlinux.com" data-v-671babf6><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-671babf6></a></div> <div class="footer-company-title" data-v-671babf6>2023. CloudLinux Inc</div> <div data-v-671babf6><div data-v-671babf6><a href="https://tuxcare.com/faq/" target="_blank" data-v-671babf6>FAQ</a></div><div data-v-671babf6><a href="https://tuxcare.com/support-portal/" target="_blank" data-v-671babf6>Support portal</a></div><div data-v-671babf6><a href="https://blog.tuxcare.com/" target="_blank" data-v-671babf6>Blog</a></div></div> <div class="social" data-v-671babf6><span class="footer-social-text" data-v-671babf6>Stay in touch</span> <a href="https://www.facebook.com/TuxCare" target="_blank" data-v-671babf6><img src="/fb.png" class="footer-social-logo" data-v-671babf6></a><a href="https://twitter.com/TuxCare_" target="_blank" data-v-671babf6><img src="/tw.png" class="footer-social-logo" data-v-671babf6></a><a href="https://www.linkedin.com/showcase/tuxcare" target="_blank" data-v-671babf6><img src="/in.png" class="footer-social-logo" data-v-671babf6></a><a href="https://www.youtube.com/channel/UCr4GTupdSlC33wfwAGk3jsA/%20Fa" target="_blank" data-v-671babf6><img src="/ytube.png" class="footer-social-logo" data-v-671babf6></a></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3560baa2.js" defer></script><script src="/assets/js/4.fa87bcbc.js" defer></script><script src="/assets/js/1.8d9e0a6b.js" defer></script><script src="/assets/js/23.ab830d32.js" defer></script>
  </body>
</html>
