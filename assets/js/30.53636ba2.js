(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{311:function(s,t,a){"use strict";a.r(t);var e=a(14),r=Object(e.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"eportal-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eportal-api"}},[s._v("#")]),s._v(" ePortal API")]),s._v(" "),a("p",[s._v("以下のコマンドで、API使用のための別のePortalアカウントを作成する必要がある場合があります。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kc.eportal user -a api-user -p <password>\n")])])]),a("p",[s._v("Basic認証を介してHTTP API資格情報を渡すことができると、SSO/LDAP設定に役立つ場合があります。")]),s._v(" "),a("p",[s._v("一般に、ePortal APIは構成管理が簡単で、冪等性があります。既存の状態を確認するのに追加のリクエストを行う必要はありません。たとえば、存在しないエンティティを削除したとしても、エラーは発生しません。また、エンティティの作成／変更は、単一のリクエストで実行され、問題なく、容易にご希望の最終状態を得ることができます。")]),s._v(" "),a("h2",{attrs:{id:"サーバーのリスト表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#サーバーのリスト表示"}},[s._v("#")]),s._v(" サーバーのリスト表示")]),s._v(" "),a("p",[a("strong",[s._v("GET /admin/api/servers")])]),s._v(" "),a("p",[s._v("さまざまな基準でサーバーをフィルタリングして、リストを反復処理して、サーバー数を取得します。")]),s._v(" "),a("p",[s._v("読み取り専用のユーザー権限のBasic認証が必要です。")]),s._v(" "),a("p",[a("strong",[s._v("クエリ文字列パラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("hostname")]),s._v("：String（オプション）。パターンとマッチするホスト名のサーバーを返します。パターンには、任意の文字列にマッチする%プレースホルダーを含めることができます。")]),s._v(" "),a("li",[a("code",[s._v("ip")]),s._v("：String（オプション）。パターンとマッチするIPのサーバーを返します。パターンには、任意の文字列に一致するプレースホルダーを含めることができます。")]),s._v(" "),a("li",[a("code",[s._v("feed")]),s._v("：String（オプション）。フィードに接続されたサーバーを返します。デフォルトフィードにはmainを使用してください。")]),s._v(" "),a("li",[a("code",[s._v("key")]),s._v("：String（オプション）。キーに登録されているサーバーを返します。")]),s._v(" "),a("li",[a("code",[s._v("registered_age")]),s._v("：Integer（オプション）。"),a("code",[s._v("registered_age")]),s._v("日前よりも前に登録されたサーバーを返します。"),a("code",[s._v("registered_age")]),s._v("が負の値の場合、"),a("code",[s._v("-registered_age")]),s._v("日前以降に登録されたサーバーを返します。例えば、"),a("code",[s._v("registered_age=-3")]),s._v("の場合は、3日前以降に登録されたサーバーを返すことになります。hサフィックスを追加して、時間を指定できます。"),a("code",[s._v("registered_age=4h")]),s._v("の場合は、4時間前よりも前に登録されたサーバーを選択します。")]),s._v(" "),a("li",[a("code",[s._v("checkin_age")]),s._v("：Integer（オプション）。"),a("code",[s._v("checkin_age")]),s._v("日前よりも前にチェックインを送信したサーバーを返します。負の値の場合は、"),a("code",[s._v("registered_age")]),s._v("を参照してください。")]),s._v(" "),a("li",[a("code",[s._v("updated_age")]),s._v("：Integer（オプション）。updated_age日前よりも前にパッチをロードしたサーバーを返します。負の値の場合は、"),a("code",[s._v("registered_age")]),s._v("を参照してください。")]),s._v(" "),a("li",[a("code",[s._v("is_updated")]),s._v("：Boolean（オプション）。"),a("code",[s._v("true")]),s._v("の場合、利用可能な最新のパッチに更新されているサーバーを返します。"),a("code",[s._v("false")]),s._v("の場合、最新のパッチが適用されていないサーバーを返します。")]),s._v(" "),a("li",[a("code",[s._v("limit")]),s._v("：Integer（オプション）。結果を指定されたエントリ数に制限します。デフォルトでは、"),a("code",[s._v("limit")]),s._v("は10です。")]),s._v(" "),a("li",[a("code",[s._v("offset")]),s._v("：Integer（オプション）。結果を指定された開始位置に設定します。"),a("code",[s._v("limit")]),s._v("とoffsetを使用して、結果を反復処理できます。")]),s._v(" "),a("li",[a("code",[s._v("only_count")]),s._v("：Boolean（オプション）。サーバー数のみを返します。")]),s._v(" "),a("li",[a("code",[s._v("tag")]),s._v("：String（オプション）。サーバータグによるフィルターを追加します。例："),a("code",[s._v("tag=env:test")]),s._v("または"),a("code",[s._v("tag=ubuntu")]),s._v(".")])]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"limit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"offset"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"99c97tz44uKX13b5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ip"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.51.16.72"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hostname"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost.localdomain"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"some-key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"feed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registered"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-04-08 16:43:23.907671"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"checkin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-07-12 17:35:56.065077"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"updated"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-06-01 16:37:03.000000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"euname"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.10.0-1160.25.1.el7"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// effective kernel version")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"release"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.10.0-957.5.1.el7.x86_64"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// installed kernel version")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"kernel_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9647204d2708cad906a75944ee56ac68fc5b5704"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"patch_level"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"patch_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tags"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"uptime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6394092")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#1 SMP Fri Feb 1 14:54:57 UTC 2019"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"virt"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kvm"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"kcare_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2.44-2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"distro"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CentOS Linux"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"distro_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.6.1810"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"machine"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x86_64"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"processor"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x86_64"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        ...\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"ホストの登録"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ホストの登録"}},[s._v("#")]),s._v(" ホストの登録")]),s._v(" "),a("p",[a("strong",[s._v("POST /admin/api/register")])]),s._v(" "),a("p",[s._v("指定されたキーとホスト名でホストを登録します。")]),s._v(" "),a("p",[a("strong",[s._v("フォーム（URLエンコードされた）パラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("key")]),s._v("：String（必須）。登録に使用するePortalキー。")]),s._v(" "),a("li",[a("code",[s._v("hostname")]),s._v("：String（オプション）。使用するサーバーのホスト名。")])]),s._v(" "),a("p",[a("strong",[s._v("成功した場合の応答（200）：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"server_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"some-server-id"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("エラーの場合の応答（400）：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"error"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error code"')]),s._v(" # invalid-key | key-limit-reached\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('curl -X POST https://eportal.corp.com/admin/api/register -F key=test\n{"server_id":"lw1MO1Du5sF3Cj39"}\n')])])]),a("h2",{attrs:{id:"ホストの登録解除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ホストの登録解除"}},[s._v("#")]),s._v(" ホストの登録解除")]),s._v(" "),a("p",[a("strong",[s._v("POST /admin/api/delete_server")])]),s._v(" "),a("p",[s._v("IPまたはホスト名で登録済みサーバーを削除します。")]),s._v(" "),a("p",[s._v("管理者ユーザー権限によるBasic認証が必要です。")]),s._v(" "),a("p",[a("strong",[s._v("クエリ文字列パラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("hostname")]),s._v("：String（オプション）。削除するサーバーのホスト名。")]),s._v(" "),a("li",[a("code",[s._v("ip")]),s._v("：String（オプション）。削除するサーバーのIP。")])]),s._v(" "),a("p",[s._v("エンドポイントには、少なくとも1つのパラメータ（ホスト名またはIP）が必要です。")]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("p",[s._v("応答には、削除されたサーバー数が含まれています。")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("例えば、")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl --user admin:admin-password -X POST https://eportal.corp.com/admin/api/delete_server?ip=192.168.1.1\n")])])]),a("p",[s._v("以下は、さまざまなCM製品で"),a("code",[s._v("/admin/api/delete_server")]),s._v("エンドポイントを使用する例です。注意：API経由で削除するには、ホストIPまたはホスト名が必要です。以下の方法のいずれかを使用する方が便利です。")]),s._v(" "),a("ul",[a("li",[s._v("（稼働している）ホストへのアクセス権がある場合、"),a("code",[s._v("kcarectl --unregister")]),s._v("を呼び出してホストを削除する方がはるかに簡単です。")]),s._v(" "),a("li",[s._v("ホストがすでに破棄されている場合は、一括で"),a("a",{attrs:{href:"#clean-inactive-servers"}},[s._v("非アクティブサーバーのクリーンアップ")]),s._v("を使用することを検討できます。")])]),s._v(" "),a("h3",{attrs:{id:"ansible-playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-playbook"}},[s._v("#")]),s._v(" Ansible playbook")]),s._v(" "),a("p",[s._v("ePortal APIアクセスをAnsibleと統合できるようになりました。kernelcareエージェントを呼び出してタスクを実行する代わりに、ePortalを直接呼び出して同じ結果を得ることができます。")]),s._v(" "),a("p",[s._v("API Playbookを使用して、KernelCareエージェントを登録解除します。")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("- hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kernelcare\n  vars"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    eportal_srv"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//eportal.address.here[:port if needed]")]),s._v("\n\n  tasks"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    - name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" unregister kernelcare agent through API\n      uri"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ eportal_srv }}/admin/api/delete_server?ip={{ ansible_default_ipv4.address|default(ansible_all_ipv4_addresses[0]) }}"')]),s._v("\n        method"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" POST\n        user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" your-api-user\n        password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" your-api-user-password\n        force_basic_auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" yes\n")])])]),a("p",[s._v("例えば、")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("- hosts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kernelcare\n  vars"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    eportal_srv"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//192.168.246.110")]),s._v("\n\n  tasks"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    - name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" unregister kernelcare agent through API\n      uri"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ eportal_srv }}/admin/api/delete_server?ip={{ ansible_default_ipv4.address|default(ansible_all_ipv4_addresses[0]) }}"')]),s._v("\n        method"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" POST\n        user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" api-user\n        password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" dummy\n        force_basic_auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" yes\n")])])]),a("p",[s._v("以下のコマンドをアドホック実行します。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ansible-playbook -u ansible  ./kernelcare.yml\n")])])]),a("p",[s._v("マシンのティアダウン中にこのコマンドを呼び出して、ePortalから適切にサーバーを削除できます。")]),s._v(" "),a("h3",{attrs:{id:"chefのrecipe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chefのrecipe"}},[s._v("#")]),s._v(" Chefのrecipe")]),s._v(" "),a("p",[s._v("Chefのような自動化ツールとより緊密に統合することは、KernelCareとePortalのような関連ツールにとって常に目標でした。以下のrecipeは、delete_server APIを使用して、ティアダウン中にePortalから正確にサーバーを削除する方法を示しています。このrecipeは、他のrecipeと統合して、手動操作を回避できます。")]),s._v(" "),a("p",[s._v("APIを使用して、KernelCareエージェントを登録解除するrecipe：")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("eportal_url = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EPORTAL URL"')]),s._v("\neportal_user = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EPORTAL API USER NAME"')]),s._v("\neportal_password = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EPORTAL API USER PASSWORD"')]),s._v("\n\n# the ip to unregister can be pulled automatically from the system where the recipe is applied"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" or specified manually (by replacing the following line with a simple assignment)\nip_to_unregister = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"#{node['network']['interfaces'][node['network']['default_interface']]['addresses'].select{|k,v| v['family'] == \"")]),s._v("inet"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"}.keys.first}"')]),s._v("\n\n\nhttp_request "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kernelcare-unregister-api"')]),s._v(" do\n  url "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{eportal_url}/admin/api/delete_server?ip=#{ip_to_unregister}"')]),s._v("\n  action "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("post\n  headers("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("'AUTHORIZATION' => \"Basic #"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Base64.encode64("),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{eportal_user}:#{eportal_password}"')]),s._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(")\nend\n")])])]),a("p",[s._v("例（kernelcare-unregister-api.rb）：")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("eportal_url = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.246.110"')]),s._v("\neportal_user = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"api-user"')]),s._v("\neportal_password = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dummy"')]),s._v("\n\nip_to_unregister = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"#{node['network']['interfaces'][node['network']['default_interface']]['addresses'].select{|k,v| v['family'] == \"")]),s._v("inet"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"}.keys.first}"')]),s._v("\n\nhttp_request "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kernelcare-unregister-api"')]),s._v(" do\n  url "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{eportal_url}/admin/api/delete_server?ip=#{ip_to_unregister}"')]),s._v("\n  action "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("post\n  headers("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("'AUTHORIZATION' => \"Basic #"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Base64.encode64("),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{eportal_user}:#{eportal_password}"')]),s._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(")\nend\n")])])]),a("p",[s._v("以下をアドホック実行します。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("chef-apply kernelcare-unregister-api.rb\n")])])]),a("p",[s._v("出力：")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("Recipe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" (chef-apply cookbook)"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("(chef-apply recipe)\n  * http_request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kernelcare-unregister-api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" action post\n    - http_request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kernelcare-unregister-api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST to http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//192.168.246.110/admin/api/delete_server?ip=192.168.246.40")]),s._v("\n")])])]),a("p",[s._v("マシンのティアダウン中にこのコマンドを呼び出して、ePortalから適切にサーバーを削除できます。")]),s._v(" "),a("h3",{attrs:{id:"puppetのタスク"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#puppetのタスク"}},[s._v("#")]),s._v(" Puppetのタスク")]),s._v(" "),a("p",[s._v("Puppetは、対象のシステムでタスクを実行するためのフレームワークを提供しています。以下は、そのようなタスクとして実行できるbashスクリプトで、delete_server APIを使用して、ティアダウン中にePortalから正確にサーバーを削除する方法を示しています。他の削除スクリプトやタスクと統合して、手動操作を回避できます。")]),s._v(" "),a("p",[s._v("API呼び出しを介してKernelCareエージェントを登録解除します。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EPORTAL_API_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("your ePortal api user name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EPORTAL_API_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("your ePortal api user password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EPORTAL_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your ePortal URL'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#this is taken from the primary ip in the system. If awk is available, it is used, but a fallback using other common tools is also provided")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IP_TO_UNREGISTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" route get "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $(NF-2);exit}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# using awk")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IP_TO_UNREGISTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" route get "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# simpler alternative for when awk is not available")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-kL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EPORTAL_API_PASSWORD}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EPORTAL_API_PASSWORD}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EPORTAL_URL}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/admin/api/delete_server?ip='")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IP_TO_UNREGISTER}")]),s._v('"')]),s._v("\n")])])]),a("p",[s._v("例（unregister_server.sh）：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EPORTAL_API_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EPORTAL_API_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EPORTAL_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.246.110'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#this is taken from the primary ip in the system. If you want to pick a different one, adjust the next line.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IP_TO_UNREGISTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" route get "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $(NF-2);exit}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# using awk")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IP_TO_UNREGISTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" route get "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -d"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# simpler alternative for when awk is not available")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-kL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EPORTAL_API_PASSWORD}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EPORTAL_API_PASSWORD}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" POST "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EPORTAL_URL}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/admin/api/delete_server?ip='")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IP_TO_UNREGISTER}")]),s._v('"')]),s._v("\n")])])]),a("h3",{attrs:{id:"puppetのプラン"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#puppetのプラン"}},[s._v("#")]),s._v(" Puppetのプラン")]),s._v(" "),a("p",[s._v("タスクではなくプランの作成をご希望の場合は、以下の手順でこのスクリプトから作成できます。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("eportal_puppet")]),s._v("という新しいディレクトリを作成します")]),s._v(" "),a("li",[s._v("このディレクトリ内に、以下のコマンドでboltプロジェクトを作成します"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("bolt project init\n")])])])]),s._v(" "),a("li",[s._v("その中にスクリプトディレクトリを作成します")]),s._v(" "),a("li",[s._v("その中に上記のスクリプトを配置します（このスクリプトを"),a("code",[s._v("unregister_server.sh")]),s._v("と呼びます）")]),s._v(" "),a("li",[s._v("以下を使用して、boltのプランを作成します"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("bolt plan new eportal_puppet::unregister_server --script eportal_puppet/scripts/unregister_server.sh\n")])])])]),s._v(" "),a("li",[s._v("これでプランができました。以下の方法で直接呼び出すことができます。"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("bolt plan run eportal_puppet:unregister_server -t <TARGETS>\n")])])])])]),s._v(" "),a("p",[s._v("アドホック実行の例：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("bolt plan run eportal_puppet::unregister_server -t 192.168.246.110\n")])])]),a("p",[s._v("マシンのティアダウン中にこのコマンドを呼び出して、ePortalから適切にサーバーを削除できます。")]),s._v(" "),a("h2",{attrs:{id:"フィードの作成-変更"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#フィードの作成-変更"}},[s._v("#")]),s._v(" フィードの作成／変更")]),s._v(" "),a("p",[a("strong",[s._v("POST /admin/api/feeds/")])]),s._v(" "),a("p",[s._v("フィードが既に存在する場合は、リクエストによってフィードが変更されます。")]),s._v(" "),a("p",[s._v("書き込み権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("クエリ文字列／フォーム／JSONパラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("name")]),s._v("：String（必須）。作成または変更されたフィードの名前。")]),s._v(" "),a("li",[a("code",[s._v("auto")]),s._v("：Boolean（オプション）。自動更新プロパティを設定します。デフォルトでは、falseです。")]),s._v(" "),a("li",[a("code",[s._v("deploy_after")]),s._v("：Integer（オプション）。遅延期間を時間単位で設定します。デフォルトでは、0（遅延なし）です。")])]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test-feed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"auto"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"deploy_after"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -X POST -u admin -d name=test-feed -d auto=true https://eportal.corp.com/admin/api/feeds/\n")])])]),a("h2",{attrs:{id:"フィードのリスト表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#フィードのリスト表示"}},[s._v("#")]),s._v(" フィードのリスト表示")]),s._v(" "),a("p",[a("strong",[s._v("GET /admin/api/feeds/")])]),s._v(" "),a("p",[s._v("既存のフィードのリストを返します。注意："),a("code",[s._v("main")]),s._v("フィードは常に存在し、変更できません。")]),s._v(" "),a("p",[s._v("読み取り権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"auto"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"deploy_after"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"feed-name"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    ...\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -u admin https://eportal.corp.com/admin/api/feeds/\n")])])]),a("h2",{attrs:{id:"フィードの削除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#フィードの削除"}},[s._v("#")]),s._v(" フィードの削除")]),s._v(" "),a("p",[a("strong",[s._v("DELETE /admin/api/feeds/:feed-name")])]),s._v(" "),a("p",[s._v("書き込み権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// number of deleted records, 0 if there is no such feed.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -X DELETE -u admin https://eportal.corp.com/admin/api/feeds/test-feed\n")])])]),a("h2",{attrs:{id:"登録キーの作成-変更"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登録キーの作成-変更"}},[s._v("#")]),s._v(" 登録キーの作成／変更")]),s._v(" "),a("p",[a("strong",[s._v("POST /admin/api/keys/")])]),s._v(" "),a("p",[s._v("キーがすでに存在する場合は、リクエストによってキーが変更されます。")]),s._v(" "),a("p",[s._v("書き込み権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("クエリ文字列／フォーム／JSONパラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("key")]),s._v("：String（オプション）。作成または変更されたキーの名前。空の場合は、ランダムキーが生成されます。")]),s._v(" "),a("li",[a("code",[s._v("feed")]),s._v("：String（オプション）。接続されたフィードの名前。デフォルトでは、"),a("code",[s._v("main")]),s._v("です。")]),s._v(" "),a("li",[a("code",[s._v("note")]),s._v("：String（オプション）。キーの説明。")]),s._v(" "),a("li",[a("code",[s._v("server_limit")]),s._v("：Integer（オプション）。キーに登録できる最大ホスト数の推奨制限。")])]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"feed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"feed-name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"note"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"some-note"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"server_limit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -X POST -u admin -d key=test-key -d feed=test-feed https://eportal.corp.com/admin/api/keys/\n")])])]),a("h2",{attrs:{id:"キーのリスト表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#キーのリスト表示"}},[s._v("#")]),s._v(" キーのリスト表示")]),s._v(" "),a("p",[a("strong",[s._v("GET /admin/api/keys/")])]),s._v(" "),a("p",[s._v("既存のキーのリストを返します。")]),s._v(" "),a("p",[s._v("読み取り権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"feed"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"note"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"server_limit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    ...\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -u admin https://eportal.corp.com/admin/api/keys/\n")])])]),a("h2",{attrs:{id:"キーの削除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#キーの削除"}},[s._v("#")]),s._v(" キーの削除")]),s._v(" "),a("p",[a("strong",[s._v("DELETE /admin/api/keys/:key")])]),s._v(" "),a("p",[s._v("書き込み権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// number of deleted records, 0 if there is no such key.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -X DELETE -u admin https://eportal.corp.com/admin/api/keys/test-key\n")])])]),a("h2",{attrs:{id:"パッチセットのリスト表示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#パッチセットのリスト表示"}},[s._v("#")]),s._v(" パッチセットのリスト表示")]),s._v(" "),a("p",[a("strong",[s._v("GET /admin/api/patchsets/")])]),s._v(" "),a("p",[s._v("エンドポイントには、フィードと製品で利用可能なパッチセットがリスト表示されます。最も古いパッチセットから最も新しいパッチセットの順に表示されます。")]),s._v(" "),a("p",[s._v("読み取り権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("クエリ文字列パラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("feed")]),s._v("：String（オプション）。パッチセットをリスト表示するフィードの名前。デフォルトでは、"),a("code",[s._v("main")]),s._v("です。")]),s._v(" "),a("li",[a("code",[s._v("product")]),s._v("：String（オプション）。可能な値は、"),a("code",[s._v("kernel")]),s._v("、"),a("code",[s._v("user")]),s._v("、"),a("code",[s._v("qemu")]),s._v("、dbです。指定された製品のパッチストアを選択します。デフォルトでは、"),a("code",[s._v("kernel")]),s._v("です。")])]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"patchset"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patchset-name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// possible values are: enabled, disabled, not-downloaded, undeployed")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    ...\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -u admin 'https://eportal.corp.com/admin/api/patchsets/?feed=main&product=kernel'\n")])])]),a("h2",{attrs:{id:"パッチセットの管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#パッチセットの管理"}},[s._v("#")]),s._v(" パッチセットの管理")]),s._v(" "),a("p",[a("strong",[s._v("POST /admin/api/patchsets/manage")])]),s._v(" "),a("p",[s._v("パッチセットでデプロイアクションの実行を許可します。")]),s._v(" "),a("p",[s._v("書き込み権限が必要で、Basic認証を受け入れます。")]),s._v(" "),a("p",[a("strong",[s._v("クエリ文字列パラメータ：")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("patchset")]),s._v("：String（必須）。操作するパッチセットの名前。")]),s._v(" "),a("li",[a("code",[s._v("feed")]),s._v("：String（必須）。操作するフィードの名前。複数回指定できます。")]),s._v(" "),a("li",[a("code",[s._v("action")]),s._v("：String（必須）。実行する操作：\n"),a("ul",[a("li",[a("code",[s._v("enable")]),s._v("：指定したパッチセットを有効にします。")]),s._v(" "),a("li",[a("code",[s._v("disable")]),s._v("：指定したパッチセットを無効にします。")]),s._v(" "),a("li",[a("code",[s._v("enable-upto")]),s._v("：指定されたパッチセットまでの（より古い）すべてのパッチセットを有効にします。")]),s._v(" "),a("li",[a("code",[s._v("undeploy-downto")]),s._v("：指定されたパッチセットまでの（より新しい）すべてのパッチセットをアンデプロイします。")])])]),s._v(" "),a("li",[a("code",[s._v("product")]),s._v("：String（オプション）。可能な値は、"),a("code",[s._v("kernel")]),s._v("、"),a("code",[s._v("user")]),s._v("、"),a("code",[s._v("qemu")]),s._v("、"),a("code",[s._v("db")]),s._v("です。指定された製品のパッチストアを選択します。デフォルトでは、kernelです。")])]),s._v(" "),a("p",[a("strong",[s._v("応答：")])]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"result"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ok"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("strong",[s._v("例：")])]),s._v(" "),a("p",[s._v("mainフィードとtest-feedフィードで、libcareパッチセット"),a("code",[s._v("U20200506_01")]),s._v("を有効にします。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("curl -X POST -u admin 'https://eportal.corp.com/admin/api/patchsets/manage?patchset=U20200506_01&feed=main&feed=test-feed&product=user&action=enable'\n")])])])])},[],!1,null,null,null);t.default=r.exports}}]);