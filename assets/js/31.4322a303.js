(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{312:function(a,e,t){"use strict";t.r(e);var s=t(14),r=Object(s.a)({},function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"eportal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportal"}},[a._v("#")]),a._v(" ePortal")]),a._v(" "),t("p",[a._v("TuxCare ePortalは、KernelCare Enterpriseライブ パッチ管理専用のWeb管理コンソールです。")]),a._v(" "),t("p",[a._v("ePortalソフトウェアは、ファイアウォールの内側にある（つまり、インターネットにアクセスできない）サーバーを保護するのに役立ちます。また、オンプレミスにもクラウドにもインストールできます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-overview.svg",alt:"Overview"}})]),a._v(" "),t("h2",{attrs:{id:"eportalハードウェア要件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportalハードウェア要件"}},[a._v("#")]),a._v(" ePortalハードウェア要件")]),a._v(" "),t("p",[t("strong",[a._v("ディスク")])]),a._v(" "),t("ul",[t("li",[a._v("最小100 GB、推奨200 GB（キャッシュモードの場合は、20 GB）")]),a._v(" "),t("li",[a._v("100 IOPS以上のSSD")])]),a._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[a._v("SSDベースのストレージは、ePortalサーバーに必須の要件です。")])]),t("p",[t("strong",[a._v("CPU")])]),a._v(" "),t("p",[a._v("その他の要件に関して、以下の構成と接続サーバー数をテストしました。")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("以下の要件では、最大接続マシン数は10kです。")]),a._v(" "),t("ul",[t("li",[a._v("VM")]),a._v(" "),t("li",[a._v("1 vCPU")]),a._v(" "),t("li",[a._v("1 GB RAM")])])]),a._v(" "),t("li",[t("p",[a._v("以下の要件では、最大接続マシン数は75kです。")]),a._v(" "),t("ul",[t("li",[a._v("Core i5")]),a._v(" "),t("li",[a._v("1 CPU")]),a._v(" "),t("li",[a._v("4 GB RAM")])])])]),a._v(" "),t("h2",{attrs:{id:"インストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール"}},[a._v("#")]),a._v(" インストール")]),a._v(" "),t("p",[a._v("ePortalは、CentOS 7/8、AlmaLinux 8、Ubuntu 20.04/22.04などのEL7/8ベースのディストリビューションの64bit版と互換性があります。")]),a._v(" "),t("h3",{attrs:{id:"rhelベースのディストリビューション"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rhelベースのディストリビューション"}},[a._v("#")]),a._v(" RHELベースのディストリビューション")]),a._v(" "),t("p",[a._v("ePortalをインストールして実行するには、NginxのWebサーバーが必要です。Nginxの公式リポジトリからインストールした安定版を使用することをお勧めします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cat > /etc/yum.repos.d/nginx.repo <<EOL\n[nginx]\nname=nginx stable repo\nbaseurl=http://nginx.org/packages/centos/\\$releasever/\\$basearch/\ngpgcheck=1\nenabled=1\ngpgkey=https://nginx.org/keys/nginx_signing.key\nmodule_hotfixes=true\nEOL\n")])])]),t("p",[a._v("詳細については、 "),t("a",{attrs:{href:"https://nginx.org/en/linux_packages.html#stable",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://nginx.org/en/linux_packages.html#stable"),t("OutboundLink")],1),a._v(" を参照してください。")]),a._v(" "),t("p",[a._v("ePortalリポジトリをセットアップします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cat > /etc/yum.repos.d/kcare-eportal.repo <<EOL\n[kcare-eportal]\nname=KernelCare ePortal\nbaseurl=https://www.repo.cloudlinux.com/kcare-eportal/\\$releasever/\\$basearch/\nenabled=1\ngpgkey=https://repo.cloudlinux.com/kernelcare/RPM-GPG-KEY-KernelCare\ngpgcheck=1\nEOL\n")])])]),t("p",[a._v("ePortalをインストールします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("yum install -y kcare-eportal\n")])])]),t("h3",{attrs:{id:"ubuntu-20-04"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-20-04"}},[a._v("#")]),a._v(" Ubuntu 20.04")]),a._v(" "),t("p",[a._v("ePortalリポジトリをセットアップします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt-get install -y --no-install-recommends curl ca-certificates\n\ncurl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg\n\ncat > /etc/apt/sources.list.d/kcare-eportal.list <<EOL\ndeb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/20.04 focal main\nEOL\n")])])]),t("p",[a._v("ePortalをインストールします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt-get update && apt-get install -y --no-install-recommends kcare-eportal\n")])])]),t("h3",{attrs:{id:"ubuntu-22-04"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-22-04"}},[a._v("#")]),a._v(" Ubuntu 22.04")]),a._v(" "),t("p",[a._v("ePortalリポジトリをセットアップします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt-get install -y --no-install-recommends curl ca-certificates\n\ncurl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg\n\ncat > /etc/apt/sources.list.d/kcare-eportal.list <<EOL\ndeb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/22.04 jammy main\nEOL\n")])])]),t("p",[a._v("ePortalをインストールします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("apt-get update && apt-get install -y --no-install-recommends kcare-eportal\n")])])]),t("h2",{attrs:{id:"キャッシュモード"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#キャッシュモード"}},[a._v("#")]),a._v(" キャッシュモード")]),a._v(" "),t("p",[a._v("キャッシュモードを使用すると、ディスク使用要件が大幅に緩和され、最初のダウンロード手順が迅速に行われます。")]),a._v(" "),t("p",[a._v("キャッシュモードでは、ePortalはパッチセットに関する軽量のメタ情報のみをダウンロードして、KernelCareエージェントからパッチサーバー（パッチソース）にパッチリクエストをプロキシします。ダウンロードされたパッチバイナリは2週間キャッシュされ、以下のリクエストでePortalから直接アクセスできるので、パブリックインターネットの帯域幅を消費しません。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-cache-mode.svg",alt:"Cache mode"}})]),a._v(" "),t("h3",{attrs:{id:"キャッシュモードの有効化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#キャッシュモードの有効化"}},[a._v("#")]),a._v(" キャッシュモードの有効化")]),a._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("に")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("CACHE_MODE = True\n")])])]),t("p",[a._v("の設定を追加します")]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("ePortalを再起動します")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("systemctl restart eportal\n")])])])])]),a._v(" "),t("p",[a._v("既存のインストールの場合は、既存のパッチセット用メタ情報を再取得する必要があります。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kcare/kc.eportal cache-mode --fetch-meta\n")])])]),t("h3",{attrs:{id:"キャッシュモードの無効化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#キャッシュモードの無効化"}},[a._v("#")]),a._v(" キャッシュモードの無効化")]),a._v(" "),t("ol",[t("li",[t("p",[t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("内で")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("CACHE_MODE = True\n")])])])])]),a._v(" "),t("p",[a._v("を削除またはコメントアウトします")]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("不足しているパッチセットをダウンロードします")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kcare/kc.eportal kcare download-missing\n")])])])]),a._v(" "),t("li",[t("p",[a._v("ePortalを再起動します")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("systemctl restart eportal\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"プロキシ設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#プロキシ設定"}},[a._v("#")]),a._v(" プロキシ設定")]),a._v(" "),t("p",[a._v("ePortalは、お客様のプロキシサーバー経由でパッケージとパッチを取得することができます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-with-proxy.svg",alt:"Proxy"}})]),a._v(" "),t("p",[a._v("ePortalマシンでは、コマンドラインで使用するのと同じプロキシ設定を定義する必要があります。")]),a._v(" "),t("p",[a._v("これを行うには、"),t("code",[a._v("PROXY = 'http://example.com:3128'")]),a._v("を"),t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("に追加します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo -e \"\\nPROXY = 'http://example.com:3128'\" >> /etc/eportal/config\n")])])]),t("p",[a._v("ePortalは、"),t("code",[a._v("socks5://")]),a._v("プロキシスキームを介してSOCKS5プロキシをサポートしています。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("PROXY = 'socks5://example.com:1080'\n")])])]),t("p",[a._v("ePortalを再起動します（"),t("a",{attrs:{href:"#stopping-starting"}},[a._v("停止と開始")]),a._v("欄を参照し、対応するOSを選択してください）。")]),a._v(" "),t("h2",{attrs:{id:"認証設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#認証設定"}},[a._v("#")]),a._v(" 認証設定")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th"),a._v(" "),t("th")])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("code",[a._v("AUTH_RESTRICTED_INDEX")])]),a._v(" "),t("td",[a._v("登録ユーザーのみインデックスページへのアクセスを許可します")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("AUTH_PASSWORD_MIN_LENGTH")])]),a._v(" "),t("td",[a._v("最小パスワード長。デフォルトでは5")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("AUTH_SESSION_LIFETIME")])]),a._v(" "),t("td",[a._v("セッションの有効期間秒数。デフォルトでは、セッションはブラウザを閉じるまで続きます")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("AUTH_REFRESH_SESSION")])]),a._v(" "),t("td",[t("code",[a._v("False")]),a._v("（デフォルト）の場合、ログインから有効期間秒数経過後、セッションが期限切れになります。"),t("code",[a._v("True")]),a._v("の場合、非アクティブな状態が有効期間秒数継続後、セッションが期限切れになります。")])])])]),a._v(" "),t("p",[t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("にて構成を設定できます。")]),a._v(" "),t("h2",{attrs:{id:"ユーザーの管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ユーザーの管理"}},[a._v("#")]),a._v(" ユーザーの管理")]),a._v(" "),t("p",[t("code",[a._v("kc.eportal user")]),a._v("ユーティリティを使用して、ポータルを管理できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("usage: kc.eportal user [-h] [-a] [-c] [-d] [-p PASSWORD] [-r {admin,readonly}] [--note NOTE] [user]\n\nlist available users by default\n\npositional arguments:\n  user                  user name\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a                    action: add new user\n  -c                    action: change user\n  -d                    action: delete user\n  -p PASSWORD, --password PASSWORD\n  -r {admin,readonly}, --role {admin,readonly}\n  --note NOTE           description\n")])])]),t("p",[a._v("ユーザーを追加するには、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal user -a -p AdminPassword admin\n")])])]),t("p",[a._v("ユーザーのパスワードを変更するには、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal user -c -p NewPassword admin\n")])])]),t("p",[a._v("ユーザーを読み取り専用に設定するには、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal user -c -r readonly admin\n")])])]),t("h2",{attrs:{id:"ldapを使用した認証"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ldapを使用した認証"}},[a._v("#")]),a._v(" LDAPを使用した認証")]),a._v(" "),t("p",[a._v("ePortalはバインド操作を介したLDAP認証をサポートしています。すべてのユーザーに、バインドリクエストを実行できるDNが必要です。ePortalはユーザーを同期しないので、LDAPサーバーにアクセスするために特別なDN／パスワードを設定する必要はありません。")]),a._v(" "),t("h3",{attrs:{id:"構成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#構成"}},[a._v("#")]),a._v(" 構成")]),a._v(" "),t("p",[a._v("LDAP構成設定は、"),t("code",[a._v("Settings / LDAP")]),a._v("ナビゲーション項目内で利用できます。")]),a._v(" "),t("h4",{attrs:{id:"url"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url"}},[a._v("#")]),a._v(" URL")]),a._v(" "),t("p",[a._v("接続するLDAPサーバーのホスト、ポート、プロトコルを指定します。")]),a._v(" "),t("p",[a._v("フォーマットは、"),t("code",[a._v("<scheme>://<host>[:port][?params]")]),a._v("です。")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("scheme")]),a._v(":\n"),t("ul",[t("li",[t("code",[a._v("ldap")]),a._v("：認証済みの暗号化されたTLS接続。安全でない接続を使用するには、tls=0を指定できます。")]),a._v(" "),t("li",[t("code",[a._v("ldaps")]),a._v("：SSL接続。")])])]),a._v(" "),t("li",[t("strong",[a._v("host")]),a._v("：ご利用のLDAPサーバーのホスト名またはIP。")]),a._v(" "),t("li",[t("strong",[a._v("port")]),a._v("：カスタムポート。デフォルトでは、ldapスキーム用は389、ldapsスキーム用は636です。")]),a._v(" "),t("li",[t("strong",[a._v("params")]),a._v(":\n"),t("ul",[t("li",[t("code",[a._v("strict_check=0")]),a._v("：厳密なSSL証明書の認証を有効／無効にします（デフォルトでは有効です）。")]),a._v(" "),t("li",[t("code",[a._v("tls=0")]),a._v("：接続時のTLSハンドシェイクを有効／無効にします（デフォルトでは有効です）。")]),a._v(" "),t("li",[t("code",[a._v("timeout=30")]),a._v("：LDAPサーバー接続タイムアウト（秒単位。デフォルトでは5です）。")])])])]),a._v(" "),t("p",[a._v("例えば、")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("ldap://ldap.forumsys.com?tls=0&timeout=30")]),a._v("：接続タイムアウトが30秒の、安全ではない接続を使用します。")])]),a._v(" "),t("h4",{attrs:{id:"接続文字列-dnテンプレート"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#接続文字列-dnテンプレート"}},[a._v("#")]),a._v(" 接続文字列（DNテンプレート）")]),a._v(" "),t("p",[a._v("接続文字列は、LDAPバインド操作で使用されるDNテンプレートです。すべての"),t("code",[a._v("%")]),a._v("sテンプレートプレースホルダーは、ログインフォームから取得したユーザー名に置き換えられます。")]),a._v(" "),t("p",[a._v("例えば、"),t("code",[a._v("uid=%s,dc=example,dc=com")]),a._v("です。")]),a._v(" "),t("p",[a._v("一部のLDAP実装は、バインドリクエスト用の追加のテンプレートをサポートしています。")]),a._v(" "),t("ul",[t("li",[a._v("Active Directoryは、"),t("code",[a._v("%s@example.com")]),a._v("テンプレートを受け入れます。")]),a._v(" "),t("li",[t("code",[a._v("cn=%s,dc=example,dc=com")]),a._v("または"),t("code",[a._v("email=%s,dc=example,dc=com")]),a._v("も有効な場合があります。")])]),a._v(" "),t("h4",{attrs:{id:"フィルター"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#フィルター"}},[a._v("#")]),a._v(" フィルター")]),a._v(" "),t("p",[a._v("フィルターは追加オプションの設定で、追加のLDAP検索要求向けパラメーターを指定して、ePortalにアクセスできるユーザーを制限します。通常は、ユーザーが所属するグループの確認です。検索の結果、空でない値が返されると、ユーザーは認証済みとみなされます。")]),a._v(" "),t("p",[t("code",[a._v("<base>??<scope>?<filter>")]),a._v("というフォーマットは、"),t("a",{attrs:{href:"https://tools.ietf.org/html/rfc2255",target:"_blank",rel:"noopener noreferrer"}},[a._v("The LDAP URL Format RFC"),t("OutboundLink")],1),a._v("の一部です。")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("base")]),a._v("：検索ベース。検索実行の起点となるルートノード。")]),a._v(" "),t("li",[t("strong",[a._v("scope")]),a._v("：検索範囲。\n"),t("ul",[t("li",[t("code",[a._v("base")]),a._v("：ベースのみを検索します（デフォルト）。")]),a._v(" "),t("li",[t("code",[a._v("one")]),a._v("：直接の子のみ（ベースから1階層下）を検索します。")]),a._v(" "),t("li",[t("code",[a._v("sub")]),a._v("：ツリー全体を検索します。")])])]),a._v(" "),t("li",[t("strong",[a._v("filter")]),a._v("：適用する検索フィルター。")])]),a._v(" "),t("p",[a._v("例 "),t("code",[a._v("dc=example,dc=com??one?(&(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))")])]),a._v(" "),t("p",[a._v("注意。"),t("code",[a._v("Filter")]),a._v("設定でも、"),t("code",[a._v("%s")]),a._v("プレースホルダーを使用できます。"),t("code",[a._v("%s")]),a._v("は、ログインフォームから取得したユーザー名に置き換えられます。")]),a._v(" "),t("h3",{attrs:{id:"ログイン処理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ログイン処理"}},[a._v("#")]),a._v(" ログイン処理")]),a._v(" "),t("p",[a._v("ユーザーがePortalにログインすると、ePortalは最初にローカルデータベース内のユーザー資格情報を確認します。資格情報が見つかった場合、ユーザーは認証されます。ユーザー資格情報が見つからなかった場合にのみ、ePortalからLDAPにリダイレクトされます。")]),a._v(" "),t("p",[a._v("LDAP認証情報で初めてePortalにログインする場合、デフォルトで、データベースにユーザーが作成されます。ユーザー名はLDAPユーザー名、権限は読み取り専用、説明はLDAPになります。（("),t("code",[a._v("https://<eportal>/admin/user/")]),a._v("）。")]),a._v(" "),t("p",[a._v("以下の画像では、"),t("code",[a._v("kc.eportal")]),a._v("コマンドラインインターフェイスで作成された1ユーザーと、LDAP資格情報でログインした2ユーザーが表示されています。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportalLDAPusers.png",alt:""}})]),a._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[a._v("注意。すべての新しいLDAPユーザーの権限は、読み取り専用です。"),t("code",[a._v("User edit")]),a._v("ページにて、"),t("code",[a._v("Readonly")]),a._v("フィールドをオフにすることで、管理者権限を設定できます。")])]),t("h3",{attrs:{id:"基本設定例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本設定例"}},[a._v("#")]),a._v(" 基本設定例")]),a._v(" "),t("p",[a._v("この例と次の例は、LDAPパブリックテストサーバー "),t("a",{attrs:{href:"https://www.forumsys.com/tutorials/integration-how-to/ldap/online-ldap-test-server/",target:"_blank",rel:"noopener noreferrer"}},[a._v("ldap.forumsys.com"),t("OutboundLink")],1),a._v(" に基づいています。")]),a._v(" "),t("p",[a._v("ユーザーのリストは、以下のとおりです。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(objectClass=person)' dn\ndn: uid=tesla,dc=example,dc=com\ndn: uid=gauss,dc=example,dc=com\n...\n")])])]),t("p",[a._v("基本設定では、提供されたユーザー名／パスワードがディレクトリサービスにバインド可能かどうかの確認のみが行われます。注意：すべての新規ユーザーには、読み取り専用権限があります。そのため、すべてのLDAPユーザーにePortalへのログインを安全に許可して、個別に適切な権限を設定できます。")]),a._v(" "),t("p",[a._v("基本的な設定では、"),t("code",[a._v("Url")]),a._v("と"),t("code",[a._v("Connection string")]),a._v("の設定を入力する必要があります。")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("設定")]),a._v(" "),t("th",[a._v("値")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("URL")]),a._v(" "),t("td",[a._v("ldap://ldap.forumsys.com?tls=0")])]),a._v(" "),t("tr",[t("td",[a._v("Connection string")]),a._v(" "),t("td",[a._v("uid=%s,dc=example,dc=com")])])])]),a._v(" "),t("p",[a._v("その後、"),t("code",[a._v("gauss:password")]),a._v("または"),t("code",[a._v("tesla:password")]),a._v("の資格情報を使用してログインできます。")]),a._v(" "),t("h3",{attrs:{id:"フィルター設定例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#フィルター設定例"}},[a._v("#")]),a._v(" フィルター設定例")]),a._v(" "),t("p",[a._v("フィルターを使用すると、ePortalへのログインを許可された一連のユーザー（例："),t("code",[a._v("mathematicians")]),a._v("グループに属するユーザー）を制限できます。")]),a._v(" "),t("p",[a._v("以下が、グループの例です。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(objectClass=groupOfUniqueNames)' dn\ndn: ou=mathematicians,dc=example,dc=com\ndn: ou=scientists,dc=example,dc=com\n...\n")])])]),t("p",[a._v("そして、以下が"),t("code",[a._v("mathematicians")]),a._v("グループの属性です。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(ou=mathematicians)'\ndn: ou=mathematicians,dc=example,dc=com\nuniqueMember: uid=euclid,dc=example,dc=com\nuniqueMember: uid=riemann,dc=example,dc=com\nuniqueMember: uid=euler,dc=example,dc=com\nuniqueMember: uid=gauss,dc=example,dc=com\nuniqueMember: uid=test,dc=example,dc=com\nou: mathematicians\ncn: Mathematicians\nobjectClass: groupOfUniqueNames\nobjectClass: top\n")])])]),t("p",[a._v("許可されたユーザーを制限するためのePortal LDAP設定は以下のとおりです。")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("設定")]),a._v(" "),t("th",[a._v("値")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("URL")]),a._v(" "),t("td",[a._v("ldap://ldap.forumsys.com?tls=0")])]),a._v(" "),t("tr",[t("td",[a._v("Filter")]),a._v(" "),t("td",[a._v("dc=example,dc=com??one?(&(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))")])]),a._v(" "),t("tr",[t("td",[a._v("Connection string")]),a._v(" "),t("td",[a._v("uid=%s,dc=example,dc=com")])])])]),a._v(" "),t("p",[a._v("フィルターの考え方は、ログインしようとするユーザーのDNと等しい"),t("code",[a._v("uniqueMember")]),a._v("属性を持つ"),t("code",[a._v("mathematicians")]),a._v("グループを見つけることです。")]),a._v(" "),t("p",[a._v("その後、"),t("code",[a._v("gauss:password")]),a._v("資格情報を使用してログインできます。ただし、"),t("code",[a._v("tesla:password")]),a._v("資格情報ではログインできません。")]),a._v(" "),t("h2",{attrs:{id:"eportalへのアクセス"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportalへのアクセス"}},[a._v("#")]),a._v(" ePortalへのアクセス")]),a._v(" "),t("p",[a._v("KernelCare.ePortal管理コンソールにアクセスするには、"),t("strong",[a._v("http://YOUR_IP/admin")]),a._v(" に接続します。")]),a._v(" "),t("p",[a._v("そして、ユーザー名とパスワードを入力します")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/access_eportal.png",alt:""}})]),a._v(" "),t("p",[t("a",{attrs:{href:"#managing-users"}},[a._v("kc.eportalツール")]),a._v("を使用してログイン情報を管理できます。")]),a._v(" "),t("h2",{attrs:{id:"パッチセットの展開"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#パッチセットの展開"}},[a._v("#")]),a._v(" パッチセットの展開")]),a._v(" "),t("p",[a._v("ePortalには、最新のパッチをダウンロードするメカニズムが組み込まれています。使用を開始するには、まずePortalナビゲーションバーのSettingsリンクをクリックし、次にPatch Sourceをクリックします。アクセスするには、 "),t("a",{attrs:{href:"mailto:sales@tuxcare.com"}},[a._v("sales@tuxcare.com")]),a._v(" に連絡して、ご利用のePortalアクセス資格情報をリクエストしてください。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-edit-patch-source.png",alt:""}})]),a._v(" "),t("p",[a._v("ディスク容量とネットワーク帯域幅の要件を緩和するために、ディストリビューションを限定して取得するように選択できます。")]),a._v(" "),t("p",[a._v("パッチソースアクセス情報を設定すると、利用可能なパッチセットのリストを閲覧できます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-dashboard.png",alt:""}})]),a._v(" "),t("ul",[t("li",[t("p",[t("strong",[a._v("Usage")]),a._v("：任意のフィードで特定のパッチセットを使用しているサーバー数。数字をクリックすると、パッチセットを使用しているサーバーのリストが表示されます。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Patchsets")]),a._v("：パッチセットの名前。名前をクリックすると、パッチセットの変更ログが表示されます。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Feed name")]),a._v("：セルには、特定のフィードでのパッチセットの展開とサーバーの使用状況が表示されます。数字をクリックして、サーバー一覧をフィルターすることもできます。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Manage")]),a._v("：ダイアログを開いて、パッチセットを有効／無効にできます。")])])]),a._v(" "),t("h3",{attrs:{id:"パッチセットページの管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#パッチセットページの管理"}},[a._v("#")]),a._v(" パッチセットページの管理")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-manage.png",alt:""}})]),a._v(" "),t("p",[a._v("このダイアログでは、対応するフィードでどのパッチセットを有効／無効にするかを制御できます。")]),a._v(" "),t("ul",[t("li",[t("p",[t("strong",[a._v("Enable all up to this patchset")]),a._v("：このパッチセットまでのすべてのパッチセット（"),t("strong",[a._v("disabled")]),a._v("を除く）を有効にするアクション。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Enable")]),a._v("：現在のパッチセットのみを有効にするアクション。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Disable")]),a._v("：現在のパッチセットのみを無効にするアクション。無効化されたパッチセットは、"),t("strong",[a._v("Enable all up to this patchset")]),a._v("アクションによる自動更新や一括有効化の影響がありません。")])])]),a._v(" "),t("p",[a._v("CLIからパッチセットを展開するには、以下を実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal --unroll 16012017_1\n")])])]),t("h3",{attrs:{id:"自動更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自動更新"}},[a._v("#")]),a._v(" 自動更新")]),a._v(" "),t("p",[a._v("Settings→Feedsからご希望のフィードでAutoupdateを有効にすることで、自動更新の設定ができます。")]),a._v(" "),t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[t("strong",[a._v("デフォルトフィード")]),a._v("は、Settingsページでは自動更新を受信するように設定できません。"),t("strong",[a._v("デフォルトフィード")]),a._v("の自動更新の設定については、次の欄を参照してください。")])]),t("h3",{attrs:{id:"デフォルトフィードの自動更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#デフォルトフィードの自動更新"}},[a._v("#")]),a._v(" デフォルトフィードの自動更新")]),a._v(" "),t("p",[a._v("cronジョブを作成することによって、デフォルトフィードの自動更新を設定できます。自動更新を受信するには、以下のコマンドが使用できます。")]),a._v(" "),t("p",[a._v("以下のコマンドは、最新のパッチが利用可能かどうかを判断し、"),t("strong",[a._v("デフォルトフィード")]),a._v("にインストールします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal --get-latest\n")])])]),t("h3",{attrs:{id:"ファイルからリリースをデプロイするスクリプト"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ファイルからリリースをデプロイするスクリプト"}},[a._v("#")]),a._v(" ファイルからリリースをデプロイするスクリプト")]),a._v(" "),t("p",[a._v("ePortalサーバーをKernelCareパッチサーバーに接続して、パッチセットを直接ダウンロードする機会がない場合は、手動で行うことができます。")]),a._v(" "),t("p",[a._v("既にダウンロード済みのパッチセットの場所があり、アップロードする最新のパッチセットファイルの選択をご希望の場合は、お持ちのアーカイブのリストを"),t("code",[a._v("/usr/share/kcare-eportal/arch/")]),a._v("フォルダの内容と比較できます。")]),a._v(" "),t("p",[a._v("その後、選択したパッチセットをePortalサーバーにアップロードして、それぞれのパッチセットに対して"),t("code",[a._v("kc.eportal --deploy")]),a._v("コマンドを実行します。")]),a._v(" "),t("h4",{attrs:{id:"例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例"}},[a._v("#")]),a._v(" 例")]),a._v(" "),t("p",[a._v("ePortalのテストインスタンスと本番インスタンスの違いを見てみましょう。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("comm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-23")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" eportal-test "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ls /usr/share/kcare-eportal/arch/K*.tar.bz2"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sort")]),a._v(" -h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" eportal-prod "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ls /usr/share/kcare-eportal/arch/K*.tar.bz2"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sort")]),a._v(" -h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" patchsets.diff\n")])])]),t("p",[a._v("本番環境にパッチセットをアップロードします。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" patchsets.diff "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("xargs")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Phav")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-iv")]),a._v(" eportal-test:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" /tmp/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Phav")]),a._v(" /tmp/K*.tar.bz2 eportal-prod:/tmp/\n")])])]),t("p",[a._v("パッチセットファイル名をパラメーターとして、展開ツールを実行します。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" eportal-prod "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'ls /tmp/K*.tar.bz2 | sort -h | xargs -n1 kc.eportal kcare deploy'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-12-02 01:25:06,555 - eportal.patches - INFO - K04082020_1 was enabled "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" main\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[a._v("上記の手順は、他のすべてのタイプのパッチセット（libcareやqemuなど）に対して個別に実行する必要があることに注意してください。"),t("code",[a._v("kc.eportal libcare deploy")]),a._v("などの対応するファイルプレフィックスとコマンドを使用してください。")])]),t("h3",{attrs:{id:"古いリリースをクリーンする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#古いリリースをクリーンする"}},[a._v("#")]),a._v(" 古いリリースをクリーンする")]),a._v(" "),t("p",[a._v("月1回、提供済みパッチのリストは縮小されます（より新しいバージョンがある古いパッチは除外されます）が、リソースはePortalマシンから削除されません。リソースの削除は、ePortal管理者が行います。ePortalのディスク領域を解放するために、古いリリースのリソースを削除することができます。")]),a._v(" "),t("p",[a._v("どのリリースが削除されるかを確認するには、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("DRY_RUN=1 kc.eportal --clean-releases\n")])])]),t("p",[a._v("古いリリースを削除するには、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal --clean-releases\n")])])]),t("h2",{attrs:{id:"libcareパッチセットの展開"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#libcareパッチセットの展開"}},[a._v("#")]),a._v(" LibCareパッチセットの展開")]),a._v(" "),t("p",[a._v("バージョン1.18以降、ePortalはLibCareのパッチセット管理をサポートしています。パッチセット管理は、"),t("code",[a._v("Patches / LibCare")]),a._v("ナビゲーション項目からアクセスできます。LibCareパッチは同じパッチソース資格情報を使用しているので、追加の設定を行う必要はありません。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-libcare-feed.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"最新のパッチセットをインストールするcli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最新のパッチセットをインストールするcli"}},[a._v("#")]),a._v(" 最新のパッチセットをインストールするCLI")]),a._v(" "),t("p",[a._v("デフォルトフィードを更新するには、以下のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal libcare update\n")])])]),t("p",[t("code",[a._v("test")]),a._v("フィードを更新するには、以下のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal libcare update --feed test\n")])])]),t("p",[a._v("すべての自動フィードを更新するには、以下のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal libcare auto-update\n")])])]),t("h3",{attrs:{id:"アーカイブからパッチセットを展開するcli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#アーカイブからパッチセットを展開するcli"}},[a._v("#")]),a._v(" アーカイブからパッチセットを展開するCLI")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ kc.eportal libcare deploy --help\nusage: kc.eportal libcare deploy [-h] [--feed FEED] [--disabled] archive\n\npositional arguments:\n  archive      path to archive\n\noptional arguments:\n  -h, --help   show this help message and exit\n  --feed FEED  feed to deploy archive to\n  --disabled   do not enable patchset after deploy\n")])])]),t("p",[a._v("例えば、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal libcare deploy --feed test /tmp/U20210129_02.tar.bz2\n")])])]),t("p",[a._v("このコマンドは、"),t("code",[a._v("U20210129_02")]),a._v("パッチセットを"),t("code",[a._v("test")]),a._v("フィードに展開して、有効にします。")]),a._v(" "),t("h2",{attrs:{id:"qemuパッチセットの展開"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qemuパッチセットの展開"}},[a._v("#")]),a._v(" QEMUパッチセットの展開")]),a._v(" "),t("p",[a._v("バージョン1.25以降、ePortalはQEMUのパッチセット管理をサポートしています。パッチセット管理は、"),t("code",[a._v("Patches / QEMUcare")]),a._v("ナビゲーション項目からアクセスできます。QEMUパッチは同じパッチソース資格情報を使用しているので、追加の設定を行う必要はありません。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-qemu-feed.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"最新のパッチセットをインストールするcli-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最新のパッチセットをインストールするcli-2"}},[a._v("#")]),a._v(" 最新のパッチセットをインストールするCLI")]),a._v(" "),t("p",[a._v("デフォルトフィードを更新するには、以下のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal qemu update\n")])])]),t("p",[t("code",[a._v("test")]),a._v("フィードを更新するには、以下のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal qemu update --feed test\n")])])]),t("p",[a._v("すべての自動フィードを更新するには、以下のコマンドを実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal qemu auto-update\n")])])]),t("h3",{attrs:{id:"アーカイブからパッチセットをデプロイするcli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#アーカイブからパッチセットをデプロイするcli"}},[a._v("#")]),a._v(" アーカイブからパッチセットをデプロイするCLI")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ kc.eportal qemu deploy --help\nusage: kc.eportal qemu deploy [-h] [--feed FEED] [--disabled] archive\n\npositional arguments:\n  archive      path to archive\n\noptional arguments:\n  -h, --help   show this help message and exit\n  --feed FEED  feed to deploy archive to\n  --disabled   do not enable patchset after deploy\n")])])]),t("p",[a._v("例えば、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal qemu deploy --feed test /tmp/U20210818_01-qemu.tar.bz2\n")])])]),t("p",[a._v("このコマンドは、"),t("code",[a._v("U20210818_01-qemu")]),a._v("パッチセットを"),t("code",[a._v("test")]),a._v("フィードに展開して、有効にします。")]),a._v(" "),t("h2",{attrs:{id:"キーの管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#キーの管理"}},[a._v("#")]),a._v(" キーの管理")]),a._v(" "),t("p",[a._v("新しいサーバーを登録するには、サーバー登録に使用されるKernelCareキーを作成する必要があります。キーのリストに移動するには、"),t("em",[a._v("Keys")]),a._v("ナビゲーション項目をクリックします。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/key-menu_zoom70.png",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("キーを編集するには、"),t("img",{attrs:{src:"/images/eportal_keys_edit.png",alt:""}}),a._v(". をクリックします。 編集タブが開きます。")]),a._v(" "),t("li",[a._v("キーを削除するには、"),t("img",{attrs:{src:"/images/eportal_keys_remove.png",alt:""}}),a._v(". をクリックします。キーを削除すると、そのキーで登録されているすべてのサーバーが削除されることに注意してください。")]),a._v(" "),t("li",[a._v("キーをクリックすると、そのキーで"),t("a",{attrs:{href:"#managing-servers"}},[a._v("登録されているサーバー")]),a._v("のリストがあるServersタブに移動します。そのタブでサーバーを削除することもできます。")])]),a._v(" "),t("p",[a._v("新しい登録を作成するには、"),t("em",[a._v("Create")]),a._v("タブをクリックします。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/key-creation_zoom70.png",alt:""}})]),a._v(" "),t("p",[a._v("以下のフィールドに入力します。")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("Key")]),a._v(" — キーの値を入力できます。フィールドを空にしておくこともできますが、その場合は自動生成されたキーが使用されます。")]),a._v(" "),t("li",[t("strong",[a._v("Description")]),a._v(" — キーの説明を入力できます。")]),a._v(" "),t("li",[t("strong",[a._v("Server Limit")]),a._v(" — そのキーで登録できるサーバー数。")]),a._v(" "),t("li",[t("strong",[a._v("Feed")]),a._v(" — 特定のフィードを選択するか、空のままにします。")])]),a._v(" "),t("p",[a._v("キーを追加するには、"),t("em",[a._v("Save")]),a._v("をクリックします。新しい登録キーが作成され、リストに追加されます。まさにこのキーが、個々のサーバーで登録コマンドの一部として使用されます。")]),a._v(" "),t("p",[a._v("このキーを保存し、別のキーを追加するには、"),t("em",[a._v("Save and Add Another")]),a._v("をクリックします。")]),a._v(" "),t("p",[a._v("キーを追加し、キー編集タブを開くには、"),t("em",[a._v("Save and Continue Editing")]),a._v("をクリックします。")]),a._v(" "),t("p",[a._v("新しいキーを追加せずにキーのリストのタブに戻るには、"),t("em",[a._v("Cancel")]),a._v("をクリックします。")]),a._v(" "),t("h3",{attrs:{id:"キーを管理するcli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#キーを管理するcli"}},[a._v("#")]),a._v(" キーを管理するCLI")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ kc.eportal key --help\nusage: kc.eportal key [-h] [-a] [-c] [--note NOTE]\n                      [--server-limit SERVER_LIMIT] [--feed FEED]\n                      [key]\n\nlist available keys by default\n\npositional arguments:\n  key                   key name\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a                    action: add new key\n  -c                    action: change key\n  --note NOTE           key description\n  --server-limit SERVER_LIMIT\n                        maximum number of servers allowed\n  --feed FEED           feed to associate key to\n")])])]),t("p",[a._v("キーのリストを表示します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal key\n")])])]),t("p",[a._v("キーを自動生成します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal key -a\n")])])]),t("p",[a._v("値を指定して、キーを作成します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal key -a test\n")])])]),t("p",[a._v("フィードをキーに設定します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal key -c test --feed test\n")])])]),t("h2",{attrs:{id:"サーバーの管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#サーバーの管理"}},[a._v("#")]),a._v(" サーバーの管理")]),a._v(" "),t("p",[t("a",{attrs:{href:"#managing-keys"}},[a._v("キーの管理")]),a._v("インターフェイスでキー自体をクリックすると、そのキーで登録されたサーバーを閲覧できます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/server_list_1_zoom70.png",alt:""}})]),a._v(" "),t("p",[a._v("この画面には、そのキーで登録されているサーバー、サーバーのIP、ホスト名、有効なカーネル、登録時刻、最後のチェックイン時刻が表示されます。")]),a._v(" "),t("p",[a._v("特定のキー関連付けられているすべてのサーバーIDのリストを閲覧するには、以下を実行します。")]),a._v(" "),t("ul",[t("li",[a._v("UIで、キーのリストがあるページに移動します。次に、特定のキーをクリックします。このキーに関連付けられているサーバーのリストが表示されます。")])]),a._v(" "),t("p",[a._v("どのキーにも関連付けられていないすべてのサーバーIDのリストを閲覧するには、ナビゲーションバーの"),t("em",[a._v("Servers")]),a._v("ボタンを使用します。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/eportal-servers.png",alt:""}})]),a._v(" "),t("p",[a._v("また、CLIを使用して、キーのペアと実行中のサーバー数を閲覧できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ kc.eportal --list-servers\nCount | Key\n----- + --------------------------------\n    0 | 2shcolu7Y1x6885Q\n    2 | 6J89aS44j6OmTr05\n")])])]),t("h3",{attrs:{id:"非アクティブなサーバーのクリーンアップ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非アクティブなサーバーのクリーンアップ"}},[a._v("#")]),a._v(" 非アクティブなサーバーのクリーンアップ")]),a._v(" "),t("p",[a._v("30日を超えて非アクティブなサーバーは、以下のコマンドを使用して削除できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ kc.eportal server clean --inactive\n2 servers were deleted\n")])])]),t("p",[a._v("非アクティブなサーバーのクリーンアップは、毎日またはそれ以下の頻度で自動的に行うことができます。毎日の自動クリーンアップを有効にするには、"),t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("内に、オプション"),t("code",[a._v("CLEAN_INACTIVE_SERVERS_PERIOD = 3600 * 24")]),a._v("（秒単位の値）を追加します。")]),a._v(" "),t("h3",{attrs:{id:"管理uiで拡張チェックイン統計を表示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理uiで拡張チェックイン統計を表示"}},[a._v("#")]),a._v(" 管理UIで拡張チェックイン統計を表示")]),a._v(" "),t("p",[a._v("開始ページに新しい表が追加されます。この表には、以下の情報が表示されます。")]),a._v(" "),t("ul",[t("li",[a._v("総サーバー数。")]),a._v(" "),t("li",[a._v("過去48時間にチェックインしたサーバー数。")])]),a._v(" "),t("p",[a._v("各キーのサーバー数は、"),t("em",[a._v("Keys")]),a._v("ページに一覧表示されます。")]),a._v(" "),t("h2",{attrs:{id:"フィード管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#フィード管理"}},[a._v("#")]),a._v(" フィード管理")]),a._v(" "),t("p",[a._v("フィードの目的は、サーバー上のパッチセットの管理です。フィードを使用すれば、パッチセットを特定のキーにバインドすることができます。考えられる使用例は、パッチの事前テスト、同様のハードウェアのサーバーのグループへの更新の適用などです。")]),a._v(" "),t("p",[a._v("フィード管理インターフェイスに入るには、Settings → Feedsに移動します。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/feed-button_zoom70.png",alt:""}})]),a._v(" "),t("p",[a._v("このページでは、ユーザーは既存のフィードを管理（作成、削除、編集）できます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/feed-menu_zoom70.png",alt:""}})]),a._v(" "),t("p",[a._v("利用可能なオプション：")]),a._v(" "),t("ul",[t("li",[a._v("Name — フィードの名前。")]),a._v(" "),t("li",[a._v("Auto update — このフィードへのパッチの自動ダウンロードを有効または無効にします。")]),a._v(" "),t("li",[a._v("Deploy after X hours — パッチセットが展開可能になってから、フィードにインストールされるまでの時間単位の遅延。")])]),a._v(" "),t("p",[a._v("ePortalは、10分ごとにメインのパッチサーバーで新しいパッチがないかどうか確認します。新しいパッチが利用可能な場合は、ePortalサーバーにアップロードされます。注：パッチはアップロードされますが、展開はされません。パッチの利用可能時間は、新しいパッチがePortalに表示された時点から開始するとみなされ、Deploy after X hoursオプションでは、その時刻が考慮されます。そのため、ユーザーが"),t("code",[a._v("Deploy after X hours = 10")]),a._v("のように設定すると、パッチはePortalサーバーにダウンロードされてから10時間後にフィードに展開されます。")]),a._v(" "),t("p",[a._v("フィードを直ちに自動更新して、新しいパッチがePortalで利用可能になった直後にフィードにロードされるようにするには、"),t("code",[a._v("Deploy after X hours = 0")]),a._v("を設定します。")]),a._v(" "),t("p",[a._v("特別な場合は、ePortalが新しいサーバーにインストールされた際のクリーンインストールです（パッチのあるダウンロード済みアーカイブや、デフォルトフィードなど展開されたパッチセットがあるフィードはありません）。この場合、ユーザーが新しいフィードを作成し、Deploy after X hoursオプションをすぐに設定すると、すべてのパッチ（利用できる最も古いパッチから最新のパッチまで）が指定されたX時間後にフィードに展開されます。これは、アーカイブが最初からダウンロードされ、「ePortalに表示された直後」とみなされるためです。つまり、すべてのパッチのePortal表示時刻が同じになり、Deploy after X hoursオプションは無効になります。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/feedmanagement3_zoom70.png",alt:""}})]),a._v(" "),t("p",[a._v("ePortalのメインページで、ユーザーは対応するキーとフィードのペアを設定できます。これは、キー作成インターフェイスにて、またはキーの編集時に行われます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/feedmanagement4_zoom70.png",alt:""}})]),a._v(" "),t("p",[a._v("デフォルトでは、新しいキーはデフォルトフィードにバインドされます。その代わりに、ユーザーはドロップダウンメニューからご希望のフィードを選択することもできます。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/feedmanagement5_01_zoom70.png",alt:""}})]),a._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[a._v("フィードを削除すると、そのフィードに関連付けられているすべてのキーがデフォルトフィードに移動されます。")])]),t("p",[t("img",{attrs:{src:"/images/feedmanagement6_zoom70.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"フィードを管理するcli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#フィードを管理するcli"}},[a._v("#")]),a._v(" フィードを管理するCLI")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("~$ kc.eportal feed --help\nusage: kc.eportal feed [-h] [-a] [-c] [--auto] [--no-auto]\n                       [--deploy-after hours]\n                       [feed]\n\nlist available feeds by default\n\npositional arguments:\n  feed                  feed name\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -a                    action: add new feed\n  -c                    action: change feed\n  --auto                update feed automatically\n  --no-auto             don't update feed automatically\n  --deploy-after hours  deploy after specified hours\n")])])]),t("p",[a._v("フィードのリストを表示します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal feed\n")])])]),t("p",[a._v("自動更新フィードを追加します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal feed -a test --auto\n")])])]),t("p",[a._v("フィードを遅延フィードに変更します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal feed -c test --deploy-after 12\n")])])]),t("h2",{attrs:{id:"特別なタグフィールドの追加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#特別なタグフィールドの追加"}},[a._v("#")]),a._v(" 特別なタグフィールドの追加")]),a._v(" "),t("p",[a._v("サーバーに特別なタグフィールドを追加するには、以下を実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kcarectl --tag command\n")])])]),t("p",[a._v("ここで、"),t("code",[a._v("command")]),a._v("はユーザー定義パラメーターです。このパラメーターは、UIでサーバー用に表示されます。ユーザーは、各サーバー用に複数のタグを追加できます。各タグは;記号で区切る必要があります。")]),a._v(" "),t("p",[a._v("例えば、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('kcarectl --tag "env:prod;ubuntu"\n')])])]),t("p",[a._v("このサーバーには、"),t("code",[a._v("env:prod")]),a._v("と"),t("code",[a._v("ubuntu")]),a._v("の2つのタグがあります。")]),a._v(" "),t("p",[t("code",[a._v("env:prod")]),a._v("は、タグ名"),t("code",[a._v("env")]),a._v("と値"),t("code",[a._v("prod")]),a._v("を持つパラメーターです。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/addingextratagfield_zoom88.png",alt:""}})]),a._v(" "),t("p",[a._v("特定のサーバーからすべてのタグを削除するには、以下を実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('kcarectl --tag ""\n')])])]),t("p",[a._v("ここで、"),t("code",[a._v('""')]),a._v("は以前に定義したタグを削除するためのパラメーターです。")]),a._v(" "),t("h2",{attrs:{id:"httpsを使用するようにeportalを設定する方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#httpsを使用するようにeportalを設定する方法"}},[a._v("#")]),a._v(" HTTPSを使用するようにePortalを設定する方法")]),a._v(" "),t("p",[a._v("以下が、ePortalが展開されているサーバーの前提です。")]),a._v(" "),t("h3",{attrs:{id:"eportalパブリックnginx-webサーバーでのtlsの終了"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportalパブリックnginx-webサーバーでのtlsの終了"}},[a._v("#")]),a._v(" ePortalパブリックnginx WebサーバーでのTLSの終了")]),a._v(" "),t("ol",[t("li",[a._v("ファイアウォールは、443ポートへの接続を許可しています。")]),a._v(" "),t("li",[a._v("秘密鍵と公開鍵がサーバーにダウンロードされています。")])]),a._v(" "),t("ul",[t("li",[a._v("証明書に従って、SSL設定テンプレートを編集します。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mv /etc/nginx/eportal.ssl.conf.example /etc/nginx/eportal.ssl.conf\nvi /etc/nginx/eportal.ssl.conf\n")])])]),t("ul",[t("li",[a._v("この設定をメインの設定に含めます。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("sed -e '3iinclude eportal.ssl.conf;' -i /etc/nginx/conf.d/eportal.conf\n")])])]),t("ul",[t("li",[a._v("nginxを再起動します。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("service nginx restart\n")])])]),t("h3",{attrs:{id:"外部バランサーでのtlsの終了"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#外部バランサーでのtlsの終了"}},[a._v("#")]),a._v(" 外部バランサーでのTLSの終了")]),a._v(" "),t("p",[a._v("お好みのリバースプロキシサーバーを使用して、TLSトラフィックを終了し、リクエストをePortalインスタンスに転送できます。要件は、正しい"),t("code",[a._v("Host")]),a._v("ヘッダーと"),t("code",[a._v("X-Forwarded-Proto")]),a._v("ヘッダーを提供することのみです。")]),a._v(" "),t("p",[a._v("たとえば、バランサnginxのconfigは以下のとおりです。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("server {\n   listen       443 ssl;\n   server_name  your-eportal-domain;\n\n   # ssl stuff ...\n   # ssl_certificate  ...\n   # ssl_certificate_key ...\n\n   location / {\n      proxy_pass http://eportal-instance-address;\n      proxy_set_header Host $http_host;\n      proxy_set_header X-Forwarded-Proto https;\n   }\n}\n")])])]),t("h3",{attrs:{id:"エージェント設定の更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#エージェント設定の更新"}},[a._v("#")]),a._v(" エージェント設定の更新")]),a._v(" "),t("p",[a._v("httpsに更新されたePortalと通信するには、IPがハードコーディングされたサーバー設定の場合、すべてのサーバーのKernelCare構成ファイルを修正する必要があります。")]),a._v(" "),t("p",[a._v("変更を行うには、"),t("code",[a._v("PATCH_SERVER")]),a._v("と"),t("code",[a._v("REGISTRATION_URL")]),a._v("オプションを更新します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi /etc/sysconfig/kcare/kcare.conf\n")])])]),t("p",[a._v("つまり、編集後に、以下の例のように、"),t("code",[a._v("/etc/sysconfig/kcare/kcare.conf")]),a._v("には更新された環境変数"),t("code",[a._v("PATCH_SERVER")]),a._v("と"),t("code",[a._v("REGISTRATION_URL")]),a._v("が含まれている必要があります。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("PATCH_SERVER=https://eportal_domain_name/\nREGISTRATION_URL=https://eportal_domain_name/admin/api/kcare\n")])])]),t("p",[a._v("別の方法として、パッチサーバーアドレスを更新するのに、ePortalの特別なエンドポイントを使用できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("curl -s https://eportal_domain_name/set-patch-server | bash\n")])])]),t("h2",{attrs:{id:"高可用性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高可用性"}},[a._v("#")]),a._v(" 高可用性")]),a._v(" "),t("p",[a._v("バージョン1.28以降、ePortalはアプリケーションレベルのレプリケーションをサポートしています。リーダーからフォロワーへ、フォロワーからリーダーへ、両方向に変更を伝達できます。")]),a._v(" "),t("p",[a._v("レプリケーションに関する構成設定は、"),t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("で変更できます。")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("NODE_URL")]),a._v("：自動検出用に必要な自身のインスタンスへのURL")]),a._v(" "),t("li",[t("code",[a._v("LEADER_URL")]),a._v("：変更の取得元のインスタンスへのURL")]),a._v(" "),t("li",[t("code",[a._v("REPLICATION_SHARED_KEY")]),a._v("：レプリケーションデータにアクセスするための認証キー")]),a._v(" "),t("li",[t("code",[a._v("REPLICATION_CHECK_CERT")]),a._v("：レプリケーションリクエストに厳密なTLS証明書認証を使用します。適切なTLS証明書を取得せずに、レプリカに自己署名証明書を展開し、暗号化されたレプリケーショントラフィックを取得すると便利な場合があります。")]),a._v(" "),t("li",[t("code",[a._v("REPLICATION_CLEAN_AGE")]),a._v("：oplogクリーンアップ中の秒単位のデータ保存時間。デフォルトでは、7日間です。")]),a._v(" "),t("li",[t("code",[a._v("REPLICATION_CLEAN_AGGRESSIVE_AGE")]),a._v(": 重要でない操作向けoplogクリーンアップ中の秒単位のデータ保存時間。デフォルトでは、1時間です。")])]),a._v(" "),t("p",[a._v("リーダーノードはフォロワーを自動的に検出し、その後変更を取得します。")]),a._v(" "),t("p",[a._v("ePortalクラスタへのエージェントリクエストの負荷を分散する、どんな便利な方法でも使用できます。たとえば、複数のIPアドレスをDNS名に追加したり、HTTPバランサを使用したりできます。")]),a._v(" "),t("h3",{attrs:{id:"基本設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本設定"}},[a._v("#")]),a._v(" 基本設定")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("2つの新しいePortalインスタンスを準備し、DNS名をIPに割り当てます。例えば、")]),a._v(" "),t("ul",[t("li",[a._v("eportal1.corp -> 192.168.1.11")]),a._v(" "),t("li",[a._v("eportal2.corp -> 192.168.1.12")]),a._v(" "),t("li",[a._v("eportal.corp -> 192.168.1.11、192.168.1.12")])])]),a._v(" "),t("li",[t("p",[t("code",[a._v("eportal1")]),a._v("をリーダー、"),t("code",[a._v("eportal2")]),a._v("をフォロワーとして選択しましょう。"),t("code",[a._v("eportal.corp")]),a._v("は、KernelCareエージェントがあるサーバーに使用するクラスタのホスト名です。")]),a._v(" "),t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("警告！")]),t("p",[a._v("クラスタのホスト名を使用して、ePortal管理UIで操作を行わないでください。")])])]),a._v(" "),t("li",[t("p",[t("code",[a._v("eportal1")]),a._v("で、構成ファイルに"),t("code",[a._v("NODE_URLとREPLICATION_SHARED_KEY")]),a._v("を定義します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("NODE_URL = 'http://eportal1.corp'\nREPLICATION_SHARED_KEY = 'secret'\n")])])])]),a._v(" "),t("li",[t("p",[t("code",[a._v("eportal2")]),a._v("で、"),t("code",[a._v("NODE_URL")]),a._v("、"),t("code",[a._v("LEADER_URL")]),a._v("、"),t("code",[a._v("REPLICATION_SHARED_KEY")]),a._v("を定義します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("NODE_URL = 'http://eportal2.corp'\nLEADER_URL = 'http://eportal1.corp'\nREPLICATION_SHARED_KEY = 'secret'\n")])])])]),a._v(" "),t("li",[t("p",[a._v("以上になります。両ホストでePortalを再起動した後、"),t("code",[a._v("eportal1")]),a._v("での変更は"),t("code",[a._v("ePortal2")]),a._v("インスタンスに複製されるようになります。その逆も同様です。")])])]),a._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[a._v("以下のコマンドで、KernelCareのエージェント設定を変更して、クラスタのホスト名を指すようにすることができます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("curl -s http://eportal.corp/set-patch-server | bash\n")])])])]),t("h3",{attrs:{id:"既存のeportalインスタンスへのノードの追加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#既存のeportalインスタンスへのノードの追加"}},[a._v("#")]),a._v(" 既存のePortalインスタンスへのノードの追加")]),a._v(" "),t("p",[a._v("すでに動作中のePortalインスタンスがある場合は、2番目のノードを設定し、両インスタンスで"),t("code",[a._v("NODE_URL")]),a._v("と"),t("code",[a._v("LEADER_URL")]),a._v("を定義します。その後、フォロワーインスタンスにて、以下の方法で完全同期をトリガーできます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[root@eportal2.corp]$ kc.eportal replication --full-sync\n")])])]),t("h3",{attrs:{id:"モニタリング"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#モニタリング"}},[a._v("#")]),a._v(" モニタリング")]),a._v(" "),t("p",[t("code",[a._v("kc.eportal replication --short-status")]),a._v(" CLIコマンドを使用して、レプリケーションのステータスを確認できます。レプリケーションに問題がある場合はコード1で終了し、以下のようなJSONを出力します。")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// overall health status")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// overall replication lag in seconds")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"last_sync"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// overall sync delta in seconds (how many seconds ago was successful communication with an upstream)")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"upstream"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// per upstream metrics")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"node2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"last_sync"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"node3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"lag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"last_sync"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"その他のレプリケーション設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#その他のレプリケーション設定"}},[a._v("#")]),a._v(" その他のレプリケーション設定")]),a._v(" "),t("p",[a._v("1リーダーと2フォロワーの設定の場合、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("     +-> leader <-+\n     |            |\n     |            |\nfollower1       follower2\n")])])]),t("p",[a._v("リーダーノードが失われて、"),t("code",[a._v("follower1")]),a._v("と"),t("code",[a._v("follower2")]),a._v("が相互に通信できなくなる可能性があります。この問題を軽減するために、リングレプリケーションを展開できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("  +-> node1 --+\n  |           |\n  |           v\nnode2 <---- node3\n")])])]),t("p",[a._v("この場合、各インスタンスは別のノードに続きます。")]),a._v(" "),t("h3",{attrs:{id:"警告"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#警告"}},[a._v("#")]),a._v(" 警告")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("レプリケーションは、HTTPトランスポートを使用しています。 SSLターミネーションなしでePortalを展開すると、レプリケーションデータは暗号化されずにそのまま転送されます。")])]),a._v(" "),t("li",[t("p",[a._v("ラウンドロビンバランサー設定（DNSまたはHTTPラウンドロビンバランサー）では、KernelCareエージェントは、一連の登録とそれに続く更新の場合に、レプリケーションラグが発生する可能性があります。問題を軽減するために、構成管理ロジックに10秒のタイムアウトまたはリピートを導入できます。")])]),a._v(" "),t("li",[t("p",[a._v("レプリケーションログは7日間保存されます。ノードが7日間を超えて接続を失った場合、一部の変更がスキップされます。")])])]),a._v(" "),t("h2",{attrs:{id:"kernelcare-enterpriseの展開"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kernelcare-enterpriseの展開"}},[a._v("#")]),a._v(" KernelCare Enterpriseの展開")]),a._v(" "),t("p",[a._v("KernelCareエージェントのインストール手順は、 "),t("a",{attrs:{href:"http://your-eportal-domain/admin/docs/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://your-eportal-domain/admin/docs/"),t("OutboundLink")],1),a._v("にあります。")]),a._v(" "),t("p",[a._v("ePortalからエージェントをインストールするには、特別なエンドポイント"),t("code",[a._v("http://your-eportal-domain/install-kernelcare")]),a._v("を使用できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ export KCARE_MAILTO=admin@mycompany.com\n$ curl -s http://eportal.mycompany.com/install-kernelcare | bash\n$ kcarectl --register my-key\n")])])]),t("p",[t("code",[a._v("KCARE_MAILTO")]),a._v("のエクスポートの手順は、オプションです。これは、KernelCareの更新失敗に関するすべての通知を受け取るように、"),t("code",[a._v("/etc/cron.d/kcare-cron")]),a._v("で対応するエントリーを設定するのに役立ちます。")]),a._v(" "),t("h3",{attrs:{id:"kernelcare-enterpriseクライアント構成ファイル"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kernelcare-enterpriseクライアント構成ファイル"}},[a._v("#")]),a._v(" KernelCare Enterpriseクライアント構成ファイル")]),a._v(" "),t("p",[a._v("KernelCare Enterpriseクライアント構成ファイルは、"),t("code",[a._v("/etc/sysconfig/kcare/kcare.conf")]),a._v("にあります。")]),a._v(" "),t("p",[a._v("例えば、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("AUTO_UPDATE=True\nPATCH_SERVER=http://10.1.10.115/\nREGISTRATION_URL=http://10.1.10.115/admin/api/kcare\n")])])]),t("p",[t("code",[a._v("AUTO_UPDATE")]),a._v("が"),t("code",[a._v("True")]),a._v("に設定されている場合、KernelCareクライアントは4時間ごとにチェックインし、最新のパッチをダウンロードして適用しようとします。")]),a._v(" "),t("p",[t("code",[a._v("PATCH_SERVER")]),a._v(" - パッチのダウンロード元サーバー")]),a._v(" "),t("p",[t("code",[a._v("REGISTRATION_URL")]),a._v(" - サーバーの登録／登録解除に使用されるURL")]),a._v(" "),t("h3",{attrs:{id:"展開の自動化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#展開の自動化"}},[a._v("#")]),a._v(" 展開の自動化")]),a._v(" "),t("p",[a._v("Ansible／Puppet／Chef／Salt などの自動化ツールを使用して、多数のシステムにKernelCareをインストールして、操作することができます。")]),a._v(" "),t("p",[a._v("展開のプロセスには、以下が含まれています。")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("http://your-eportal-domain/install-kernelcare")]),a._v("スクリプトの実行。事前にダウンロードする（チェックサムを確認する）か、"),t("code",[a._v("curl -s http://your-eportal-domain/install-kernelcare | bash")]),a._v("を直接実行できます。")]),a._v(" "),t("li",[a._v("アクティベーションキーを使用したKernelCareエージェントの登録")])]),a._v(" "),t("h4",{attrs:{id:"ansible"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ansible"}},[a._v("#")]),a._v(" Ansible")]),a._v(" "),t("p",[a._v("自動展開を開始するには、以下の情報を指定する必要があります。")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("eportal_srv Ansible変数のePortalサーバー名（または、IP）。その他の構成ファイルオプションは、"),t("RouterLink",{attrs:{to:"/live-patching-services/#config-options"}},[a._v("設定オプション")]),a._v("および "),t("a",{attrs:{href:"#kernelcare-enterprise-client-config-file"}},[a._v("KernelCare Enterpriseクライアント構成ファイル")]),a._v("（ePortal）にあります。")],1)]),a._v(" "),t("li",[t("p",[a._v("activation_key Ansible変数のアクティベーションキー。アクティベーションキーは、"),t("a",{attrs:{href:"#managing-keys"}},[a._v("キーの管理")]),a._v("（ePortal）で説明されているように、ePortalで生成できます。")])])]),a._v(" "),t("p",[a._v("展開フェーズ用のAnsible Playbookは、以下に似た表示になる可能性があります。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("- hosts: kernelcare\n  vars:\n    eportal_srv: http://192.168.250.19\n    activation_key: my-key\n  tasks:\n    - name: Download the installation shell script\n      get_url:\n        url: \"{{ eportal_srv }}/install-kernelcare\"\n        dest: /root/kc-install.sh\n        mode: '0700'\n\n    - name: Run the installation shell script\n      command: /root/kc-install.sh\n\n    - name: register KernelCare agents\n      command: /usr/bin/kcarectl --register {{ activation_key }}\n")])])]),t("p",[a._v("KernelCareエージェントを削除するためのAnsible Playbookファイルの例は、以下のとおりです。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("- hosts: kernelcare\n  tasks:\n    - name: unregister KernelCare agents\n      command: /usr/bin/kcarectl --unregister\n      ignore_errors: yes\n      args:\n        removes: /usr/bin/kcarectl\n\n    - name: remove kernelcare package\n      package:\n        name: kernelcare\n        state: absent\n")])])]),t("h3",{attrs:{id:"eportal-ip-ドメインの変更"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportal-ip-ドメインの変更"}},[a._v("#")]),a._v(" ePortal IP／ドメインの変更")]),a._v(" "),t("p",[a._v("KernelCareエージェントのあるホストで2つの特別なエンドポイントを呼び出すことにより、いつでもePortalのアドレスを変更できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("curl -s http://your-eportal-domain/set-kernelcare-repo | bash\ncurl -s http://your-eportal-domain/set-patch-server | bash\n")])])]),t("ul",[t("li",[t("code",[a._v("set-kernelcare-repo")]),a._v("は、ePortal経由でエージェントの更新をダウンロードする新しいパッケージリポジトリを設定します。")]),a._v(" "),t("li",[t("code",[a._v("set-patch-server")]),a._v("は、パッチサーバーの新しいアドレスを設定します。")])]),a._v(" "),t("h2",{attrs:{id:"eportalの移行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportalの移行"}},[a._v("#")]),a._v(" ePortalの移行")]),a._v(" "),t("p",[a._v("ここでは、あるePortalから別のePortalに、フィード／サーバー／キーの構成とパッチデータを移行する手順を解説します。新しいホストのePortalバージョンは1.18以上で、古いホストのバージョン以上である必要があります。")]),a._v(" "),t("p",[a._v("DebianベースのシステムからDebianベースのシステムに移行する場合、以下の簡単な手順になります。")]),a._v(" "),t("ul",[t("li",[a._v("両ホストでePortalを停止します。")]),a._v(" "),t("li",[t("code",[a._v("/var/lib/ePortal")]),a._v("を新しいホストにコピーします。注：ディレクトリの所有者は、"),t("code",[a._v("eportal:eportal")]),a._v("のままにしておく必要があります。")]),a._v(" "),t("li",[a._v("構成ファイル"),t("code",[a._v("/etc/eportal/config")]),a._v("が存在する場合はコピーします。")]),a._v(" "),t("li",[a._v("新しいホストにて、"),t("code",[a._v("/usr/share/kcare-eportal/migratedb.py --upgrade")]),a._v("で移行を実行します。")]),a._v(" "),t("li",[a._v("新しいホストでePortalを開始します。")])]),a._v(" "),t("p",[a._v("RHELベースのディストリビューションからの移行は、より複雑です。後で、スクリプトにて"),t("code",[a._v("$BASE_DIR")]),a._v("変数が参照されます。"),t("code",[a._v("$BASE_DIR")]),a._v("変数は、RHELベースのディストリビューション用にエクスポートできます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("export BASE_DIR=/usr/share/kcare-eportal\n")])])]),t("p",[a._v("また、Debianベースのディストリビューションの場合は、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("export BASE_DIR=/var/lib/eportal\n")])])]),t("p",[a._v("また、Dockerベースのインストールの場合は、対応するデータディレクトリを使用します。たとえば、コンテナを"),t("code",[a._v("docker run -v /var/lib/eportal/data:/var/lib/eportal/data kernelcare/eportal")]),a._v("として実行する場合、"),t("code",[a._v("$BASE_DIR")]),a._v("として"),t("code",[a._v("/var/lib/eportal/data")]),a._v("を使用します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("export BASE_DIR=/var/lib/eportal/data\n")])])]),t("ul",[t("li",[t("p",[a._v("両ホストでePortalを停止します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[old-host ~]# systemctl stop eportal\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[new-host ~]# systemctl stop eportal\n")])])])]),a._v(" "),t("li",[t("p",[a._v("新しいホストでdbファイルを削除します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[new-host ~]# rm $BASE_DIR/*.sqlite*\n")])])])]),a._v(" "),t("li",[t("p",[a._v("古いホストから新しいホストにデータベースファイル"),t("code",[a._v("$BASE_DIR/*.sqlite*")]),a._v("をコピーします。")])]),a._v(" "),t("li",[t("p",[a._v("（オプション）ランタイムLDAPとフィードソースの設定"),t("code",[a._v("$BASE_DIR/config/config.json")]),a._v("をコピーします。")])]),a._v(" "),t("li",[t("p",[a._v("（オプション）ePortalのWebアプリ設定"),t("code",[a._v("/usr/share/kcare-eportal/config/local.py")]),a._v("を新しいePortalにコピーします。また、"),t("code",[a._v("/etc/eportal/config")]),a._v("が存在する場合は、それを新しいホストの"),t("code",[a._v("/etc/eportal/config")]),a._v("にコピーします。")])]),a._v(" "),t("li",[t("p",[a._v("新しいePortalへ移行が行われたことを当社の請求部門が認識できるようにし、二重請求が行われないように、"),t("code",[a._v("$BASE_DIR/instance-id")]),a._v("をコピーします。")])]),a._v(" "),t("li",[t("p",[a._v("パッチデータ"),t("code",[a._v("$BASE_DIR/{arch,resources,user-resources}")]),a._v("を新しいホストにコピーします。")])]),a._v(" "),t("li",[t("p",[a._v("ファイルの所有者を設定します。RHELベースのディストリビューションの場合、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[new-host ~]# chown -R nginx:nginx $BASE_DIR\n")])])]),t("p",[a._v("Debianベースのディストリビューションの場合、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[new-host ~]# chown -R eportal:eportal $BASE_DIR\n")])])])]),a._v(" "),t("li",[t("p",[a._v("新しいホストで、移行"),t("code",[a._v("/usr/share/kcare-eportal/migratedb.py --upgrade")]),a._v("を実行します。")])]),a._v(" "),t("li",[t("p",[a._v("新しいホストでePortalを開始します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[new-host ~]# systemctl start eportal\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"データベースのバックアップ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#データベースのバックアップ"}},[a._v("#")]),a._v(" データベースのバックアップ")]),a._v(" "),t("h3",{attrs:{id:"バックアップの作成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#バックアップの作成"}},[a._v("#")]),a._v(" バックアップの作成")]),a._v(" "),t("p",[a._v("kc.eportalユーティリティには、データベースのバックアップを作成するオプションがあります")]),a._v(" "),t("p",[t("code",[a._v("kc.eportal backup-db <path_to_directory>")]),a._v(" - 指定されたディレクトリにバックアップを作成します。ディレクトリが存在しない場合は、ディレクトリが作成されます。")]),a._v(" "),t("p",[a._v("例えば、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal backup-db /usr/share/kcare-eportal/db-backup_$(date '+%Y-%m-%d')\n")])])]),t("h3",{attrs:{id:"バックアップからの復元"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#バックアップからの復元"}},[a._v("#")]),a._v(" バックアップからの復元")]),a._v(" "),t("p",[a._v("既存のデータベース（デフォルトでは、ePortalホームディレクトリ内にあります）をバックアップ ファイルで置き換えることができます。")]),a._v(" "),t("p",[a._v("重要：データベースファイルを置き換える前に、ePortalを停止する必要があります。バックアップ ファイルには、所有者とグループ"),t("code",[a._v("nginx:nginx")]),a._v("が必要です。")]),a._v(" "),t("p",[a._v("例えば、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("systemctl stop eportal\ncp -f /path/to/backup_dir/* /usr/share/kcare-eportal/\nchown nginx:nginx /usr/share/kcare-eportal/*.sqlite*\nsystemctl start eportal\n")])])]),t("p",[a._v("また、リモートパッチソースの設定（ePortal UIのユーザー名、パスワード、ダウンロード URL）を確認し、その後、パッチをダウンロードする必要があります。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal kcare download-missing\nkc.eportal libcare download-missing\nkc.eportal qemu download-missing\nkc.eportal db download-missing\n")])])]),t("h2",{attrs:{id:"構成ファイル"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#構成ファイル"}},[a._v("#")]),a._v(" 構成ファイル")]),a._v(" "),t("ul",[t("li",[a._v("ePortalの構成ファイル："),t("code",[a._v("/etc/eportal/config")]),a._v("。バージョン1.35よりも古いバージョンの構成ファイル： "),t("code",[a._v("/usr/share/kcare-eportal/local.py")]),a._v("。")]),a._v(" "),t("li",[a._v("Webサーバー（nginx）の構成ファイル："),t("code",[a._v("/etc/nginx/conf.d/eportal.conf")]),a._v("。")]),a._v(" "),t("li",[a._v("データディレクトリ（RHELベースのディストリビューション）："),t("code",[a._v("/usr/share/kcare-eportal")]),a._v("。")]),a._v(" "),t("li",[a._v("データ ディレクトリ（Debianベースのディストリビューション）："),t("code",[a._v("/var/lib/eportal")]),a._v("。")])]),a._v(" "),t("h2",{attrs:{id:"停止と開始"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止と開始"}},[a._v("#")]),a._v(" 停止と開始")]),a._v(" "),t("p",[a._v("nginxサーバーの設定を停止／開始／リロード／再起動するには、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ systemctl stop|start|reload|restart nginx\n")])])]),t("p",[a._v("ePortalを停止／開始／再起動するには（Python）、")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("$ systemctl stop|start|restart eportal\n")])])]),t("h2",{attrs:{id:"ログファイル"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ログファイル"}},[a._v("#")]),a._v(" ログファイル")]),a._v(" "),t("p",[a._v("ePortalのログ： "),t("code",[a._v("journalctl -u eportal")])]),a._v(" "),t("p",[a._v("Nginx ePortalのアクセスログ："),t("code",[a._v("/var/log/nginx/access.log")])]),a._v(" "),t("p",[a._v("Nginxのエラーログ："),t("code",[a._v("/var/log/nginx/error.log")])]),a._v(" "),t("h3",{attrs:{id:"ログローテーション"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ログローテーション"}},[a._v("#")]),a._v(" ログローテーション")]),a._v(" "),t("p",[a._v("デフォルトでは、ePortalのログローテーション用の定義済みパラメータはありません。上記のファイルに対してログローテーションを有効にする場合は、")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("logrotate")]),a._v("パッケージをインストールする")]),a._v(" "),t("li",[t("code",[a._v("/etc/logrotate.d/eportal")]),a._v("構成ファイルを作成／編集する")])]),a._v(" "),t("p",[a._v("logrotate設定の例は、以下のとおりです。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("/var/log/nginx/kcare-eportal.log {\n    daily\n    rotate 5 # keep 5 last archives\n    missingok # it's ok if there is no such file\n    notifempty # do nothing if file is empty\n    compress\n}\n")])])]),t("h2",{attrs:{id:"nagiosとzabbixのサポート"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nagiosとzabbixのサポート"}},[a._v("#")]),a._v(" NagiosとZabbixのサポート")]),a._v(" "),t("p",[a._v("バージョン1.2以降のKernelCare.ePortalは、"),t("RouterLink",{attrs:{to:"/kc-agent-monitoring/#nagios-plugin"}},[a._v("Nagios")]),a._v("と"),t("RouterLink",{attrs:{to:"/kc-agent-monitoring/#zabbix-template"}},[a._v("Zabbix")]),a._v("の監視と同様のサーバー監視をサポートしています。")],1),a._v(" "),t("p",[a._v("情報を受け取るには、APIを直接curlします。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("https://yourserver/admin/api/kcare/nagios/KCAREKEY\n")])])]),t("p",[a._v("または、"),t("a",{attrs:{href:"https://patches.kernelcare.com/downloads/nagios/check_kcare",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://patches.kernelcare.com/downloads/nagios/check_kcare"),t("OutboundLink")],1),a._v(" スクリプトを使用することができます。使用するには、スクリプト内のKEY_KCARE_NAGIOS_ENDPOINTをご利用のサーバーを指すように変更します。つまり、"),t("a",{attrs:{href:"https://cln.cloudlinux.com/clweb",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://cln.cloudlinux.com/clweb"),t("OutboundLink")],1),a._v("（古いUIへのリンク）または"),t("a",{attrs:{href:"https://cln.cloudlinux.com/console/auth/login",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://cln.cloudlinux.com/console/auth/login"),t("OutboundLink")],1),a._v("（新しいUIへのリンク）を"),t("a",{attrs:{href:"https://yourserver/admin",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://yourserver/admin"),t("OutboundLink")],1),a._v("へ変更します。")]),a._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[a._v("注")]),t("p",[t("code",[a._v("PARTNER_LOGIN/TOKEN")]),a._v("を使用したアクセスは、KernelCare.ePortalではサポートされていません。")])]),t("h2",{attrs:{id:"使用状況レポート"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用状況レポート"}},[a._v("#")]),a._v(" 使用状況レポート")]),a._v(" "),t("p",[a._v("通常、使用状況レポートは自動的に送信されます。ただし、送信できない場合は、ePortalはレポートをEメールで送信しようとします。これには、ホストに設定されたSendmail（SSMTP）が必要になります。以下が簡単な手順になります。")]),a._v(" "),t("p",[a._v("メールの送信に失敗した場合、ePortalはレポートを"),t("code",[a._v("/usr/share/kcare-eportal/reports")]),a._v("に保存します。これらのレポートは、手動で送信する必要があります。")]),a._v(" "),t("h3",{attrs:{id:"sendmail-ssmtp-の設定方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sendmail-ssmtp-の設定方法"}},[a._v("#")]),a._v(" Sendmail（SSMTP）の設定方法")]),a._v(" "),t("p",[a._v("まず、"),t("code",[a._v("ssmtp")]),a._v("をインストールする必要があります。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("yum install -y ssmtp\n")])])]),t("p",[a._v("SMTPサーバーの設定に従って、"),t("code",[a._v("/etc/ssmtp/ssmtp.conf")]),a._v("ファイルを編集します。以下は、Gmailアカウントに接続する一般的な方法が記述された簡単な構成ファイルです。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("root=username@gmail.com\nmailhub=smtp.gmail.com:587\nhostname=localhost\nUseSTARTTLS=YES\nAuthUser=username@gmail.com\nAuthPass=xxxxxxxxxxxxxxxxxxx\nFromLineOverride=YES\nTLS_CA_File=/etc/ssl/certs/ca-certificates.crt\n")])])]),t("p",[a._v("TLS_CA_Filesの実際の場所は、Linuxディストリビューションによって異なります。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v('"/etc/ssl/certs/ca-certificates.crt",                // Debian/Ubuntu/Gentoo etc.\n"/etc/pki/tls/certs/ca-bundle.crt",                  // Fedora/RHEL 6\n"/etc/ssl/ca-bundle.pem",                            // OpenSUSE\n"/etc/pki/tls/cacert.pem",                           // OpenELEC\n"/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem", // CentOS/RHEL 7\n')])])]),t("p",[a._v("また、以下を実行して、取得できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("curl-config --ca\n")])])]),t("p",[a._v("これで、接続をテストできます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("echo -n 'Subject: test\\n\\nTesting ssmtp' | sendmail -v some-recipient@gmail.com\n")])])]),t("h2",{attrs:{id:"カスタム環境変数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#カスタム環境変数"}},[a._v("#")]),a._v(" カスタム環境変数")]),a._v(" "),t("p",[a._v("ePortalプロセス用に独自の環境変数を定義できます。")]),a._v(" "),t("p",[t("code",[a._v("/usr/share/kcare-eportal/environment")]),a._v("フォルダがあり、これは基本的にデーモンツールと互換性のあるenvdirです。")]),a._v(" "),t("p",[a._v("たとえば、デフォルトのhttps検証を無効にするには、以下のように"),t("code",[a._v("PYTHONHTTPSVERIFY")]),a._v("環境変数を0に設定します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("echo 0 > /usr/share/kcare-eportal/environment/PYTHONHTTPSVERIFY`\n")])])]),t("h2",{attrs:{id:"シングルサインオンによる認証"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#シングルサインオンによる認証"}},[a._v("#")]),a._v(" シングルサインオンによる認証")]),a._v(" "),t("p",[a._v("ePortalは「OAuth 2.0」標準、「認証コード」フローによるシングルサインオン認証をサポートしています。")]),a._v(" "),t("h3",{attrs:{id:"設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#設定"}},[a._v("#")]),a._v(" 設定")]),a._v(" "),t("p",[a._v("SSOを有効にするには、OAuth2認証サービスプロバイダーとePortalを設定する必要があります。")]),a._v(" "),t("h4",{attrs:{id:"oktaアプリケーションの設定例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oktaアプリケーションの設定例"}},[a._v("#")]),a._v(" Oktaアプリケーションの設定例")]),a._v(" "),t("p",[a._v("Okta管理コンソール内で、OpenID Connectアプリケーションを設定します。")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("管理コンソールで、"),t("strong",[a._v("Applications")]),a._v(" > "),t("strong",[a._v("Applications")]),a._v("に移動します。")])]),a._v(" "),t("li",[t("p",[a._v("Create "),t("strong",[a._v("App Integration")]),a._v("をクリックします。")])]),a._v(" "),t("li",[t("p",[a._v("Create a new app integrationページで、まず"),t("strong",[a._v("Sign-in method")]),a._v("として"),t("strong",[a._v("OIDC - OpenID Connect")]),a._v("を選択し、次に"),t("strong",[a._v("Application type")]),a._v("として"),t("strong",[a._v("Web Application")]),a._v("を選択します。")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("Application Settings")]),a._v("を入力します。")])])]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[a._v("設定")])]),a._v(" "),t("th",[t("strong",[a._v("値")])])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("Sign-in redirect URI")]),a._v(" "),t("td",[a._v("http://eportal_ip/admin/sso/login/callback")])]),a._v(" "),t("tr",[t("td",[a._v("Sign-out redirect URI")]),a._v(" "),t("td",[a._v("http://eportal_ip/admin")])])])]),a._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[t("em",[a._v("Client ID")]),a._v("、"),t("em",[a._v("Client secret")]),a._v("、"),t("code",[a._v("/authorize")]),a._v("、"),t("code",[a._v("/token")]),a._v("、"),t("code",[a._v("/userinfo")]),a._v("エンドポイントへの完全なURLを取得します。")])]),a._v(" "),t("h4",{attrs:{id:"eportalの設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eportalの設定"}},[a._v("#")]),a._v(" ePortalの設定")]),a._v(" "),t("p",[a._v("ePortalマシンで、SSO設定を構成します。")]),a._v(" "),t("p",[t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("を編集します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('OIDC_AUTH_URL="https://dev-61441893.okta.com/oauth2/v1/authorize"\nOIDC_TOKEN_URL="https://dev-61441893.okta.com/oauth2/v1/token"\nOIDC_USERINFO_URL="https://dev-61441893.okta.com/oauth2/v1/userinfo"\n\nOIDC_CLIENT_ID="0Aa134lzhUKj8jDMo5d7"\nOIDC_CLIENT_SECRET="AoBNuWRLRu2dxIR3Q0btO53N1entmGxBjQqwmjVL"\n')])])]),t("p",[a._v("ePortalを再起動します（"),t("a",{attrs:{href:"#stopping-starting"}},[a._v("停止と開始")]),a._v("欄を参照し、対応するOSを選択してください）。")]),a._v(" "),t("p",[a._v("すべての設定が正しく構成されている場合、新しい"),t("strong",[a._v("Sign In with SSO")]),a._v("ボタンがログインページ"),t("code",[a._v("http://eportal_ip/admin/login")]),a._v("に表示されているはずです。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/sso_eportal.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"カスタムパッチストレージ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#カスタムパッチストレージ"}},[a._v("#")]),a._v(" カスタムパッチストレージ")]),a._v(" "),t("p",[a._v("デフォルトでは、パッチとデータベースは、RHELベースのシステムの場合は"),t("code",[a._v("/usr/share/kcare-eportal")]),a._v("に、debベースのシステムの場合は"),t("code",[a._v("/var/lib/eportal")]),a._v("に保存されています。たとえば、外部ブロックデバイスにパッチを保存するなど、分割ストレージを使用するように設定できます。")]),a._v(" "),t("p",[t("a",{attrs:{href:"#config-files"}},[a._v("ePortal構成ファイル")]),a._v("を編集します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("PATCHES_DIR = '/path/to/patches/storage'\n")])])]),t("p",[a._v("以下を実行します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("kc.eportal sync-nginx-conf\n")])])]),t("p",[a._v("ストレージが初期化され、新しい場所からパッチが提供されるように、nginx構成ファイルに対応する変更が行われます。")]),a._v(" "),t("p",[t("code",[a._v("nginx")]),a._v("と"),t("code",[a._v("ePortal")]),a._v("サービスを再起動して、変更を適用します。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("systemctl restart eportal nginx\n")])])])])},[],!1,null,null,null);e.default=r.exports}}]);