<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ePortal | ドキュメンテーション</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="icon" href="/favicon.ico">
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5BSW555');</script>
    <meta name="description" content="TuxCare ePortalは、KernelCare Enterpriseライブ パッチ管理専用のWeb管理コンソールです。">
    <meta name="image" content="/images/eportal-overview.svg">
    <meta name="twitter:title" content="ePortal">
    <meta name="twitter:description" content="TuxCare ePortalは、KernelCare Enterpriseライブ パッチ管理専用のWeb管理コンソールです。">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/images/eportal-overview.svg">
    <meta name="twitter:url" content="/jp/eportal/">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ePortal">
    <meta property="og:description" content="TuxCare ePortalは、KernelCare Enterpriseライブ パッチ管理専用のWeb管理コンソールです。">
    <meta property="og:image" content="/images/eportal-overview.svg">
    <meta property="og:url" content="/jp/eportal/">
    <meta property="og:site_name" content="TuxCare Documentation">
    <meta itemprop="name" content="ePortal">
    <meta itemprop="description" content="TuxCare ePortalは、KernelCare Enterpriseライブ パッチ管理専用のWeb管理コンソールです。">
    <meta itemprop="image" content="/images/eportal-overview.svg">
    <meta http-equiv="Content-Security-Policy" content="script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; *.survicate.com *.googletagmanager.com *.google-analytics.com *.licdn.com *.hotjar.com *.twitter.com *.facebook.net *.kernelcare.info *.twitter.com *.ads-twitter.com;">
    
    <link rel="preload" href="/assets/css/0.styles.55e003d6.css" as="style"><link rel="preload" href="/assets/js/app.40acf458.js" as="script"><link rel="preload" href="/assets/js/4.fa87bcbc.js" as="script"><link rel="preload" href="/assets/js/1.8d9e0a6b.js" as="script"><link rel="preload" href="/assets/js/30.c5368627.js" as="script"><link rel="prefetch" href="/assets/js/10.0598fc63.js"><link rel="prefetch" href="/assets/js/11.fbb1abbd.js"><link rel="prefetch" href="/assets/js/12.497b9334.js"><link rel="prefetch" href="/assets/js/13.cf94d2ce.js"><link rel="prefetch" href="/assets/js/14.e754d03b.js"><link rel="prefetch" href="/assets/js/15.ab56c7eb.js"><link rel="prefetch" href="/assets/js/16.e258bd7a.js"><link rel="prefetch" href="/assets/js/17.78b5c1ee.js"><link rel="prefetch" href="/assets/js/18.1fd57be1.js"><link rel="prefetch" href="/assets/js/19.09007db9.js"><link rel="prefetch" href="/assets/js/20.4b89b8f8.js"><link rel="prefetch" href="/assets/js/21.25545891.js"><link rel="prefetch" href="/assets/js/22.e6d46c39.js"><link rel="prefetch" href="/assets/js/23.cee132b3.js"><link rel="prefetch" href="/assets/js/24.10dc4d08.js"><link rel="prefetch" href="/assets/js/25.d694fc98.js"><link rel="prefetch" href="/assets/js/26.80ea75ef.js"><link rel="prefetch" href="/assets/js/27.9fba3498.js"><link rel="prefetch" href="/assets/js/28.4df4f44e.js"><link rel="prefetch" href="/assets/js/29.d11c7dd0.js"><link rel="prefetch" href="/assets/js/31.3b8ae5c5.js"><link rel="prefetch" href="/assets/js/32.cdf8ef30.js"><link rel="prefetch" href="/assets/js/33.54ef9298.js"><link rel="prefetch" href="/assets/js/34.ccda7460.js"><link rel="prefetch" href="/assets/js/35.bb2b236c.js"><link rel="prefetch" href="/assets/js/36.da50bda3.js"><link rel="prefetch" href="/assets/js/37.9e19726a.js"><link rel="prefetch" href="/assets/js/38.1e7fc59f.js"><link rel="prefetch" href="/assets/js/39.e97d0b6e.js"><link rel="prefetch" href="/assets/js/40.d8cd3965.js"><link rel="prefetch" href="/assets/js/41.eb825a8e.js"><link rel="prefetch" href="/assets/js/5.4855c5c6.js"><link rel="prefetch" href="/assets/js/6.e8d6a4c1.js"><link rel="prefetch" href="/assets/js/7.42124ede.js"><link rel="prefetch" href="/assets/js/8.247b8e55.js"><link rel="prefetch" href="/assets/js/9.6eee101a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.14adddb0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55e003d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jp/tuxcare/" class="home-link"><img src="/logo.svg" alt="ドキュメンテーション" class="logo"> <span class="site-name site-name--documentation can-hide">ドキュメンテーション</span></a> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <div class="links" style="max-width:nullpx;"><a href="https://tuxcare.com/support-portal/" target="_blank" class="btn">
      Contact Support
    </a> <!----> <a href="https://portal.tuxcare.com" target="_blank" class="btn">
      Login to TuxCare portal
    </a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">言語:</span> <a class="dropdown-title"><span class="text">日本語</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/eportal/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/jp/eportal/" aria-current="page" class="nav-link router-link-exact-active router-link-active">日本語</a></li></ul></div></div></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">言語:</span> <a class="dropdown-title"><span class="text">日本語</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/eportal/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/jp/eportal/" aria-current="page" class="nav-link router-link-exact-active router-link-active">日本語</a></li></ul></div></div></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><!----> <ul class="sidebar-group-items"><li><div><a href="/jp/tuxcare/" class="sidebar-link link-depth-level-0">TuxCare</a></div></li><li><div class="sidebar-header sidebar-link"><div><a href="/jp/live-patching-services/" class="sidebar-link link-depth-level-0">ライブパッチ適用サービス</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/live-patching-services/#kernelcare-enterprise" class="sidebar-link link-depth-level-1">KernelCare Enterprise</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/live-patching-services/#libcare" class="sidebar-link link-depth-level-1">LibCare</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/live-patching-services/#kernelcare-for-iot" class="sidebar-link link-depth-level-1">KernelCare for IOT</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/live-patching-services/#qemucare" class="sidebar-link link-depth-level-1">QEMUCare</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/live-patching-services/#dbcare" class="sidebar-link link-depth-level-1">DBCare</a></div></li></ul></li><li><div class="active collapsed sidebar-header sidebar-link"><div class="active"><a href="/jp/eportal/" aria-current="page" class="active sidebar-link link-depth-level-0">ePortal</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#eportalハードウェア要件" class="sidebar-link link-depth-level-1">ePortalハードウェア要件</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#インストール" class="sidebar-link link-depth-level-1">インストール</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#キャッシュモード" class="sidebar-link link-depth-level-1">キャッシュモード</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#プロキシ設定" class="sidebar-link link-depth-level-1">プロキシ設定</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#認証設定" class="sidebar-link link-depth-level-1">認証設定</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#ユーザーの管理" class="sidebar-link link-depth-level-1">ユーザーの管理</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#ldapを使用した認証" class="sidebar-link link-depth-level-1">LDAPを使用した認証</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#eportalへのアクセス" class="sidebar-link link-depth-level-1">ePortalへのアクセス</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#パッチセットの展開" class="sidebar-link link-depth-level-1">パッチセットの展開</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#libcareパッチセットの展開" class="sidebar-link link-depth-level-1">LibCareパッチセットの展開</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#qemuパッチセットの展開" class="sidebar-link link-depth-level-1">QEMUパッチセットの展開</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#キーの管理" class="sidebar-link link-depth-level-1">キーの管理</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#サーバーの管理" class="sidebar-link link-depth-level-1">サーバーの管理</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#フィード管理" class="sidebar-link link-depth-level-1">フィード管理</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#特別なタグフィールドの追加" class="sidebar-link link-depth-level-1">特別なタグフィールドの追加</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#httpsを使用するようにeportalを設定する方法" class="sidebar-link link-depth-level-1">HTTPSを使用するようにePortalを設定する方法</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#高可用性" class="sidebar-link link-depth-level-1">高可用性</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#kernelcare-enterpriseの展開" class="sidebar-link link-depth-level-1">KernelCare Enterpriseの展開</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#eportalの移行" class="sidebar-link link-depth-level-1">ePortalの移行</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#データベースのバックアップ" class="sidebar-link link-depth-level-1">データベースのバックアップ</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#構成ファイル" class="sidebar-link link-depth-level-1">構成ファイル</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#停止と開始" class="sidebar-link link-depth-level-1">停止と開始</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#ログファイル" class="sidebar-link link-depth-level-1">ログファイル</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#nagiosとzabbixのサポート" class="sidebar-link link-depth-level-1">NagiosとZabbixのサポート</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#使用状況レポート" class="sidebar-link link-depth-level-1">使用状況レポート</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#カスタム環境変数" class="sidebar-link link-depth-level-1">カスタム環境変数</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal/#シングルサインオンによる認証" class="sidebar-link link-depth-level-1">シングルサインオンによる認証</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal/#カスタムパッチストレージ" class="sidebar-link link-depth-level-1">カスタムパッチストレージ</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/jp/eportal-api/" class="sidebar-link link-depth-level-0">ePortal API</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#サーバーのリスト表示" class="sidebar-link link-depth-level-1">サーバーのリスト表示</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#ホストの登録" class="sidebar-link link-depth-level-1">ホストの登録</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/eportal-api/#ホストの登録解除" class="sidebar-link link-depth-level-1">ホストの登録解除</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#フィードの作成-変更" class="sidebar-link link-depth-level-1">フィードの作成／変更</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#フィードのリスト表示" class="sidebar-link link-depth-level-1">フィードのリスト表示</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#フィードの削除" class="sidebar-link link-depth-level-1">フィードの削除</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#登録キーの作成-変更" class="sidebar-link link-depth-level-1">登録キーの作成／変更</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#キーのリスト表示" class="sidebar-link link-depth-level-1">キーのリスト表示</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#キーの削除" class="sidebar-link link-depth-level-1">キーの削除</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#パッチセットのリスト表示" class="sidebar-link link-depth-level-1">パッチセットのリスト表示</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/eportal-api/#パッチセットの管理" class="sidebar-link link-depth-level-1">パッチセットの管理</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/jp/extended-lifecycle-support/" class="sidebar-link link-depth-level-0">延長ライフサイクルサポート</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/extended-lifecycle-support/#yumリポジトリのインストール手順" class="sidebar-link link-depth-level-1">yumリポジトリのインストール手順</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/extended-lifecycle-support/#elsアップデートのローカルミラーのインストールに関する説明" class="sidebar-link link-depth-level-1">ELSアップデートのローカルミラーのインストールに関する説明</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/extended-lifecycle-support/#ovalデータ" class="sidebar-link link-depth-level-1">#OVALデータ</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/jp/extended-lifecycle-support-for-languages/" class="sidebar-link link-depth-level-0">言語向け延長ライフサイクルサポート</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/extended-lifecycle-support-for-languages/#hp向け延長ライフサイクルサポート" class="sidebar-link link-depth-level-1">HP向け延長ライフサイクルサポート</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/extended-lifecycle-support-for-languages/#python向け延長ライフサイクルサポート" class="sidebar-link link-depth-level-1">Python向け延長ライフサイクルサポート</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/jp/linux-support-services/" class="sidebar-link link-depth-level-0">Linuxサポートサービス</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div><a href="/jp/linux-support-services/#almalinux-os-8向け「エッセンシャル」サポート" class="sidebar-link link-depth-level-1">AlmaLinux OS 8向け「エッセンシャル」サポート</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/linux-support-services/#almalinux-os8とその他のlinuxディストリビューション向け「プレミアム」サポート" class="sidebar-link link-depth-level-1">AlmaLinux OS8とその他のLinuxディストリビューション向け「プレミアム」サポート</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/linux-support-services/#almalinux-os-8向け製品nodeosサポート" class="sidebar-link link-depth-level-1">AlmaLinux OS 8向け製品NodeOSサポート</a></div></li></ul></li><li><div class="sidebar-header sidebar-link"><div><a href="/jp/tuxcare-cln/" class="sidebar-link link-depth-level-0">サブスクリプション管理ポータル</a></div></div><ul class="sidebar-sub-headers"><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/tuxcare-cln/#概要" class="sidebar-link link-depth-level-1">概要</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/tuxcare-cln/#dashboard" class="sidebar-link link-depth-level-1">Dashboard</a></div></li><li class="collapsible sidebar-sub-header"><div><a href="/jp/tuxcare-cln/#live-patching-services" class="sidebar-link link-depth-level-1">Live Patching Services</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/tuxcare-cln/#extended-support-services" class="sidebar-link link-depth-level-1">Extended Support Services</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/tuxcare-cln/#billing" class="sidebar-link link-depth-level-1">Billing</a></div></li><li class="collapsible sidebar-sub-header"><div class="sidebar-link-container"><a href="/jp/tuxcare-cln/#settings" class="sidebar-link link-depth-level-1">Settings</a></div></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>ドキュメンテーション:</span> <a href="/jp/" class="breadcrumb router-link-active" data-v-5e0e0acf>
    
  </a><a href="/jp/eportal/" aria-current="page" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    ePortal
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/jp/live-patching-services/" class="nav-arrow left"></a> <a href="/jp/eportal-api/" class="nav-arrow right"></a></div></div> <div class="content content__default"><h1 id="eportal"><a href="#eportal" class="header-anchor">#</a> ePortal</h1> <p>TuxCare ePortalは、KernelCare Enterpriseライブ パッチ管理専用のWeb管理コンソールです。</p> <p>ePortalソフトウェアは、ファイアウォールの内側にある（つまり、インターネットにアクセスできない）サーバーを保護するのに役立ちます。また、オンプレミスにもクラウドにもインストールできます。</p> <p><img src="/images/eportal-overview.svg" alt="Overview"></p> <h2 id="eportalハードウェア要件"><a href="#eportalハードウェア要件" class="header-anchor">#</a> ePortalハードウェア要件</h2> <p><strong>ディスク</strong></p> <ul><li>最小100 GB、推奨200 GB（キャッシュモードの場合は、20 GB）</li> <li>100 IOPS以上のSSD</li></ul> <div class="tip custom-block"><p class="custom-block-title">注</p><p>SSDベースのストレージは、ePortalサーバーに必須の要件です。</p></div><p><strong>CPU</strong></p> <p>その他の要件に関して、以下の構成と接続サーバー数をテストしました。</p> <ul><li><p>以下の要件では、最大接続マシン数は10kです。</p> <ul><li>VM</li> <li>1 vCPU</li> <li>1 GB RAM</li></ul></li> <li><p>以下の要件では、最大接続マシン数は75kです。</p> <ul><li>Core i5</li> <li>1 CPU</li> <li>4 GB RAM</li></ul></li></ul> <h2 id="インストール"><a href="#インストール" class="header-anchor">#</a> インストール</h2> <p>ePortalは、CentOS 7/8、AlmaLinux 8、Ubuntu 20.04/22.04などのEL7/8ベースのディストリビューションの64bit版と互換性があります。</p> <h3 id="rhelベースのディストリビューション"><a href="#rhelベースのディストリビューション" class="header-anchor">#</a> RHELベースのディストリビューション</h3> <p>ePortalをインストールして実行するには、NginxのWebサーバーが必要です。Nginxの公式リポジトリからインストールした安定版を使用することをお勧めします。</p> <div class="language- extra-class"><pre class="language-text"><code>cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt;EOL
[nginx]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOL
</code></pre></div><p>詳細については、 <a href="https://nginx.org/en/linux_packages.html#stable" target="_blank" rel="noopener noreferrer">https://nginx.org/en/linux_packages.html#stable<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> を参照してください。</p> <p>ePortalリポジトリをセットアップします。</p> <div class="language- extra-class"><pre class="language-text"><code>cat &gt; /etc/yum.repos.d/kcare-eportal.repo &lt;&lt;EOL
[kcare-eportal]
name=KernelCare ePortal
baseurl=https://www.repo.cloudlinux.com/kcare-eportal/\$releasever/\$basearch/
enabled=1
gpgkey=https://repo.cloudlinux.com/kernelcare/RPM-GPG-KEY-KernelCare
gpgcheck=1
EOL
</code></pre></div><p>ePortalをインストールします。</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y kcare-eportal
</code></pre></div><h3 id="ubuntu-20-04"><a href="#ubuntu-20-04" class="header-anchor">#</a> Ubuntu 20.04</h3> <p>ePortalリポジトリをセットアップします。</p> <div class="language- extra-class"><pre class="language-text"><code>apt-get install -y --no-install-recommends curl ca-certificates

curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/20.04 focal main
EOL
</code></pre></div><p>ePortalをインストールします。</p> <div class="language- extra-class"><pre class="language-text"><code>apt-get update &amp;&amp; apt-get install -y --no-install-recommends kcare-eportal
</code></pre></div><h3 id="ubuntu-22-04"><a href="#ubuntu-22-04" class="header-anchor">#</a> Ubuntu 22.04</h3> <p>ePortalリポジトリをセットアップします。</p> <div class="language- extra-class"><pre class="language-text"><code>apt-get install -y --no-install-recommends curl ca-certificates

curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/22.04 jammy main
EOL
</code></pre></div><p>ePortalをインストールします。</p> <div class="language- extra-class"><pre class="language-text"><code>apt-get update &amp;&amp; apt-get install -y --no-install-recommends kcare-eportal
</code></pre></div><h2 id="キャッシュモード"><a href="#キャッシュモード" class="header-anchor">#</a> キャッシュモード</h2> <p>キャッシュモードを使用すると、ディスク使用要件が大幅に緩和され、最初のダウンロード手順が迅速に行われます。</p> <p>キャッシュモードでは、ePortalはパッチセットに関する軽量のメタ情報のみをダウンロードして、KernelCareエージェントからパッチサーバー（パッチソース）にパッチリクエストをプロキシします。ダウンロードされたパッチバイナリは2週間キャッシュされ、以下のリクエストでePortalから直接アクセスできるので、パブリックインターネットの帯域幅を消費しません。</p> <p><img src="/images/eportal-cache-mode.svg" alt="Cache mode"></p> <h3 id="キャッシュモードの有効化"><a href="#キャッシュモードの有効化" class="header-anchor">#</a> キャッシュモードの有効化</h3> <ol><li><a href="#config-files">ePortal構成ファイル</a>に</li></ol> <div class="language- extra-class"><pre class="language-text"><code>CACHE_MODE = True
</code></pre></div><p>の設定を追加します</p> <ol start="2"><li><p>ePortalを再起動します</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl restart eportal
</code></pre></div></li></ol> <p>既存のインストールの場合は、既存のパッチセット用メタ情報を再取得する必要があります。</p> <div class="language- extra-class"><pre class="language-text"><code>kcare/kc.eportal cache-mode --fetch-meta
</code></pre></div><h3 id="キャッシュモードの無効化"><a href="#キャッシュモードの無効化" class="header-anchor">#</a> キャッシュモードの無効化</h3> <ol><li><p><a href="#config-files">ePortal構成ファイル</a>内で</p> <div class="language- extra-class"><pre class="language-text"><code>CACHE_MODE = True
</code></pre></div></li></ol> <p>を削除またはコメントアウトします</p> <ol start="2"><li><p>不足しているパッチセットをダウンロードします</p> <div class="language- extra-class"><pre class="language-text"><code>kcare/kc.eportal kcare download-missing
</code></pre></div></li> <li><p>ePortalを再起動します</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl restart eportal
</code></pre></div></li></ol> <h2 id="プロキシ設定"><a href="#プロキシ設定" class="header-anchor">#</a> プロキシ設定</h2> <p>ePortalは、お客様のプロキシサーバー経由でパッケージとパッチを取得することができます。</p> <p><img src="/images/eportal-with-proxy.svg" alt="Proxy"></p> <p>ePortalマシンでは、コマンドラインで使用するのと同じプロキシ設定を定義する必要があります。</p> <p>これを行うには、<code>PROXY = 'http://example.com:3128'</code>を<a href="#config-files">ePortal構成ファイル</a>に追加します。</p> <div class="language- extra-class"><pre class="language-text"><code>echo -e &quot;\nPROXY = 'http://example.com:3128'&quot; &gt;&gt; /etc/eportal/config
</code></pre></div><p>ePortalは、<code>socks5://</code>プロキシスキームを介してSOCKS5プロキシをサポートしています。</p> <div class="language- extra-class"><pre class="language-text"><code>PROXY = 'socks5://example.com:1080'
</code></pre></div><p>ePortalを再起動します（<a href="#stopping-starting">停止と開始</a>欄を参照し、対応するOSを選択してください）。</p> <h2 id="認証設定"><a href="#認証設定" class="header-anchor">#</a> 認証設定</h2> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>AUTH_RESTRICTED_INDEX</code></td> <td>登録ユーザーのみインデックスページへのアクセスを許可します</td></tr> <tr><td><code>AUTH_PASSWORD_MIN_LENGTH</code></td> <td>最小パスワード長。デフォルトでは5</td></tr> <tr><td><code>AUTH_SESSION_LIFETIME</code></td> <td>セッションの有効期間秒数。デフォルトでは、セッションはブラウザを閉じるまで続きます</td></tr> <tr><td><code>AUTH_REFRESH_SESSION</code></td> <td><code>False</code>（デフォルト）の場合、ログインから有効期間秒数経過後、セッションが期限切れになります。<code>True</code>の場合、非アクティブな状態が有効期間秒数継続後、セッションが期限切れになります。</td></tr></tbody></table> <p><a href="#config-files">ePortal構成ファイル</a>にて構成を設定できます。</p> <h2 id="ユーザーの管理"><a href="#ユーザーの管理" class="header-anchor">#</a> ユーザーの管理</h2> <p><code>kc.eportal user</code>ユーティリティを使用して、ポータルを管理できます。</p> <div class="language- extra-class"><pre class="language-text"><code>usage: kc.eportal user [-h] [-a] [-c] [-d] [-p PASSWORD] [-r {admin,readonly}] [--note NOTE] [user]

list available users by default

positional arguments:
  user                  user name

optional arguments:
  -h, --help            show this help message and exit
  -a                    action: add new user
  -c                    action: change user
  -d                    action: delete user
  -p PASSWORD, --password PASSWORD
  -r {admin,readonly}, --role {admin,readonly}
  --note NOTE           description
</code></pre></div><p>ユーザーを追加するには、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal user -a -p AdminPassword admin
</code></pre></div><p>ユーザーのパスワードを変更するには、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal user -c -p NewPassword admin
</code></pre></div><p>ユーザーを読み取り専用に設定するには、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal user -c -r readonly admin
</code></pre></div><h2 id="ldapを使用した認証"><a href="#ldapを使用した認証" class="header-anchor">#</a> LDAPを使用した認証</h2> <p>ePortalはバインド操作を介したLDAP認証をサポートしています。すべてのユーザーに、バインドリクエストを実行できるDNが必要です。ePortalはユーザーを同期しないので、LDAPサーバーにアクセスするために特別なDN／パスワードを設定する必要はありません。</p> <h3 id="構成"><a href="#構成" class="header-anchor">#</a> 構成</h3> <p>LDAP構成設定は、<code>Settings / LDAP</code>ナビゲーション項目内で利用できます。</p> <h4 id="url"><a href="#url" class="header-anchor">#</a> URL</h4> <p>接続するLDAPサーバーのホスト、ポート、プロトコルを指定します。</p> <p>フォーマットは、<code>&lt;scheme&gt;://&lt;host&gt;[:port][?params]</code>です。</p> <ul><li><strong>scheme</strong>:
<ul><li><code>ldap</code>：認証済みの暗号化されたTLS接続。安全でない接続を使用するには、tls=0を指定できます。</li> <li><code>ldaps</code>：SSL接続。</li></ul></li> <li><strong>host</strong>：ご利用のLDAPサーバーのホスト名またはIP。</li> <li><strong>port</strong>：カスタムポート。デフォルトでは、ldapスキーム用は389、ldapsスキーム用は636です。</li> <li><strong>params</strong>:
<ul><li><code>strict_check=0</code>：厳密なSSL証明書の認証を有効／無効にします（デフォルトでは有効です）。</li> <li><code>tls=0</code>：接続時のTLSハンドシェイクを有効／無効にします（デフォルトでは有効です）。</li> <li><code>timeout=30</code>：LDAPサーバー接続タイムアウト（秒単位。デフォルトでは5です）。</li></ul></li></ul> <p>例えば、</p> <ul><li><code>ldap://ldap.forumsys.com?tls=0&amp;timeout=30</code>：接続タイムアウトが30秒の、安全ではない接続を使用します。</li></ul> <h4 id="接続文字列-dnテンプレート"><a href="#接続文字列-dnテンプレート" class="header-anchor">#</a> 接続文字列（DNテンプレート）</h4> <p>接続文字列は、LDAPバインド操作で使用されるDNテンプレートです。すべての<code>%</code>sテンプレートプレースホルダーは、ログインフォームから取得したユーザー名に置き換えられます。</p> <p>例えば、<code>uid=%s,dc=example,dc=com</code>です。</p> <p>一部のLDAP実装は、バインドリクエスト用の追加のテンプレートをサポートしています。</p> <ul><li>Active Directoryは、<code>%s@example.com</code>テンプレートを受け入れます。</li> <li><code>cn=%s,dc=example,dc=com</code>または<code>email=%s,dc=example,dc=com</code>も有効な場合があります。</li></ul> <h4 id="フィルター"><a href="#フィルター" class="header-anchor">#</a> フィルター</h4> <p>フィルターは追加オプションの設定で、追加のLDAP検索要求向けパラメーターを指定して、ePortalにアクセスできるユーザーを制限します。通常は、ユーザーが所属するグループの確認です。検索の結果、空でない値が返されると、ユーザーは認証済みとみなされます。</p> <p><code>&lt;base&gt;??&lt;scope&gt;?&lt;filter&gt;</code>というフォーマットは、<a href="https://tools.ietf.org/html/rfc2255" target="_blank" rel="noopener noreferrer">The LDAP URL Format RFC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>の一部です。</p> <ul><li><strong>base</strong>：検索ベース。検索実行の起点となるルートノード。</li> <li><strong>scope</strong>：検索範囲。
<ul><li><code>base</code>：ベースのみを検索します（デフォルト）。</li> <li><code>one</code>：直接の子のみ（ベースから1階層下）を検索します。</li> <li><code>sub</code>：ツリー全体を検索します。</li></ul></li> <li><strong>filter</strong>：適用する検索フィルター。</li></ul> <p>例 <code>dc=example,dc=com??one?(&amp;(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))</code></p> <p>注意。<code>Filter</code>設定でも、<code>%s</code>プレースホルダーを使用できます。<code>%s</code>は、ログインフォームから取得したユーザー名に置き換えられます。</p> <h3 id="ログイン処理"><a href="#ログイン処理" class="header-anchor">#</a> ログイン処理</h3> <p>ユーザーがePortalにログインすると、ePortalは最初にローカルデータベース内のユーザー資格情報を確認します。資格情報が見つかった場合、ユーザーは認証されます。ユーザー資格情報が見つからなかった場合にのみ、ePortalからLDAPにリダイレクトされます。</p> <p>LDAP認証情報で初めてePortalにログインする場合、デフォルトで、データベースにユーザーが作成されます。ユーザー名はLDAPユーザー名、権限は読み取り専用、説明はLDAPになります。（(<code>https://&lt;eportal&gt;/admin/user/</code>）。</p> <p>以下の画像では、<code>kc.eportal</code>コマンドラインインターフェイスで作成された1ユーザーと、LDAP資格情報でログインした2ユーザーが表示されています。</p> <p><img src="/images/eportalLDAPusers.png" alt=""></p> <div class="tip custom-block"><p class="custom-block-title">注</p><p>注意。すべての新しいLDAPユーザーの権限は、読み取り専用です。<code>User edit</code>ページにて、<code>Readonly</code>フィールドをオフにすることで、管理者権限を設定できます。</p></div><h3 id="基本設定例"><a href="#基本設定例" class="header-anchor">#</a> 基本設定例</h3> <p>この例と次の例は、LDAPパブリックテストサーバー <a href="https://www.forumsys.com/tutorials/integration-how-to/ldap/online-ldap-test-server/" target="_blank" rel="noopener noreferrer">ldap.forumsys.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> に基づいています。</p> <p>ユーザーのリストは、以下のとおりです。</p> <div class="language- extra-class"><pre class="language-text"><code>~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(objectClass=person)' dn
dn: uid=tesla,dc=example,dc=com
dn: uid=gauss,dc=example,dc=com
...
</code></pre></div><p>基本設定では、提供されたユーザー名／パスワードがディレクトリサービスにバインド可能かどうかの確認のみが行われます。注意：すべての新規ユーザーには、読み取り専用権限があります。そのため、すべてのLDAPユーザーにePortalへのログインを安全に許可して、個別に適切な権限を設定できます。</p> <p>基本的な設定では、<code>Url</code>と<code>Connection string</code>の設定を入力する必要があります。</p> <table><thead><tr><th>設定</th> <th>値</th></tr></thead> <tbody><tr><td>URL</td> <td>ldap://ldap.forumsys.com?tls=0</td></tr> <tr><td>Connection string</td> <td>uid=%s,dc=example,dc=com</td></tr></tbody></table> <p>その後、<code>gauss:password</code>または<code>tesla:password</code>の資格情報を使用してログインできます。</p> <h3 id="フィルター設定例"><a href="#フィルター設定例" class="header-anchor">#</a> フィルター設定例</h3> <p>フィルターを使用すると、ePortalへのログインを許可された一連のユーザー（例：<code>mathematicians</code>グループに属するユーザー）を制限できます。</p> <p>以下が、グループの例です。</p> <div class="language- extra-class"><pre class="language-text"><code>~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(objectClass=groupOfUniqueNames)' dn
dn: ou=mathematicians,dc=example,dc=com
dn: ou=scientists,dc=example,dc=com
...
</code></pre></div><p>そして、以下が<code>mathematicians</code>グループの属性です。</p> <div class="language- extra-class"><pre class="language-text"><code>~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b 'dc=example,dc=com' '(ou=mathematicians)'
dn: ou=mathematicians,dc=example,dc=com
uniqueMember: uid=euclid,dc=example,dc=com
uniqueMember: uid=riemann,dc=example,dc=com
uniqueMember: uid=euler,dc=example,dc=com
uniqueMember: uid=gauss,dc=example,dc=com
uniqueMember: uid=test,dc=example,dc=com
ou: mathematicians
cn: Mathematicians
objectClass: groupOfUniqueNames
objectClass: top
</code></pre></div><p>許可されたユーザーを制限するためのePortal LDAP設定は以下のとおりです。</p> <table><thead><tr><th>設定</th> <th>値</th></tr></thead> <tbody><tr><td>URL</td> <td>ldap://ldap.forumsys.com?tls=0</td></tr> <tr><td>Filter</td> <td>dc=example,dc=com??one?(&amp;(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))</td></tr> <tr><td>Connection string</td> <td>uid=%s,dc=example,dc=com</td></tr></tbody></table> <p>フィルターの考え方は、ログインしようとするユーザーのDNと等しい<code>uniqueMember</code>属性を持つ<code>mathematicians</code>グループを見つけることです。</p> <p>その後、<code>gauss:password</code>資格情報を使用してログインできます。ただし、<code>tesla:password</code>資格情報ではログインできません。</p> <h2 id="eportalへのアクセス"><a href="#eportalへのアクセス" class="header-anchor">#</a> ePortalへのアクセス</h2> <p>KernelCare.ePortal管理コンソールにアクセスするには、<strong>http://YOUR_IP/admin</strong> に接続します。</p> <p>そして、ユーザー名とパスワードを入力します</p> <p><img src="/images/access_eportal.png" alt=""></p> <p><a href="#managing-users">kc.eportalツール</a>を使用してログイン情報を管理できます。</p> <h2 id="パッチセットの展開"><a href="#パッチセットの展開" class="header-anchor">#</a> パッチセットの展開</h2> <p>ePortalには、最新のパッチをダウンロードするメカニズムが組み込まれています。使用を開始するには、まずePortalナビゲーションバーのSettingsリンクをクリックし、次にPatch Sourceをクリックします。アクセスするには、 <a href="mailto:sales@tuxcare.com">sales@tuxcare.com</a> に連絡して、ご利用のePortalアクセス資格情報をリクエストしてください。</p> <p><img src="/images/eportal-edit-patch-source.png" alt=""></p> <p>ディスク容量とネットワーク帯域幅の要件を緩和するために、ディストリビューションを限定して取得するように選択できます。</p> <p>パッチソースアクセス情報を設定すると、利用可能なパッチセットのリストを閲覧できます。</p> <p><img src="/images/eportal-dashboard.png" alt=""></p> <ul><li><p><strong>Usage</strong>：任意のフィードで特定のパッチセットを使用しているサーバー数。数字をクリックすると、パッチセットを使用しているサーバーのリストが表示されます。</p></li> <li><p><strong>Patchsets</strong>：パッチセットの名前。名前をクリックすると、パッチセットの変更ログが表示されます。</p></li> <li><p><strong>Feed name</strong>：セルには、特定のフィードでのパッチセットの展開とサーバーの使用状況が表示されます。数字をクリックして、サーバー一覧をフィルターすることもできます。</p></li> <li><p><strong>Manage</strong>：ダイアログを開いて、パッチセットを有効／無効にできます。</p></li></ul> <h3 id="パッチセットページの管理"><a href="#パッチセットページの管理" class="header-anchor">#</a> パッチセットページの管理</h3> <p><img src="/images/eportal-manage.png" alt=""></p> <p>このダイアログでは、対応するフィードでどのパッチセットを有効／無効にするかを制御できます。</p> <ul><li><p><strong>Enable all up to this patchset</strong>：このパッチセットまでのすべてのパッチセット（<strong>disabled</strong>を除く）を有効にするアクション。</p></li> <li><p><strong>Enable</strong>：現在のパッチセットのみを有効にするアクション。</p></li> <li><p><strong>Disable</strong>：現在のパッチセットのみを無効にするアクション。無効化されたパッチセットは、<strong>Enable all up to this patchset</strong>アクションによる自動更新や一括有効化の影響がありません。</p></li></ul> <p>CLIからパッチセットを展開するには、以下を実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal --unroll 16012017_1
</code></pre></div><h3 id="自動更新"><a href="#自動更新" class="header-anchor">#</a> 自動更新</h3> <p>Settings→Feedsからご希望のフィードでAutoupdateを有効にすることで、自動更新の設定ができます。</p> <div class="danger custom-block"><p class="custom-block-title">注</p><p><strong>デフォルトフィード</strong>は、Settingsページでは自動更新を受信するように設定できません。<strong>デフォルトフィード</strong>の自動更新の設定については、次の欄を参照してください。</p></div><h3 id="デフォルトフィードの自動更新"><a href="#デフォルトフィードの自動更新" class="header-anchor">#</a> デフォルトフィードの自動更新</h3> <p>cronジョブを作成することによって、デフォルトフィードの自動更新を設定できます。自動更新を受信するには、以下のコマンドが使用できます。</p> <p>以下のコマンドは、最新のパッチが利用可能かどうかを判断し、<strong>デフォルトフィード</strong>にインストールします。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal --get-latest
</code></pre></div><h3 id="ファイルからリリースをデプロイするスクリプト"><a href="#ファイルからリリースをデプロイするスクリプト" class="header-anchor">#</a> ファイルからリリースをデプロイするスクリプト</h3> <p>ePortalサーバーをKernelCareパッチサーバーに接続して、パッチセットを直接ダウンロードする機会がない場合は、手動で行うことができます。</p> <p>既にダウンロード済みのパッチセットの場所があり、アップロードする最新のパッチセットファイルの選択をご希望の場合は、お持ちのアーカイブのリストを<code>/usr/share/kcare-eportal/arch/</code>フォルダの内容と比較できます。</p> <p>その後、選択したパッチセットをePortalサーバーにアップロードして、それぞれのパッチセットに対して<code>kc.eportal --deploy</code>コマンドを実行します。</p> <h4 id="例"><a href="#例" class="header-anchor">#</a> 例</h4> <p>ePortalのテストインスタンスと本番インスタンスの違いを見てみましょう。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">comm</span> <span class="token parameter variable">-23</span> <span class="token punctuation">\</span>
    <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">ssh</span> eportal-test <span class="token string">&quot;ls /usr/share/kcare-eportal/arch/K*.tar.bz2&quot;</span> <span class="token operator">|</span> <span class="token function">sort</span> -h<span class="token punctuation">)</span> <span class="token punctuation">\</span>
    <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">ssh</span> eportal-prod <span class="token string">&quot;ls /usr/share/kcare-eportal/arch/K*.tar.bz2&quot;</span> <span class="token operator">|</span> <span class="token function">sort</span> -h<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">tee</span> patchsets.diff
</code></pre></div><p>本番環境にパッチセットをアップロードします。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> patchsets.diff <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-Phav</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token function">rsync</span> <span class="token parameter variable">-iv</span> eportal-test:<span class="token punctuation">{</span><span class="token punctuation">}</span> /tmp/
$ <span class="token function">rsync</span> <span class="token parameter variable">-Phav</span> /tmp/K*.tar.bz2 eportal-prod:/tmp/
</code></pre></div><p>パッチセットファイル名をパラメーターとして、展開ツールを実行します。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ssh</span> eportal-prod <span class="token string">'ls /tmp/K*.tar.bz2 | sort -h | xargs -n1 kc.eportal kcare deploy'</span>
<span class="token number">2021</span>-12-02 01:25:06,555 - eportal.patches - INFO - K04082020_1 was enabled <span class="token keyword">in</span> main
<span class="token punctuation">..</span>.
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">注</p><p>上記の手順は、他のすべてのタイプのパッチセット（libcareやqemuなど）に対して個別に実行する必要があることに注意してください。<code>kc.eportal libcare deploy</code>などの対応するファイルプレフィックスとコマンドを使用してください。</p></div><h3 id="古いリリースをクリーンする"><a href="#古いリリースをクリーンする" class="header-anchor">#</a> 古いリリースをクリーンする</h3> <p>月1回、提供済みパッチのリストは縮小されます（より新しいバージョンがある古いパッチは除外されます）が、リソースはePortalマシンから削除されません。リソースの削除は、ePortal管理者が行います。ePortalのディスク領域を解放するために、古いリリースのリソースを削除することができます。</p> <p>どのリリースが削除されるかを確認するには、</p> <div class="language- extra-class"><pre class="language-text"><code>DRY_RUN=1 kc.eportal --clean-releases
</code></pre></div><p>古いリリースを削除するには、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal --clean-releases
</code></pre></div><h2 id="libcareパッチセットの展開"><a href="#libcareパッチセットの展開" class="header-anchor">#</a> LibCareパッチセットの展開</h2> <p>バージョン1.18以降、ePortalはLibCareのパッチセット管理をサポートしています。パッチセット管理は、<code>Patches / LibCare</code>ナビゲーション項目からアクセスできます。LibCareパッチは同じパッチソース資格情報を使用しているので、追加の設定を行う必要はありません。</p> <p><img src="/images/eportal-libcare-feed.png" alt=""></p> <h3 id="最新のパッチセットをインストールするcli"><a href="#最新のパッチセットをインストールするcli" class="header-anchor">#</a> 最新のパッチセットをインストールするCLI</h3> <p>デフォルトフィードを更新するには、以下のコマンドを実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal libcare update
</code></pre></div><p><code>test</code>フィードを更新するには、以下のコマンドを実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal libcare update --feed test
</code></pre></div><p>すべての自動フィードを更新するには、以下のコマンドを実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal libcare auto-update
</code></pre></div><h3 id="アーカイブからパッチセットを展開するcli"><a href="#アーカイブからパッチセットを展開するcli" class="header-anchor">#</a> アーカイブからパッチセットを展開するCLI</h3> <div class="language- extra-class"><pre class="language-text"><code>~$ kc.eportal libcare deploy --help
usage: kc.eportal libcare deploy [-h] [--feed FEED] [--disabled] archive

positional arguments:
  archive      path to archive

optional arguments:
  -h, --help   show this help message and exit
  --feed FEED  feed to deploy archive to
  --disabled   do not enable patchset after deploy
</code></pre></div><p>例えば、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal libcare deploy --feed test /tmp/U20210129_02.tar.bz2
</code></pre></div><p>このコマンドは、<code>U20210129_02</code>パッチセットを<code>test</code>フィードに展開して、有効にします。</p> <h2 id="qemuパッチセットの展開"><a href="#qemuパッチセットの展開" class="header-anchor">#</a> QEMUパッチセットの展開</h2> <p>バージョン1.25以降、ePortalはQEMUのパッチセット管理をサポートしています。パッチセット管理は、<code>Patches / QEMUcare</code>ナビゲーション項目からアクセスできます。QEMUパッチは同じパッチソース資格情報を使用しているので、追加の設定を行う必要はありません。</p> <p><img src="/images/eportal-qemu-feed.png" alt=""></p> <h3 id="最新のパッチセットをインストールするcli-2"><a href="#最新のパッチセットをインストールするcli-2" class="header-anchor">#</a> 最新のパッチセットをインストールするCLI</h3> <p>デフォルトフィードを更新するには、以下のコマンドを実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal qemu update
</code></pre></div><p><code>test</code>フィードを更新するには、以下のコマンドを実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal qemu update --feed test
</code></pre></div><p>すべての自動フィードを更新するには、以下のコマンドを実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal qemu auto-update
</code></pre></div><h3 id="アーカイブからパッチセットをデプロイするcli"><a href="#アーカイブからパッチセットをデプロイするcli" class="header-anchor">#</a> アーカイブからパッチセットをデプロイするCLI</h3> <div class="language- extra-class"><pre class="language-text"><code>~$ kc.eportal qemu deploy --help
usage: kc.eportal qemu deploy [-h] [--feed FEED] [--disabled] archive

positional arguments:
  archive      path to archive

optional arguments:
  -h, --help   show this help message and exit
  --feed FEED  feed to deploy archive to
  --disabled   do not enable patchset after deploy
</code></pre></div><p>例えば、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal qemu deploy --feed test /tmp/U20210818_01-qemu.tar.bz2
</code></pre></div><p>このコマンドは、<code>U20210818_01-qemu</code>パッチセットを<code>test</code>フィードに展開して、有効にします。</p> <h2 id="キーの管理"><a href="#キーの管理" class="header-anchor">#</a> キーの管理</h2> <p>新しいサーバーを登録するには、サーバー登録に使用されるKernelCareキーを作成する必要があります。キーのリストに移動するには、<em>Keys</em>ナビゲーション項目をクリックします。</p> <p><img src="/images/key-menu_zoom70.png" alt=""></p> <ul><li>キーを編集するには、<img src="/images/eportal_keys_edit.png" alt="">. をクリックします。 編集タブが開きます。</li> <li>キーを削除するには、<img src="/images/eportal_keys_remove.png" alt="">. をクリックします。キーを削除すると、そのキーで登録されているすべてのサーバーが削除されることに注意してください。</li> <li>キーをクリックすると、そのキーで<a href="#managing-servers">登録されているサーバー</a>のリストがあるServersタブに移動します。そのタブでサーバーを削除することもできます。</li></ul> <p>新しい登録を作成するには、<em>Create</em>タブをクリックします。</p> <p><img src="/images/key-creation_zoom70.png" alt=""></p> <p>以下のフィールドに入力します。</p> <ul><li><strong>Key</strong> — キーの値を入力できます。フィールドを空にしておくこともできますが、その場合は自動生成されたキーが使用されます。</li> <li><strong>Description</strong> — キーの説明を入力できます。</li> <li><strong>Server Limit</strong> — そのキーで登録できるサーバー数。</li> <li><strong>Feed</strong> — 特定のフィードを選択するか、空のままにします。</li></ul> <p>キーを追加するには、<em>Save</em>をクリックします。新しい登録キーが作成され、リストに追加されます。まさにこのキーが、個々のサーバーで登録コマンドの一部として使用されます。</p> <p>このキーを保存し、別のキーを追加するには、<em>Save and Add Another</em>をクリックします。</p> <p>キーを追加し、キー編集タブを開くには、<em>Save and Continue Editing</em>をクリックします。</p> <p>新しいキーを追加せずにキーのリストのタブに戻るには、<em>Cancel</em>をクリックします。</p> <h3 id="キーを管理するcli"><a href="#キーを管理するcli" class="header-anchor">#</a> キーを管理するCLI</h3> <div class="language- extra-class"><pre class="language-text"><code>~$ kc.eportal key --help
usage: kc.eportal key [-h] [-a] [-c] [--note NOTE]
                      [--server-limit SERVER_LIMIT] [--feed FEED]
                      [key]

list available keys by default

positional arguments:
  key                   key name

optional arguments:
  -h, --help            show this help message and exit
  -a                    action: add new key
  -c                    action: change key
  --note NOTE           key description
  --server-limit SERVER_LIMIT
                        maximum number of servers allowed
  --feed FEED           feed to associate key to
</code></pre></div><p>キーのリストを表示します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal key
</code></pre></div><p>キーを自動生成します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal key -a
</code></pre></div><p>値を指定して、キーを作成します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal key -a test
</code></pre></div><p>フィードをキーに設定します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal key -c test --feed test
</code></pre></div><h2 id="サーバーの管理"><a href="#サーバーの管理" class="header-anchor">#</a> サーバーの管理</h2> <p><a href="#managing-keys">キーの管理</a>インターフェイスでキー自体をクリックすると、そのキーで登録されたサーバーを閲覧できます。</p> <p><img src="/images/server_list_1_zoom70.png" alt=""></p> <p>この画面には、そのキーで登録されているサーバー、サーバーのIP、ホスト名、有効なカーネル、登録時刻、最後のチェックイン時刻が表示されます。</p> <p>特定のキー関連付けられているすべてのサーバーIDのリストを閲覧するには、以下を実行します。</p> <ul><li>UIで、キーのリストがあるページに移動します。次に、特定のキーをクリックします。このキーに関連付けられているサーバーのリストが表示されます。</li></ul> <p>どのキーにも関連付けられていないすべてのサーバーIDのリストを閲覧するには、ナビゲーションバーの<em>Servers</em>ボタンを使用します。</p> <p><img src="/images/eportal-servers.png" alt=""></p> <p>また、CLIを使用して、キーのペアと実行中のサーバー数を閲覧できます。</p> <div class="language- extra-class"><pre class="language-text"><code>$ kc.eportal --list-servers
Count | Key
----- + --------------------------------
    0 | 2shcolu7Y1x6885Q
    2 | 6J89aS44j6OmTr05
</code></pre></div><h3 id="非アクティブなサーバーのクリーンアップ"><a href="#非アクティブなサーバーのクリーンアップ" class="header-anchor">#</a> 非アクティブなサーバーのクリーンアップ</h3> <p>30日を超えて非アクティブなサーバーは、以下のコマンドを使用して削除できます。</p> <div class="language- extra-class"><pre class="language-text"><code>$ kc.eportal server clean --inactive
2 servers were deleted
</code></pre></div><p>非アクティブなサーバーのクリーンアップは、毎日またはそれ以下の頻度で自動的に行うことができます。毎日の自動クリーンアップを有効にするには、<a href="#config-files">ePortal構成ファイル</a>内に、オプション<code>CLEAN_INACTIVE_SERVERS_PERIOD = 3600 * 24</code>（秒単位の値）を追加します。</p> <h3 id="管理uiで拡張チェックイン統計を表示"><a href="#管理uiで拡張チェックイン統計を表示" class="header-anchor">#</a> 管理UIで拡張チェックイン統計を表示</h3> <p>開始ページに新しい表が追加されます。この表には、以下の情報が表示されます。</p> <ul><li>総サーバー数。</li> <li>過去48時間にチェックインしたサーバー数。</li></ul> <p>各キーのサーバー数は、<em>Keys</em>ページに一覧表示されます。</p> <h2 id="フィード管理"><a href="#フィード管理" class="header-anchor">#</a> フィード管理</h2> <p>フィードの目的は、サーバー上のパッチセットの管理です。フィードを使用すれば、パッチセットを特定のキーにバインドすることができます。考えられる使用例は、パッチの事前テスト、同様のハードウェアのサーバーのグループへの更新の適用などです。</p> <p>フィード管理インターフェイスに入るには、Settings → Feedsに移動します。</p> <p><img src="/images/feed-button_zoom70.png" alt=""></p> <p>このページでは、ユーザーは既存のフィードを管理（作成、削除、編集）できます。</p> <p><img src="/images/feed-menu_zoom70.png" alt=""></p> <p>利用可能なオプション：</p> <ul><li>Name — フィードの名前。</li> <li>Auto update — このフィードへのパッチの自動ダウンロードを有効または無効にします。</li> <li>Deploy after X hours — パッチセットが展開可能になってから、フィードにインストールされるまでの時間単位の遅延。</li></ul> <p>ePortalは、10分ごとにメインのパッチサーバーで新しいパッチがないかどうか確認します。新しいパッチが利用可能な場合は、ePortalサーバーにアップロードされます。注：パッチはアップロードされますが、展開はされません。パッチの利用可能時間は、新しいパッチがePortalに表示された時点から開始するとみなされ、Deploy after X hoursオプションでは、その時刻が考慮されます。そのため、ユーザーが<code>Deploy after X hours = 10</code>のように設定すると、パッチはePortalサーバーにダウンロードされてから10時間後にフィードに展開されます。</p> <p>フィードを直ちに自動更新して、新しいパッチがePortalで利用可能になった直後にフィードにロードされるようにするには、<code>Deploy after X hours = 0</code>を設定します。</p> <p>特別な場合は、ePortalが新しいサーバーにインストールされた際のクリーンインストールです（パッチのあるダウンロード済みアーカイブや、デフォルトフィードなど展開されたパッチセットがあるフィードはありません）。この場合、ユーザーが新しいフィードを作成し、Deploy after X hoursオプションをすぐに設定すると、すべてのパッチ（利用できる最も古いパッチから最新のパッチまで）が指定されたX時間後にフィードに展開されます。これは、アーカイブが最初からダウンロードされ、「ePortalに表示された直後」とみなされるためです。つまり、すべてのパッチのePortal表示時刻が同じになり、Deploy after X hoursオプションは無効になります。</p> <p><img src="/images/feedmanagement3_zoom70.png" alt=""></p> <p>ePortalのメインページで、ユーザーは対応するキーとフィードのペアを設定できます。これは、キー作成インターフェイスにて、またはキーの編集時に行われます。</p> <p><img src="/images/feedmanagement4_zoom70.png" alt=""></p> <p>デフォルトでは、新しいキーはデフォルトフィードにバインドされます。その代わりに、ユーザーはドロップダウンメニューからご希望のフィードを選択することもできます。</p> <p><img src="/images/feedmanagement5_01_zoom70.png" alt=""></p> <div class="tip custom-block"><p class="custom-block-title">注</p><p>フィードを削除すると、そのフィードに関連付けられているすべてのキーがデフォルトフィードに移動されます。</p></div><p><img src="/images/feedmanagement6_zoom70.png" alt=""></p> <h3 id="フィードを管理するcli"><a href="#フィードを管理するcli" class="header-anchor">#</a> フィードを管理するCLI</h3> <div class="language- extra-class"><pre class="language-text"><code>~$ kc.eportal feed --help
usage: kc.eportal feed [-h] [-a] [-c] [--auto] [--no-auto]
                       [--deploy-after hours]
                       [feed]

list available feeds by default

positional arguments:
  feed                  feed name

optional arguments:
  -h, --help            show this help message and exit
  -a                    action: add new feed
  -c                    action: change feed
  --auto                update feed automatically
  --no-auto             don't update feed automatically
  --deploy-after hours  deploy after specified hours
</code></pre></div><p>フィードのリストを表示します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal feed
</code></pre></div><p>自動更新フィードを追加します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal feed -a test --auto
</code></pre></div><p>フィードを遅延フィードに変更します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal feed -c test --deploy-after 12
</code></pre></div><h2 id="特別なタグフィールドの追加"><a href="#特別なタグフィールドの追加" class="header-anchor">#</a> 特別なタグフィールドの追加</h2> <p>サーバーに特別なタグフィールドを追加するには、以下を実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kcarectl --tag command
</code></pre></div><p>ここで、<code>command</code>はユーザー定義パラメーターです。このパラメーターは、UIでサーバー用に表示されます。ユーザーは、各サーバー用に複数のタグを追加できます。各タグは;記号で区切る必要があります。</p> <p>例えば、</p> <div class="language- extra-class"><pre class="language-text"><code>kcarectl --tag &quot;env:prod;ubuntu&quot;
</code></pre></div><p>このサーバーには、<code>env:prod</code>と<code>ubuntu</code>の2つのタグがあります。</p> <p><code>env:prod</code>は、タグ名<code>env</code>と値<code>prod</code>を持つパラメーターです。</p> <p><img src="/images/addingextratagfield_zoom88.png" alt=""></p> <p>特定のサーバーからすべてのタグを削除するには、以下を実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kcarectl --tag &quot;&quot;
</code></pre></div><p>ここで、<code>&quot;&quot;</code>は以前に定義したタグを削除するためのパラメーターです。</p> <h2 id="httpsを使用するようにeportalを設定する方法"><a href="#httpsを使用するようにeportalを設定する方法" class="header-anchor">#</a> HTTPSを使用するようにePortalを設定する方法</h2> <p>以下が、ePortalが展開されているサーバーの前提です。</p> <h3 id="eportalパブリックnginx-webサーバーでのtlsの終了"><a href="#eportalパブリックnginx-webサーバーでのtlsの終了" class="header-anchor">#</a> ePortalパブリックnginx WebサーバーでのTLSの終了</h3> <ol><li>ファイアウォールは、443ポートへの接続を許可しています。</li> <li>秘密鍵と公開鍵がサーバーにダウンロードされています。</li></ol> <ul><li>証明書に従って、SSL設定テンプレートを編集します。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>mv /etc/nginx/eportal.ssl.conf.example /etc/nginx/eportal.ssl.conf
vi /etc/nginx/eportal.ssl.conf
</code></pre></div><ul><li>この設定をメインの設定に含めます。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>sed -e '3iinclude eportal.ssl.conf;' -i /etc/nginx/conf.d/eportal.conf
</code></pre></div><ul><li>nginxを再起動します。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>service nginx restart
</code></pre></div><h3 id="外部バランサーでのtlsの終了"><a href="#外部バランサーでのtlsの終了" class="header-anchor">#</a> 外部バランサーでのTLSの終了</h3> <p>お好みのリバースプロキシサーバーを使用して、TLSトラフィックを終了し、リクエストをePortalインスタンスに転送できます。要件は、正しい<code>Host</code>ヘッダーと<code>X-Forwarded-Proto</code>ヘッダーを提供することのみです。</p> <p>たとえば、バランサnginxのconfigは以下のとおりです。</p> <div class="language- extra-class"><pre class="language-text"><code>server {
   listen       443 ssl;
   server_name  your-eportal-domain;

   # ssl stuff ...
   # ssl_certificate  ...
   # ssl_certificate_key ...

   location / {
      proxy_pass http://eportal-instance-address;
      proxy_set_header Host $http_host;
      proxy_set_header X-Forwarded-Proto https;
   }
}
</code></pre></div><h3 id="エージェント設定の更新"><a href="#エージェント設定の更新" class="header-anchor">#</a> エージェント設定の更新</h3> <p>httpsに更新されたePortalと通信するには、IPがハードコーディングされたサーバー設定の場合、すべてのサーバーのKernelCare構成ファイルを修正する必要があります。</p> <p>変更を行うには、<code>PATCH_SERVER</code>と<code>REGISTRATION_URL</code>オプションを更新します。</p> <div class="language- extra-class"><pre class="language-text"><code>vi /etc/sysconfig/kcare/kcare.conf
</code></pre></div><p>つまり、編集後に、以下の例のように、<code>/etc/sysconfig/kcare/kcare.conf</code>には更新された環境変数<code>PATCH_SERVER</code>と<code>REGISTRATION_URL</code>が含まれている必要があります。</p> <div class="language- extra-class"><pre class="language-text"><code>PATCH_SERVER=https://eportal_domain_name/
REGISTRATION_URL=https://eportal_domain_name/admin/api/kcare
</code></pre></div><p>別の方法として、パッチサーバーアドレスを更新するのに、ePortalの特別なエンドポイントを使用できます。</p> <div class="language- extra-class"><pre class="language-text"><code>curl -s https://eportal_domain_name/set-patch-server | bash
</code></pre></div><h2 id="高可用性"><a href="#高可用性" class="header-anchor">#</a> 高可用性</h2> <p>バージョン1.28以降、ePortalはアプリケーションレベルのレプリケーションをサポートしています。リーダーからフォロワーへ、フォロワーからリーダーへ、両方向に変更を伝達できます。</p> <p>レプリケーションに関する構成設定は、<a href="#config-files">ePortal構成ファイル</a>で変更できます。</p> <ul><li><code>NODE_URL</code>：自動検出用に必要な自身のインスタンスへのURL</li> <li><code>LEADER_URL</code>：変更の取得元のインスタンスへのURL</li> <li><code>REPLICATION_SHARED_KEY</code>：レプリケーションデータにアクセスするための認証キー</li> <li><code>REPLICATION_CHECK_CERT</code>：レプリケーションリクエストに厳密なTLS証明書認証を使用します。適切なTLS証明書を取得せずに、レプリカに自己署名証明書を展開し、暗号化されたレプリケーショントラフィックを取得すると便利な場合があります。</li> <li><code>REPLICATION_CLEAN_AGE</code>：oplogクリーンアップ中の秒単位のデータ保存時間。デフォルトでは、7日間です。</li> <li><code>REPLICATION_CLEAN_AGGRESSIVE_AGE</code>: 重要でない操作向けoplogクリーンアップ中の秒単位のデータ保存時間。デフォルトでは、1時間です。</li></ul> <p>リーダーノードはフォロワーを自動的に検出し、その後変更を取得します。</p> <p>ePortalクラスタへのエージェントリクエストの負荷を分散する、どんな便利な方法でも使用できます。たとえば、複数のIPアドレスをDNS名に追加したり、HTTPバランサを使用したりできます。</p> <h3 id="基本設定"><a href="#基本設定" class="header-anchor">#</a> 基本設定</h3> <ol><li><p>2つの新しいePortalインスタンスを準備し、DNS名をIPに割り当てます。例えば、</p> <ul><li>eportal1.corp -&gt; 192.168.1.11</li> <li>eportal2.corp -&gt; 192.168.1.12</li> <li>eportal.corp -&gt; 192.168.1.11、192.168.1.12</li></ul></li> <li><p><code>eportal1</code>をリーダー、<code>eportal2</code>をフォロワーとして選択しましょう。<code>eportal.corp</code>は、KernelCareエージェントがあるサーバーに使用するクラスタのホスト名です。</p> <div class="danger custom-block"><p class="custom-block-title">警告！</p><p>クラスタのホスト名を使用して、ePortal管理UIで操作を行わないでください。</p></div></li> <li><p><code>eportal1</code>で、構成ファイルに<code>NODE_URLとREPLICATION_SHARED_KEY</code>を定義します。</p> <div class="language- extra-class"><pre class="language-text"><code>NODE_URL = 'http://eportal1.corp'
REPLICATION_SHARED_KEY = 'secret'
</code></pre></div></li> <li><p><code>eportal2</code>で、<code>NODE_URL</code>、<code>LEADER_URL</code>、<code>REPLICATION_SHARED_KEY</code>を定義します。</p> <div class="language- extra-class"><pre class="language-text"><code>NODE_URL = 'http://eportal2.corp'
LEADER_URL = 'http://eportal1.corp'
REPLICATION_SHARED_KEY = 'secret'
</code></pre></div></li> <li><p>以上になります。両ホストでePortalを再起動した後、<code>eportal1</code>での変更は<code>ePortal2</code>インスタンスに複製されるようになります。その逆も同様です。</p></li></ol> <div class="tip custom-block"><p class="custom-block-title">注</p><p>以下のコマンドで、KernelCareのエージェント設定を変更して、クラスタのホスト名を指すようにすることができます。</p> <div class="language- extra-class"><pre class="language-text"><code>curl -s http://eportal.corp/set-patch-server | bash
</code></pre></div></div><h3 id="既存のeportalインスタンスへのノードの追加"><a href="#既存のeportalインスタンスへのノードの追加" class="header-anchor">#</a> 既存のePortalインスタンスへのノードの追加</h3> <p>すでに動作中のePortalインスタンスがある場合は、2番目のノードを設定し、両インスタンスで<code>NODE_URL</code>と<code>LEADER_URL</code>を定義します。その後、フォロワーインスタンスにて、以下の方法で完全同期をトリガーできます。</p> <div class="language- extra-class"><pre class="language-text"><code>[root@eportal2.corp]$ kc.eportal replication --full-sync
</code></pre></div><h3 id="モニタリング"><a href="#モニタリング" class="header-anchor">#</a> モニタリング</h3> <p><code>kc.eportal replication --short-status</code> CLIコマンドを使用して、レプリケーションのステータスを確認できます。レプリケーションに問題がある場合はコード1で終了し、以下のようなJSONを出力します。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;ok&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>       <span class="token comment">// overall health status</span>
  <span class="token property">&quot;lag&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>         <span class="token comment">// overall replication lag in seconds</span>
  <span class="token property">&quot;last_sync&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>   <span class="token comment">// overall sync delta in seconds (how many seconds ago was successful communication with an upstream)</span>
  <span class="token property">&quot;upstream&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>     <span class="token comment">// per upstream metrics</span>
    <span class="token property">&quot;node2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;ok&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token property">&quot;lag&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;last_sync&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node3&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;ok&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token property">&quot;lag&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;last_sync&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="その他のレプリケーション設定"><a href="#その他のレプリケーション設定" class="header-anchor">#</a> その他のレプリケーション設定</h3> <p>1リーダーと2フォロワーの設定の場合、</p> <div class="language- extra-class"><pre class="language-text"><code>     +-&gt; leader &lt;-+
     |            |
     |            |
follower1       follower2
</code></pre></div><p>リーダーノードが失われて、<code>follower1</code>と<code>follower2</code>が相互に通信できなくなる可能性があります。この問題を軽減するために、リングレプリケーションを展開できます。</p> <div class="language- extra-class"><pre class="language-text"><code>  +-&gt; node1 --+
  |           |
  |           v
node2 &lt;---- node3
</code></pre></div><p>この場合、各インスタンスは別のノードに続きます。</p> <h3 id="警告"><a href="#警告" class="header-anchor">#</a> 警告</h3> <ol><li><p>レプリケーションは、HTTPトランスポートを使用しています。 SSLターミネーションなしでePortalを展開すると、レプリケーションデータは暗号化されずにそのまま転送されます。</p></li> <li><p>ラウンドロビンバランサー設定（DNSまたはHTTPラウンドロビンバランサー）では、KernelCareエージェントは、一連の登録とそれに続く更新の場合に、レプリケーションラグが発生する可能性があります。問題を軽減するために、構成管理ロジックに10秒のタイムアウトまたはリピートを導入できます。</p></li> <li><p>レプリケーションログは7日間保存されます。ノードが7日間を超えて接続を失った場合、一部の変更がスキップされます。</p></li></ol> <h2 id="kernelcare-enterpriseの展開"><a href="#kernelcare-enterpriseの展開" class="header-anchor">#</a> KernelCare Enterpriseの展開</h2> <p>KernelCareエージェントのインストール手順は、 <a href="http://your-eportal-domain/admin/docs/" target="_blank" rel="noopener noreferrer">http://your-eportal-domain/admin/docs/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>にあります。</p> <p>ePortalからエージェントをインストールするには、特別なエンドポイント<code>http://your-eportal-domain/install-kernelcare</code>を使用できます。</p> <div class="language- extra-class"><pre class="language-text"><code>$ export KCARE_MAILTO=admin@mycompany.com
$ curl -s http://eportal.mycompany.com/install-kernelcare | bash
$ kcarectl --register my-key
</code></pre></div><p><code>KCARE_MAILTO</code>のエクスポートの手順は、オプションです。これは、KernelCareの更新失敗に関するすべての通知を受け取るように、<code>/etc/cron.d/kcare-cron</code>で対応するエントリーを設定するのに役立ちます。</p> <h3 id="kernelcare-enterpriseクライアント構成ファイル"><a href="#kernelcare-enterpriseクライアント構成ファイル" class="header-anchor">#</a> KernelCare Enterpriseクライアント構成ファイル</h3> <p>KernelCare Enterpriseクライアント構成ファイルは、<code>/etc/sysconfig/kcare/kcare.conf</code>にあります。</p> <p>例えば、</p> <div class="language- extra-class"><pre class="language-text"><code>AUTO_UPDATE=True
PATCH_SERVER=http://10.1.10.115/
REGISTRATION_URL=http://10.1.10.115/admin/api/kcare
</code></pre></div><p><code>AUTO_UPDATE</code>が<code>True</code>に設定されている場合、KernelCareクライアントは4時間ごとにチェックインし、最新のパッチをダウンロードして適用しようとします。</p> <p><code>PATCH_SERVER</code> - パッチのダウンロード元サーバー</p> <p><code>REGISTRATION_URL</code> - サーバーの登録／登録解除に使用されるURL</p> <h3 id="展開の自動化"><a href="#展開の自動化" class="header-anchor">#</a> 展開の自動化</h3> <p>Ansible／Puppet／Chef／Salt などの自動化ツールを使用して、多数のシステムにKernelCareをインストールして、操作することができます。</p> <p>展開のプロセスには、以下が含まれています。</p> <ul><li><code>http://your-eportal-domain/install-kernelcare</code>スクリプトの実行。事前にダウンロードする（チェックサムを確認する）か、<code>curl -s http://your-eportal-domain/install-kernelcare | bash</code>を直接実行できます。</li> <li>アクティベーションキーを使用したKernelCareエージェントの登録</li></ul> <h4 id="ansible"><a href="#ansible" class="header-anchor">#</a> Ansible</h4> <p>自動展開を開始するには、以下の情報を指定する必要があります。</p> <ul><li><p>eportal_srv Ansible変数のePortalサーバー名（または、IP）。その他の構成ファイルオプションは、<a href="/live-patching-services/#config-options">設定オプション</a>および <a href="#kernelcare-enterprise-client-config-file">KernelCare Enterpriseクライアント構成ファイル</a>（ePortal）にあります。</p></li> <li><p>activation_key Ansible変数のアクティベーションキー。アクティベーションキーは、<a href="#managing-keys">キーの管理</a>（ePortal）で説明されているように、ePortalで生成できます。</p></li></ul> <p>展開フェーズ用のAnsible Playbookは、以下に似た表示になる可能性があります。</p> <div class="language- extra-class"><pre class="language-text"><code>- hosts: kernelcare
  vars:
    eportal_srv: http://192.168.250.19
    activation_key: my-key
  tasks:
    - name: Download the installation shell script
      get_url:
        url: &quot;{{ eportal_srv }}/install-kernelcare&quot;
        dest: /root/kc-install.sh
        mode: '0700'

    - name: Run the installation shell script
      command: /root/kc-install.sh

    - name: register KernelCare agents
      command: /usr/bin/kcarectl --register {{ activation_key }}
</code></pre></div><p>KernelCareエージェントを削除するためのAnsible Playbookファイルの例は、以下のとおりです。</p> <div class="language- extra-class"><pre class="language-text"><code>- hosts: kernelcare
  tasks:
    - name: unregister KernelCare agents
      command: /usr/bin/kcarectl --unregister
      ignore_errors: yes
      args:
        removes: /usr/bin/kcarectl

    - name: remove kernelcare package
      package:
        name: kernelcare
        state: absent
</code></pre></div><h3 id="eportal-ip-ドメインの変更"><a href="#eportal-ip-ドメインの変更" class="header-anchor">#</a> ePortal IP／ドメインの変更</h3> <p>KernelCareエージェントのあるホストで2つの特別なエンドポイントを呼び出すことにより、いつでもePortalのアドレスを変更できます。</p> <div class="language- extra-class"><pre class="language-text"><code>curl -s http://your-eportal-domain/set-kernelcare-repo | bash
curl -s http://your-eportal-domain/set-patch-server | bash
</code></pre></div><ul><li><code>set-kernelcare-repo</code>は、ePortal経由でエージェントの更新をダウンロードする新しいパッケージリポジトリを設定します。</li> <li><code>set-patch-server</code>は、パッチサーバーの新しいアドレスを設定します。</li></ul> <h2 id="eportalの移行"><a href="#eportalの移行" class="header-anchor">#</a> ePortalの移行</h2> <p>ここでは、あるePortalから別のePortalに、フィード／サーバー／キーの構成とパッチデータを移行する手順を解説します。新しいホストのePortalバージョンは1.18以上で、古いホストのバージョン以上である必要があります。</p> <p>DebianベースのシステムからDebianベースのシステムに移行する場合、以下の簡単な手順になります。</p> <ul><li>両ホストでePortalを停止します。</li> <li><code>/var/lib/ePortal</code>を新しいホストにコピーします。注：ディレクトリの所有者は、<code>eportal:eportal</code>のままにしておく必要があります。</li> <li>構成ファイル<code>/etc/eportal/config</code>が存在する場合はコピーします。</li> <li>新しいホストにて、<code>/usr/share/kcare-eportal/migratedb.py --upgrade</code>で移行を実行します。</li> <li>新しいホストでePortalを開始します。</li></ul> <p>RHELベースのディストリビューションからの移行は、より複雑です。後で、スクリプトにて<code>$BASE_DIR</code>変数が参照されます。<code>$BASE_DIR</code>変数は、RHELベースのディストリビューション用にエクスポートできます。</p> <div class="language- extra-class"><pre class="language-text"><code>export BASE_DIR=/usr/share/kcare-eportal
</code></pre></div><p>また、Debianベースのディストリビューションの場合は、</p> <div class="language- extra-class"><pre class="language-text"><code>export BASE_DIR=/var/lib/eportal
</code></pre></div><p>また、Dockerベースのインストールの場合は、対応するデータディレクトリを使用します。たとえば、コンテナを<code>docker run -v /var/lib/eportal/data:/var/lib/eportal/data kernelcare/eportal</code>として実行する場合、<code>$BASE_DIR</code>として<code>/var/lib/eportal/data</code>を使用します。</p> <div class="language- extra-class"><pre class="language-text"><code>export BASE_DIR=/var/lib/eportal/data
</code></pre></div><ul><li><p>両ホストでePortalを停止します。</p> <div class="language- extra-class"><pre class="language-text"><code>[old-host ~]# systemctl stop eportal
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>[new-host ~]# systemctl stop eportal
</code></pre></div></li> <li><p>新しいホストでdbファイルを削除します。</p> <div class="language- extra-class"><pre class="language-text"><code>[new-host ~]# rm $BASE_DIR/*.sqlite*
</code></pre></div></li> <li><p>古いホストから新しいホストにデータベースファイル<code>$BASE_DIR/*.sqlite*</code>をコピーします。</p></li> <li><p>（オプション）ランタイムLDAPとフィードソースの設定<code>$BASE_DIR/config/config.json</code>をコピーします。</p></li> <li><p>（オプション）ePortalのWebアプリ設定<code>/usr/share/kcare-eportal/config/local.py</code>を新しいePortalにコピーします。また、<code>/etc/eportal/config</code>が存在する場合は、それを新しいホストの<code>/etc/eportal/config</code>にコピーします。</p></li> <li><p>新しいePortalへ移行が行われたことを当社の請求部門が認識できるようにし、二重請求が行われないように、<code>$BASE_DIR/instance-id</code>をコピーします。</p></li> <li><p>パッチデータ<code>$BASE_DIR/{arch,resources,user-resources}</code>を新しいホストにコピーします。</p></li> <li><p>ファイルの所有者を設定します。RHELベースのディストリビューションの場合、</p> <div class="language- extra-class"><pre class="language-text"><code>[new-host ~]# chown -R nginx:nginx $BASE_DIR
</code></pre></div><p>Debianベースのディストリビューションの場合、</p> <div class="language- extra-class"><pre class="language-text"><code>[new-host ~]# chown -R eportal:eportal $BASE_DIR
</code></pre></div></li> <li><p>新しいホストで、移行<code>/usr/share/kcare-eportal/migratedb.py --upgrade</code>を実行します。</p></li> <li><p>新しいホストでePortalを開始します。</p> <div class="language- extra-class"><pre class="language-text"><code>[new-host ~]# systemctl start eportal
</code></pre></div></li></ul> <h2 id="データベースのバックアップ"><a href="#データベースのバックアップ" class="header-anchor">#</a> データベースのバックアップ</h2> <h3 id="バックアップの作成"><a href="#バックアップの作成" class="header-anchor">#</a> バックアップの作成</h3> <p>kc.eportalユーティリティには、データベースのバックアップを作成するオプションがあります</p> <p><code>kc.eportal backup-db &lt;path_to_directory&gt;</code> - 指定されたディレクトリにバックアップを作成します。ディレクトリが存在しない場合は、ディレクトリが作成されます。</p> <p>例えば、</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal backup-db /usr/share/kcare-eportal/db-backup_$(date '+%Y-%m-%d')
</code></pre></div><h3 id="バックアップからの復元"><a href="#バックアップからの復元" class="header-anchor">#</a> バックアップからの復元</h3> <p>既存のデータベース（デフォルトでは、ePortalホームディレクトリ内にあります）をバックアップ ファイルで置き換えることができます。</p> <p>重要：データベースファイルを置き換える前に、ePortalを停止する必要があります。バックアップ ファイルには、所有者とグループ<code>nginx:nginx</code>が必要です。</p> <p>例えば、</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl stop eportal
cp -f /path/to/backup_dir/* /usr/share/kcare-eportal/
chown nginx:nginx /usr/share/kcare-eportal/*.sqlite*
systemctl start eportal
</code></pre></div><p>また、リモートパッチソースの設定（ePortal UIのユーザー名、パスワード、ダウンロード URL）を確認し、その後、パッチをダウンロードする必要があります。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal kcare download-missing
kc.eportal libcare download-missing
kc.eportal qemu download-missing
kc.eportal db download-missing
</code></pre></div><h2 id="構成ファイル"><a href="#構成ファイル" class="header-anchor">#</a> 構成ファイル</h2> <ul><li>ePortalの構成ファイル：<code>/etc/eportal/config</code>。バージョン1.35よりも古いバージョンの構成ファイル： <code>/usr/share/kcare-eportal/local.py</code>。</li> <li>Webサーバー（nginx）の構成ファイル：<code>/etc/nginx/conf.d/eportal.conf</code>。</li> <li>データディレクトリ（RHELベースのディストリビューション）：<code>/usr/share/kcare-eportal</code>。</li> <li>データ ディレクトリ（Debianベースのディストリビューション）：<code>/var/lib/eportal</code>。</li></ul> <h2 id="停止と開始"><a href="#停止と開始" class="header-anchor">#</a> 停止と開始</h2> <p>nginxサーバーの設定を停止／開始／リロード／再起動するには、</p> <div class="language- extra-class"><pre class="language-text"><code>$ systemctl stop|start|reload|restart nginx
</code></pre></div><p>ePortalを停止／開始／再起動するには（Python）、</p> <div class="language- extra-class"><pre class="language-text"><code>$ systemctl stop|start|restart eportal
</code></pre></div><h2 id="ログファイル"><a href="#ログファイル" class="header-anchor">#</a> ログファイル</h2> <p>ePortalのログ： <code>journalctl -u eportal</code></p> <p>Nginx ePortalのアクセスログ：<code>/var/log/nginx/access.log</code></p> <p>Nginxのエラーログ：<code>/var/log/nginx/error.log</code></p> <h3 id="ログローテーション"><a href="#ログローテーション" class="header-anchor">#</a> ログローテーション</h3> <p>デフォルトでは、ePortalのログローテーション用の定義済みパラメータはありません。上記のファイルに対してログローテーションを有効にする場合は、</p> <ul><li><code>logrotate</code>パッケージをインストールする</li> <li><code>/etc/logrotate.d/eportal</code>構成ファイルを作成／編集する</li></ul> <p>logrotate設定の例は、以下のとおりです。</p> <div class="language- extra-class"><pre class="language-text"><code>/var/log/nginx/kcare-eportal.log {
    daily
    rotate 5 # keep 5 last archives
    missingok # it's ok if there is no such file
    notifempty # do nothing if file is empty
    compress
}
</code></pre></div><h2 id="nagiosとzabbixのサポート"><a href="#nagiosとzabbixのサポート" class="header-anchor">#</a> NagiosとZabbixのサポート</h2> <p>バージョン1.2以降のKernelCare.ePortalは、<a href="/kc-agent-monitoring/#nagios-plugin">Nagios</a>と<a href="/kc-agent-monitoring/#zabbix-template">Zabbix</a>の監視と同様のサーバー監視をサポートしています。</p> <p>情報を受け取るには、APIを直接curlします。</p> <div class="language- extra-class"><pre class="language-text"><code>https://yourserver/admin/api/kcare/nagios/KCAREKEY
</code></pre></div><p>または、<a href="https://patches.kernelcare.com/downloads/nagios/check_kcare" target="_blank" rel="noopener noreferrer">https://patches.kernelcare.com/downloads/nagios/check_kcare<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> スクリプトを使用することができます。使用するには、スクリプト内のKEY_KCARE_NAGIOS_ENDPOINTをご利用のサーバーを指すように変更します。つまり、<a href="https://cln.cloudlinux.com/clweb" target="_blank" rel="noopener noreferrer">https://cln.cloudlinux.com/clweb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（古いUIへのリンク）または<a href="https://cln.cloudlinux.com/console/auth/login" target="_blank" rel="noopener noreferrer">https://cln.cloudlinux.com/console/auth/login<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（新しいUIへのリンク）を<a href="https://yourserver/admin" target="_blank" rel="noopener noreferrer">https://yourserver/admin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>へ変更します。</p> <div class="tip custom-block"><p class="custom-block-title">注</p><p><code>PARTNER_LOGIN/TOKEN</code>を使用したアクセスは、KernelCare.ePortalではサポートされていません。</p></div><h2 id="使用状況レポート"><a href="#使用状況レポート" class="header-anchor">#</a> 使用状況レポート</h2> <p>通常、使用状況レポートは自動的に送信されます。ただし、送信できない場合は、ePortalはレポートをEメールで送信しようとします。これには、ホストに設定されたSendmail（SSMTP）が必要になります。以下が簡単な手順になります。</p> <p>メールの送信に失敗した場合、ePortalはレポートを<code>/usr/share/kcare-eportal/reports</code>に保存します。これらのレポートは、手動で送信する必要があります。</p> <h3 id="sendmail-ssmtp-の設定方法"><a href="#sendmail-ssmtp-の設定方法" class="header-anchor">#</a> Sendmail（SSMTP）の設定方法</h3> <p>まず、<code>ssmtp</code>をインストールする必要があります。</p> <div class="language- extra-class"><pre><code>yum install -y ssmtp
</code></pre></div><p>SMTPサーバーの設定に従って、<code>/etc/ssmtp/ssmtp.conf</code>ファイルを編集します。以下は、Gmailアカウントに接続する一般的な方法が記述された簡単な構成ファイルです。</p> <div class="language- extra-class"><pre><code>root=username@gmail.com
mailhub=smtp.gmail.com:587
hostname=localhost
UseSTARTTLS=YES
AuthUser=username@gmail.com
AuthPass=xxxxxxxxxxxxxxxxxxx
FromLineOverride=YES
TLS_CA_File=/etc/ssl/certs/ca-certificates.crt
</code></pre></div><p>TLS_CA_Filesの実際の場所は、Linuxディストリビューションによって異なります。</p> <div class="language- extra-class"><pre><code>&quot;/etc/ssl/certs/ca-certificates.crt&quot;,                // Debian/Ubuntu/Gentoo etc.
&quot;/etc/pki/tls/certs/ca-bundle.crt&quot;,                  // Fedora/RHEL 6
&quot;/etc/ssl/ca-bundle.pem&quot;,                            // OpenSUSE
&quot;/etc/pki/tls/cacert.pem&quot;,                           // OpenELEC
&quot;/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem&quot;, // CentOS/RHEL 7
</code></pre></div><p>また、以下を実行して、取得できます。</p> <div class="language- extra-class"><pre><code>curl-config --ca
</code></pre></div><p>これで、接続をテストできます。</p> <div class="language- extra-class"><pre><code>echo -n 'Subject: test\n\nTesting ssmtp' | sendmail -v some-recipient@gmail.com
</code></pre></div><h2 id="カスタム環境変数"><a href="#カスタム環境変数" class="header-anchor">#</a> カスタム環境変数</h2> <p>ePortalプロセス用に独自の環境変数を定義できます。</p> <p><code>/usr/share/kcare-eportal/environment</code>フォルダがあり、これは基本的にデーモンツールと互換性のあるenvdirです。</p> <p>たとえば、デフォルトのhttps検証を無効にするには、以下のように<code>PYTHONHTTPSVERIFY</code>環境変数を0に設定します。</p> <div class="language- extra-class"><pre class="language-text"><code>echo 0 &gt; /usr/share/kcare-eportal/environment/PYTHONHTTPSVERIFY`
</code></pre></div><h2 id="シングルサインオンによる認証"><a href="#シングルサインオンによる認証" class="header-anchor">#</a> シングルサインオンによる認証</h2> <p>ePortalは「OAuth 2.0」標準、「認証コード」フローによるシングルサインオン認証をサポートしています。</p> <h3 id="設定"><a href="#設定" class="header-anchor">#</a> 設定</h3> <p>SSOを有効にするには、OAuth2認証サービスプロバイダーとePortalを設定する必要があります。</p> <h4 id="oktaアプリケーションの設定例"><a href="#oktaアプリケーションの設定例" class="header-anchor">#</a> Oktaアプリケーションの設定例</h4> <p>Okta管理コンソール内で、OpenID Connectアプリケーションを設定します。</p> <ol><li><p>管理コンソールで、<strong>Applications</strong> &gt; <strong>Applications</strong>に移動します。</p></li> <li><p>Create <strong>App Integration</strong>をクリックします。</p></li> <li><p>Create a new app integrationページで、まず<strong>Sign-in method</strong>として<strong>OIDC - OpenID Connect</strong>を選択し、次に<strong>Application type</strong>として<strong>Web Application</strong>を選択します。</p></li> <li><p><strong>Application Settings</strong>を入力します。</p></li></ol> <table><thead><tr><th><strong>設定</strong></th> <th><strong>値</strong></th></tr></thead> <tbody><tr><td>Sign-in redirect URI</td> <td>http://eportal_ip/admin/sso/login/callback</td></tr> <tr><td>Sign-out redirect URI</td> <td>http://eportal_ip/admin</td></tr></tbody></table> <ol start="5"><li><em>Client ID</em>、<em>Client secret</em>、<code>/authorize</code>、<code>/token</code>、<code>/userinfo</code>エンドポイントへの完全なURLを取得します。</li></ol> <h4 id="eportalの設定"><a href="#eportalの設定" class="header-anchor">#</a> ePortalの設定</h4> <p>ePortalマシンで、SSO設定を構成します。</p> <p><a href="#config-files">ePortal構成ファイル</a>を編集します。</p> <div class="language- extra-class"><pre class="language-text"><code>OIDC_AUTH_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/authorize&quot;
OIDC_TOKEN_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/token&quot;
OIDC_USERINFO_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/userinfo&quot;

OIDC_CLIENT_ID=&quot;0Aa134lzhUKj8jDMo5d7&quot;
OIDC_CLIENT_SECRET=&quot;AoBNuWRLRu2dxIR3Q0btO53N1entmGxBjQqwmjVL&quot;
</code></pre></div><p>ePortalを再起動します（<a href="#stopping-starting">停止と開始</a>欄を参照し、対応するOSを選択してください）。</p> <p>すべての設定が正しく構成されている場合、新しい<strong>Sign In with SSO</strong>ボタンがログインページ<code>http://eportal_ip/admin/login</code>に表示されているはずです。</p> <p><img src="/images/sso_eportal.png" alt=""></p> <h2 id="カスタムパッチストレージ"><a href="#カスタムパッチストレージ" class="header-anchor">#</a> カスタムパッチストレージ</h2> <p>デフォルトでは、パッチとデータベースは、RHELベースのシステムの場合は<code>/usr/share/kcare-eportal</code>に、debベースのシステムの場合は<code>/var/lib/eportal</code>に保存されています。たとえば、外部ブロックデバイスにパッチを保存するなど、分割ストレージを使用するように設定できます。</p> <p><a href="#config-files">ePortal構成ファイル</a>を編集します。</p> <div class="language- extra-class"><pre class="language-text"><code>PATCHES_DIR = '/path/to/patches/storage'
</code></pre></div><p>以下を実行します。</p> <div class="language- extra-class"><pre class="language-text"><code>kc.eportal sync-nginx-conf
</code></pre></div><p>ストレージが初期化され、新しい場所からパッチが提供されるように、nginx構成ファイルに対応する変更が行われます。</p> <p><code>nginx</code>と<code>ePortal</code>サービスを再起動して、変更を適用します。</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl restart eportal nginx
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cloudlinux/tux-care-doc/edit/dev/docs/jp/eportal/README.md" target="_blank" rel="noopener noreferrer">編集</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></div> <div class="back-to-top" data-v-c64d4a1e><a class="nav-arrow top back-to-top__link" data-v-c64d4a1e></a></div> </div> <div class="footer" data-v-671babf6><div data-v-671babf6><a href="https://cloudlinux.com" data-v-671babf6><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-671babf6></a></div> <div class="footer-company-title" data-v-671babf6>2023. CloudLinux Inc</div> <div data-v-671babf6><div data-v-671babf6><a href="https://tuxcare.com/faq/" target="_blank" data-v-671babf6>よく寄せられる質問</a></div><div data-v-671babf6><a href="hhttps://tuxcare.com/support-portal/" target="_blank" data-v-671babf6>サポート</a></div><div data-v-671babf6><a href="https://blog.tuxcare.com/" target="_blank" data-v-671babf6>ブログ</a></div></div> <div class="social" data-v-671babf6><span class="footer-social-text" data-v-671babf6>連絡を取り合う</span> <a href="https://www.facebook.com/TuxCare" target="_blank" data-v-671babf6><img src="/fb.png" class="footer-social-logo" data-v-671babf6></a><a href="https://twitter.com/TuxCare_" target="_blank" data-v-671babf6><img src="/tw.png" class="footer-social-logo" data-v-671babf6></a><a href="https://www.linkedin.com/showcase/tuxcare" target="_blank" data-v-671babf6><img src="/in.png" class="footer-social-logo" data-v-671babf6></a><a href="https://www.youtube.com/channel/UCr4GTupdSlC33wfwAGk3jsA/%20Fa" target="_blank" data-v-671babf6><img src="/ytube.png" class="footer-social-logo" data-v-671babf6></a></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.40acf458.js" defer></script><script src="/assets/js/4.fa87bcbc.js" defer></script><script src="/assets/js/1.8d9e0a6b.js" defer></script><script src="/assets/js/30.c5368627.js" defer></script>
  </body>
</html>
